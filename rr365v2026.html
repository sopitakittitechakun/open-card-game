<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏°</title>
<meta name="color-scheme" content="dark"/>
<style>
  :root{
    --bg:#0b0b0b; --card:#141414; --line:rgba(255,255,255,.12);
    --txt:#fff; --muted:#cfcfcf;
    --accent:#ff2b2b; --accent2:#b80000;
    --ok:#36d399; --bad:#ff5a5f;
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;padding:24px;
    font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
    background:radial-gradient(900px 500px at 50% -10%, rgba(255,60,60,.15), transparent 60%), var(--bg);
    color:var(--txt);
  }
  .card{
    max-width:560px;margin:0 auto;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid var(--line); border-radius:24px; padding:18px;
    box-shadow:0 20px 50px rgba(0,0,0,.6);
  }
  h1{font-size:20px;margin:12px 0 6px}
  p{margin:0 0 14px;color:var(--muted);line-height:1.6}
  label{display:block;margin:10px 0 6px;color:var(--muted)}
  input{
    width:100%;padding:12px 14px;border-radius:14px;
    border:1px solid var(--line);background:#0f0f0f;color:#fff;font-size:16px;
  }
  .row{display:flex;gap:10px;margin-top:12px}
  button{
    flex:1;padding:12px 14px;border-radius:14px;border:0;
    font-size:16px;font-weight:800;color:#fff;cursor:pointer;
  }
  .btnAlt{background:#2a2a2a}
  .btnMain{background:linear-gradient(135deg,var(--accent),var(--accent2))}
  button:disabled{opacity:.55;cursor:not-allowed}
  .msg{
    margin-top:12px;padding:12px;border-radius:14px;
    border:1px solid var(--line);background:rgba(0,0,0,.25);
    white-space:pre-line;display:none;line-height:1.6;
  }
  .ok{border-color:rgba(54,211,153,.4)}
  .err{border-color:rgba(255,90,95,.45)}
  .hint{font-size:12px;color:#bfbfbf;margin-top:10px;line-height:1.6}

  .linkBox{
    margin-top:10px;padding:12px;border-radius:14px;
    border:1px dashed rgba(255,255,255,.25);background:rgba(0,0,0,.25);
  }
  .linkBox a{color:#7dd3fc;text-decoration:none}
  .linkBox a:hover{text-decoration:underline}

  .copyBox{
    margin-top:12px;
    padding:12px;
    border-radius:14px;
    border:1px dashed rgba(255,255,255,.25);
    background:rgba(0,0,0,.25);
    display:none;
    align-items:center;
    gap:10px;
  }
  .copyCode{
    flex:1;
    font-weight:900;
    font-size:16px;
    letter-spacing:1px;
    color:#fff;
    user-select:all;
  }
  .copyBtn{
    padding:10px 14px;
    border-radius:12px;
    border:0;
    cursor:pointer;
    font-weight:900;
    color:#fff;
    background:linear-gradient(135deg,#22c55e,#16a34a);
    white-space:nowrap;
  }
  .copyBtn.copied{ background:linear-gradient(135deg,#3b82f6,#2563eb); }

  /* ===== Modal (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô) ===== */
  .modal{
    position:fixed; inset:0;
    background:rgba(0,0,0,.70);
    display:none;
    align-items:center;
    justify-content:center;
    padding:18px;
    z-index:9999;
  }
  .modal.show{ display:flex; }
  .modalCard{
    width:min(560px, 100%);
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    box-shadow:0 20px 60px rgba(0,0,0,.75);
    padding:16px;
  }
  .modalTitle{ font-weight:900; font-size:18px; margin-bottom:10px; }
  .modalText{ color:#e9e9e9; line-height:1.7; margin-bottom:12px; }
  .modalBtns{ display:flex; gap:10px; margin-top:8px; }
  .modalBtnMain{
    flex:1; padding:12px 14px; border-radius:14px; border:0;
    font-weight:900; cursor:pointer; text-align:center; color:#fff;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
  }

  /* ‡∏£‡∏π‡∏õ‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î */
  .hero{
    width:100%;
    border-radius:16px;
    display:block;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.25);
  }
</style>
</head>
<body>

<div class="card">
  <!-- ‚úÖ FIX ANDROID: ‡∏Å‡∏±‡∏ô hotlink/referrer + ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏™‡∏≥‡∏£‡∏≠‡∏á -->
  <img
    id="heroImg"
    class="hero"
    src="https://img5.pic.in.th/file/secure-sv1/photo_--_--66c98b689a0f287d.jpg"
    alt="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ"
    loading="eager"
    decoding="async"
    referrerpolicy="no-referrer"
    crossorigin="anonymous"
    onerror="this.onerror=null; this.src='https://img5.pic.in.th/file/secure-sv1/photo_--_--66c98b689a0f287d.jpg';"
  >

  <h1>üéÅ ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÄ‡πÄ‡∏à‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 38,888 ‡∏ö‡∏≤‡∏ó üéÅ</h1>
  <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏•‡∏∏‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 50 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï)</p>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

  <label id="capLabel" style="display:none;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</label>
  <input id="captchaA" placeholder="‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" style="display:none;"/>

  <div class="row">
    <button id="btnCheck" class="btnAlt" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
    <button id="btnJoin" class="btnMain" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
  </div>

  <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î -->
  <button id="btnPoll" class="btnAlt" type="button" style="margin-top:10px; width:100%;">
    ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î
  </button>

  <div id="msg" class="msg"></div>

  <div id="copyWrap" class="copyBox">
    <div id="promoCode" class="copyCode">RRXXXXXXXX</div>
    <button id="btnCopy" class="copyBtn" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
  </div>

  <div class="hint">
    *‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏™‡∏∞‡∏™‡∏° ‚Äú‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‚Äù ‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏∞<br>
    *‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤
  </div>

  <div class="linkBox">
    üëâ ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:<br>
    <a href="https://rumruay365.uk/events/free-credit" target="_blank" rel="noopener">
      https://rumruay365.uk/events/free-credit
    </a>
  </div>
</div>

<!-- ===== Modal ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô ===== -->
<div id="ruleModal" class="modal" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true">
    <div class="modalTitle">üìå ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô)</div>
    <div class="modalText" id="ruleText">
      1) ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏™‡∏∞‡∏™‡∏° ‚Äú‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‚Äù ‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ<br>
      2) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
      3) 1 ‡∏Ñ‡∏ô / 1 ‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏≠‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥<br>
      4) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    </div>
    <div class="modalBtns">
      <button class="modalBtnMain" id="modalAcknowledge" type="button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
    </div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw_mhtyGWcrnOxMpNgeX6q_GudcK9O13sAmm8ZBEV1sT-yOHm-V6UaaVbIlyPKBxEPb/exec"; // ‚úÖ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå ./exec ‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà
const DEVICE_ID_KEY = "rr365_device_id";

/* ================= STATE ================= */
let SAVED = {
  token:"",
  nonce:"",
  issued_at:0,
  captcha_id:"",
  captcha_q:"",
  pow_prefix:"0000",
  min_delay_ms:6000,
  max_delay_ms:45000,
};
let READY_AT = 0;
let READY_TIMER = null;

/* ================= ELS ================= */
const $phone = document.getElementById("phone");
const $btnCheck = document.getElementById("btnCheck");
const $btnJoin  = document.getElementById("btnJoin");
const $btnPoll  = document.getElementById("btnPoll");
const $msg = document.getElementById("msg");

const $copyWrap = document.getElementById("copyWrap");
const $promoCode = document.getElementById("promoCode");
const $btnCopy = document.getElementById("btnCopy");

const $capLabel = document.getElementById("capLabel");
const $captchaA = document.getElementById("captchaA");

const $ruleModal = document.getElementById("ruleModal");
const $modalAck = document.getElementById("modalAcknowledge");

/* ================= UI ================= */
function show(text, type="ok"){
  $msg.style.display="block";
  $msg.className="msg " + (type==="err"?"err":"ok");
  $msg.textContent=text;
}
function hideMsg(){ $msg.style.display="none"; $msg.textContent=""; }
function hideCopy(){
  $copyWrap.style.display="none";
  $promoCode.textContent="RRXXXXXXXX";
  $btnCopy.textContent="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å";
  $btnCopy.classList.remove("copied");
}
function showCaptcha(q){
  $capLabel.style.display="block";
  $captchaA.style.display="block";
  $capLabel.textContent=q || "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô";
  $captchaA.value="";
}
function hideCaptcha(){
  $capLabel.style.display="none";
  $captchaA.style.display="none";
  $captchaA.value="";
}

/* ===== Modal lock: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô ===== */
function openRuleModal(){
  $ruleModal.classList.add("show");
  $ruleModal.setAttribute("aria-hidden","false");
  document.body.style.overflow="hidden";
}
function closeRuleModal(){
  $ruleModal.classList.remove("show");
  $ruleModal.setAttribute("aria-hidden","true");
  document.body.style.overflow="";
}
$modalAck.addEventListener("click", closeRuleModal);
// ‡∏Å‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
$ruleModal.addEventListener("click", (e)=>{
  if(e.target === $ruleModal){
    // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î
  }
});
// ‡∏Å‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ ESC
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape" && $ruleModal.classList.contains("show")){
    e.preventDefault();
  }
});

/* ================= Helpers ================= */
function normalizePhone(v){
  let s=String(v||"").trim();
  const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  if(!/^0[689]\d{8}$/.test(p)) return "";
  return p;
}
function getOrCreateDeviceId(){
  let id=localStorage.getItem(DEVICE_ID_KEY);
  if(!id){
    id="dev_"+Math.random().toString(36).slice(2)+Date.now().toString(36);
    localStorage.setItem(DEVICE_ID_KEY,id);
  }
  return id;
}
function getFingerprint(){
  const data=[screen.width,screen.height,devicePixelRatio,navigator.language||"",navigator.platform||""].join("|");
  let h=0; for(let i=0;i<data.length;i++){ h=((h<<5)-h)+data.charCodeAt(i); h|=0; }
  return "fp_"+Math.abs(h);
}
function getUaKey(){
  const ua=navigator.userAgent||"";
  let h=0; for(let i=0;i<ua.length;i++){ h=((h<<5)-h)+ua.charCodeAt(i); h|=0; }
  return "ua_"+Math.abs(h);
}

/* ================= JSONP ================= */
function jsonpRequest(params){
  return new Promise((resolve,reject)=>{
    if(!/\/exec(\?|$)/.test(SCRIPT_URL)) return reject(new Error("BAD_EXEC_URL"));
    const cb="cb_"+Math.random().toString(36).slice(2);
    params.jsonp="1"; params.callback=cb; params._ts=Date.now();

    const s=document.createElement("script");
    s.src=SCRIPT_URL+"?"+new URLSearchParams(params).toString();

    window[cb]=(d)=>{ cleanup(); resolve(d); };
    s.onerror=()=>{ cleanup(); reject(new Error("LOAD_ERR")); };

    function cleanup(){
      try{ delete window[cb]; }catch(_){}
      if(s.parentNode) s.parentNode.removeChild(s);
    }
    document.body.appendChild(s);
  });
}

/* ================= PoW ================= */
async function sha256hex(text){
  const enc = new TextEncoder().encode(text);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  const arr = Array.from(new Uint8Array(buf));
  return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function solvePow(phone, serverNonce, prefix){
  const powNonce = "pn_"+Math.random().toString(36).slice(2)+Date.now().toString(36);
  let sol = 0;
  while(sol < 200000){
    const key = [phone, serverNonce, powNonce, String(sol)].join("|");
    const hex = await sha256hex(key);
    if(hex.startsWith(prefix)) return { pow_nonce: powNonce, pow_sol: String(sol) };
    sol++;
    if(sol % 800 === 0) await new Promise(r=>setTimeout(r,0));
  }
  throw new Error("POW_FAIL");
}

function resetSession(){
  SAVED = { token:"", nonce:"", issued_at:0, captcha_id:"", captcha_q:"", pow_prefix:"0000", min_delay_ms:6000, max_delay_ms:45000 };
  READY_AT = 0;
  if(READY_TIMER){ clearInterval(READY_TIMER); READY_TIMER=null; }
  hideCaptcha();
}

async function request(action){
  hideMsg();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return null; }

  const payload={
    action, phone:p,
    deviceId:getOrCreateDeviceId(),
    fingerprint:getFingerprint(),
    ua_key:getUaKey(),
    userAgent:navigator.userAgent
  };

  if(action==="register"){
    if(!SAVED.token || !SAVED.nonce || !SAVED.issued_at){
      show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°","err");
      return null;
    }
    if(Date.now() < READY_AT){
      const left = Math.ceil((READY_AT - Date.now())/1000);
      show(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏≠‡∏µ‡∏Å ${left} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏≠‡∏ó)`,"err");
      return null;
    }
    if(Date.now() - SAVED.issued_at > SAVED.max_delay_ms){
      show("‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á","err");
      return null;
    }

    const capA = ($captchaA.value||"").trim();
    if(!capA){
      show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°","err");
      return null;
    }

    show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå... (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏≠‡∏ó)","ok");
    let pow=null;
    try{ pow = await solvePow(p, SAVED.nonce, SAVED.pow_prefix || "0000"); }
    catch(_){ show("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏≠‡∏ó)","err"); return null; }

    payload.token = SAVED.token;
    payload.nonce = SAVED.nonce;
    payload.issued_at = SAVED.issued_at;
    payload.captcha_id = SAVED.captcha_id;
    payload.captcha_a  = capA;
    payload.pow_nonce = pow.pow_nonce;
    payload.pow_sol   = pow.pow_sol;
  }

  return await jsonpRequest(payload);
}

/* ================= Copy ================= */
$btnCopy.addEventListener("click", async ()=>{
  try{
    const txt = ($promoCode.textContent || "").trim();
    if(!txt) return;
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(txt);
    }else{
      const ta=document.createElement("textarea");
      ta.value=txt; ta.style.position="fixed"; ta.style.left="-9999px";
      document.body.appendChild(ta); ta.focus(); ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }
    $btnCopy.textContent="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì";
    $btnCopy.classList.add("copied");
    setTimeout(()=>{
      $btnCopy.textContent="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å";
      $btnCopy.classList.remove("copied");
    },1500);
  }catch(_){
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á");
  }
});

/* ================= Actions ================= */
$btnCheck.addEventListener("click", async ()=>{
  $btnCheck.disabled=true; $btnJoin.disabled=true;
  resetSession(); hideCopy();

  const data=await request("check").catch(()=>null);
  $btnCheck.disabled=false;

  if(!data){ show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); return; }
  if(!data.ok){ show(data.msg||"‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","err"); return; }
  if(data.exists){ show(data.msg||"‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Ñ‡∏¢‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß","err"); return; }
  if(data.device_used){ show(data.msg||"‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏¢‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß","err"); return; }

  SAVED.token = data.token || "";
  SAVED.nonce = data.nonce || "";
  SAVED.issued_at = Number(data.issued_at || 0);
  SAVED.captcha_id = data.captcha_id || "";
  SAVED.captcha_q = data.captcha_q || "";
  SAVED.pow_prefix = data.pow_prefix || "0000";
  SAVED.min_delay_ms = Number(data.min_delay_ms || 6000);
  SAVED.max_delay_ms = Number(data.max_delay_ms || 45000);

  showCaptcha(SAVED.captcha_q || "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏à‡∏£‡∏¥‡∏á");

  READY_AT = Date.now() + SAVED.min_delay_ms;
  show(`‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠ ${Math.ceil(SAVED.min_delay_ms/1000)} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°\n\n‚ö†Ô∏è ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô`,"ok");

  READY_TIMER = setInterval(()=>{
    if(Date.now() >= READY_AT){
      $btnJoin.disabled=false;
      clearInterval(READY_TIMER);
      READY_TIMER=null;
    }
  }, 250);
});

$btnJoin.addEventListener("click", async ()=>{
  $btnCheck.disabled=true; $btnJoin.disabled=true;
  hideCopy();

  const data=await request("register").catch(()=>null);
  $btnCheck.disabled=false;

  if(!data){ show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); $btnJoin.disabled=false; return; }
  if(!data.ok){ show(data.msg||"‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","err"); $btnJoin.disabled=false; return; }

  // ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà: register ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô PENDING (‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)
  if(data.pending){
    show("‚è≥ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß\n‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î\n\nüëâ ‡∏Å‡∏î ‚Äú‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥","ok");
    openRuleModal();
    resetSession();
    return;
  }

  show(data.msg||"‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","ok");
  resetSession();
});

// ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î
$btnPoll.addEventListener("click", async ()=>{
  hideCopy(); hideMsg();
  const data=await request("poll_code").catch(()=>null);

  if(!data){ show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); return; }
  if(!data.ok){ show(data.msg||"‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","err"); return; }

  if(data.status === "PENDING"){
    show("‚è≥ ‡∏¢‡∏±‡∏á‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡πà‡∏∞\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏´‡∏°‡πà", "ok");
    return;
  }
  if(data.status === "APPROVED"){
    const code = (data.promo_code || "").trim();
    if(!code || code === "NO_CODE"){
      show("‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏°‡∏î\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", "err");
      return;
    }
    show("üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß! ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: " + code, "ok");
    $promoCode.textContent = code;
    $copyWrap.style.display = "flex";
    openRuleModal();
    return;
  }
  if(data.status === "REJECTED"){
    show("‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", "err");
    return;
  }
  if(data.status === "USED"){
    show("‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß", "err");
    return;
  }

  show(data.msg || "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", "ok");
});
</script>
</body>
</html>
