<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà 2569 | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏°</title>
<meta name="color-scheme" content="dark"/>

<style>
:root{
  --bg:#060607;
  --txt:#fff;
  --muted:#cfcfcf;
  --line:rgba(255,255,255,.14);

  --red:#ff2b2b;
  --gold:#ffb703;
  --gold2:#ffd700;

  --ok:#36d399;
  --bad:#ff5a5f;

  --card:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
  --shadow: 0 28px 90px rgba(0,0,0,.85);
  --radius:22px;
}

*{box-sizing:border-box}
body{
  margin:0;
  padding:22px 16px 34px;
  font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
  color:var(--txt);
  background:
    radial-gradient(700px 380px at 15% 0%, rgba(255,215,0,.22), transparent 60%),
    radial-gradient(900px 420px at 85% 8%, rgba(255,60,60,.22), transparent 60%),
    radial-gradient(1100px 560px at 50% -20%, rgba(255,255,255,.12), transparent 65%),
    var(--bg);
}

.wrap{max-width:640px;margin:0 auto}
.card{
  border:1px solid rgba(255,215,0,.18);
  background:var(--card);
  border-radius:calc(var(--radius) + 6px);
  padding:16px;
  box-shadow:var(--shadow);
  backdrop-filter: blur(6px);
}

.hero{
  border-radius:var(--radius);
  overflow:hidden;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.25);
}
.hero img{display:block;width:100%;height:auto}

.top{
  padding:12px 6px 6px;
}
.h1{
  margin:6px 0 6px;
  font-size:20px;
  font-weight:900;
  letter-spacing:.2px;
}
.sub{
  margin:0 0 10px;
  color:var(--muted);
  line-height:1.5;
  font-size:13px;
}

.pills{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin:10px 0 0;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:12px;
  font-weight:800;
}

.label{color:var(--muted);font-size:13px;margin:10px 0 6px}
.input{
  width:100%;
  padding:14px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  outline:none;
  background:#0f0f10;
  color:#fff;
  font-size:16px;
}
.row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
button{
  flex:1;
  min-width:180px;
  border:0;
  padding:13px 14px;
  border-radius:16px;
  font-weight:900;
  cursor:pointer;
  color:#fff;
}
.btnMain{
  background:linear-gradient(135deg,var(--red),var(--gold));
  box-shadow:0 0 22px rgba(255,215,0,.55);
}
.btnMain:hover{transform:translateY(-1px) scale(1.01);box-shadow:0 0 36px rgba(255,215,0,.85)}
.btnAlt{
  background:linear-gradient(135deg,#2b2b2b,#161616);
  border:1px solid rgba(255,255,255,.12);
}
button:disabled{opacity:.55;cursor:not-allowed;transform:none;box-shadow:none}

.msg{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.28);
  white-space:pre-line;
  line-height:1.55;
  display:none;
}
.msg.ok{border-color:rgba(54,211,153,.45)}
.msg.bad{border-color:rgba(255,90,95,.55)}

.hr{height:1px;background:rgba(255,255,255,.10);margin:14px 0}

.small{
  font-size:12px;
  color:#d0d0d0;
  line-height:1.6;
}
.kbd{
  display:inline-block;
  padding:2px 9px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:12px;
  font-weight:900;
}

/* ====== ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î (‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô) ====== */
.screen{display:none}
.screen.active{display:block}

.codeCard{
  margin-top:10px;
  border-radius:22px;
  border:1px solid rgba(255,215,0,.22);
  background:linear-gradient(180deg, rgba(255,215,0,.08), rgba(255,255,255,.04));
  padding:14px;
}
.bigTitle{
  margin:2px 0 6px;
  font-size:18px;
  font-weight:1000;
}
.codeBox{
  display:flex;
  gap:10px;
  align-items:stretch;
  margin-top:10px;
}
.code{
  flex:1;
  border-radius:16px;
  border:1px dashed rgba(255,255,255,.25);
  background:rgba(0,0,0,.35);
  padding:14px;
  font-size:18px;
  font-weight:1000;
  letter-spacing:1.2px;
  user-select:all;
}
.copyBtn{
  width:auto;
  white-space:nowrap;
  padding:14px 14px;
  border-radius:16px;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  border:0;
  font-weight:1000;
}
.goLink{
  display:block;
  margin-top:12px;
  padding:14px;
  text-align:center;
  font-weight:1000;
  border-radius:16px;
  color:#0b0b0b;
  background:linear-gradient(135deg,var(--gold2),#fff3b0);
  text-decoration:none;
}
.goLink:hover{filter:brightness(1.03)}

.badgeWait{
  border:1px solid rgba(255,215,0,.25);
  background:rgba(255,215,0,.08);
}

/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏£‡∏≠ */
#btnPoll{
  animation:nyPulse 2s infinite;
  border:1px solid rgba(255,215,0,.35);
}
@keyframes nyPulse{
  0%{ box-shadow:0 0 0 rgba(255,215,0,.35); }
  50%{ box-shadow:0 0 30px rgba(255,215,0,.85); }
  100%{ box-shadow:0 0 0 rgba(255,215,0,.35); }
}
</style>
</head>

<body>
<div class="wrap">

  <!-- ====== SCREEN A: ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô/‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ====== -->
  <section id="screenWait" class="screen active">
    <div class="card">
      <div class="hero">
        <img src="https://img5.pic.in.th/file/secure-sv1/photo_--_--1c67466a2f55fbd2.jpg" alt="New Year 2569">
      </div>

      <div class="top">
        <div class="h1">üéÜ ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà 2569 | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏° üéÜ</div>
        <div class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î 1 ‡∏Ñ‡∏ô / 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Äî ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞ ‚Äú‡πÅ‡∏™‡∏î‡∏á‚Äù ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>

        <div class="pills">
          <span class="pill badgeWait">‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
          <span class="pill">üîí 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå</span>
          <span class="pill">üéÅ ‡πÑ‡∏î‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</span>
        </div>

        <div class="label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
        <input id="phone" class="input" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111" maxlength="20"/>

        <div class="row">
          <button id="btnCheck" class="btnAlt" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
          <button id="btnJoin" class="btnMain" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
        </div>

        <div class="row">
          <button id="btnPoll" class="btnAlt" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</button>
        </div>

        <div id="msg" class="msg"></div>

        <div class="hr"></div>
        <div class="small">
          * ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö <span class="kbd">365</span> ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ<br/>
          * ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î <span class="kbd">10 ‡πÄ‡∏ó‡πà‡∏≤</span> ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ <span class="kbd">10 ‡πÄ‡∏ó‡πà‡∏≤</span><br/>
          * ‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ = ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≥/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á/‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå
        </div>
      </div>
    </div>
  </section>

  <!-- ====== SCREEN B: ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î (‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á APPROVED ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) ====== -->
  <section id="screenCode" class="screen">
    <div class="card">
      <div class="top">
        <div class="h1">üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
        <div class="sub">‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</div>

        <div class="codeCard">
          <div class="bigTitle">üîë ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>

          <div class="codeBox">
            <div id="code" class="code">-</div>
            <button id="btnCopy" class="copyBtn" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          </div>

          <a class="goLink" href="https://rumruay365.uk/events/free-credit" target="_blank" rel="noopener">
            üëâ ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ
          </a>

          <div class="small" style="margin-top:10px">
            * ‡∏´‡∏≤‡∏Å‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á ‚Äú‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‚Äù ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button id="btnBack" class="btnAlt" type="button">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          <button id="btnPoll2" class="btnMain" type="button">‡∏£‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        </div>

        <div id="msg2" class="msg"></div>
      </div>
    </div>
  </section>

</div>

<script>
/* ====== CONFIG (‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà) ====== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyokjZuq_w45cvwNjSGcjlcH1xpMLi_0K7jG84a5sm7EuIKTDIBF9Uzw4_yisVP9KtTJA/exec";

/* ====== UI Helpers ====== */
const $ = (id)=>document.getElementById(id);

function showScreen(name){
  $("screenWait").classList.remove("active");
  $("screenCode").classList.remove("active");
  $(name).classList.add("active");
}

function showMsg(id, text, type){
  const el = $(id);
  el.style.display="block";
  el.className="msg " + (type||"");
  el.textContent = text;
}
function hideMsg(id){
  const el=$(id);
  el.style.display="none";
  el.textContent="";
  el.className="msg";
}

function normalizePhone(v){
  let s=String(v||"").trim();
  const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"), String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p) ? p : "";
}

/* ====== Device Profile (‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå) ====== */
async function getWebGLInfo(){
  try{
    const c=document.createElement("canvas");
    const gl=c.getContext("webgl")||c.getContext("experimental-webgl");
    if(!gl) return {glv:"", glr:""};
    const dbg=gl.getExtension("WEBGL_debug_renderer_info");
    const glv=dbg?gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL):"";
    const glr=dbg?gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL):"";
    return {glv:String(glv||""), glr:String(glr||"")};
  }catch(_){ return {glv:"", glr:""}; }
}

async function buildParams(phone){
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || "";
  const scrW = String(screen.width||0);
  const scrH = String(screen.height||0);
  const dpr  = String(window.devicePixelRatio||1);
  const cd   = String(screen.colorDepth||0);
  const plat = String(navigator.platform||"");
  const hc   = navigator.hardwareConcurrency ? String(navigator.hardwareConcurrency) : "0";
  const dm   = (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "1" : "0";
  const lang = String(navigator.language||"").slice(0,20);
  const mtp  = (navigator.maxTouchPoints!=null) ? String(navigator.maxTouchPoints) : "0";
  const touch= ("ontouchstart" in window) ? "1" : "0";
  const ua   = String(navigator.userAgent||"").slice(0,500);

  const gl = await getWebGLInfo();
  const glv = String(gl.glv||"").slice(0,120);
  const glr = String(gl.glr||"").slice(0,200);

  return {
    phone,
    tz, scrW, scrH, dpr, cd, plat, hc, dm, lang, mtp, touch,
    ua,
    screen: `${scrW}x${scrH}@${dpr}`,
    webgl: `${glv}|${glr}`,
    glv, glr
  };
}

/* ====== JSONP ====== */
function jsonp(params){
  return new Promise((resolve, reject)=>{
    const cb = "cb_" + Math.random().toString(36).slice(2);
    params.callback = cb;
    params._ts = Date.now();
    const s = document.createElement("script");
    s.src = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    window[cb] = (data)=>{
      try{ delete window[cb]; }catch(_){ window[cb]=undefined; }
      s.remove();
      resolve(data);
    };
    s.onerror = ()=>{
      try{ delete window[cb]; }catch(_){ window[cb]=undefined; }
      s.remove();
      reject(new Error("JSONP_ERROR"));
    };
    document.body.appendChild(s);
  });
}

/* ====== Flow ====== */
let lastPhone = "";

async function doCheck(){
  hideMsg("msg"); hideMsg("msg2");
  const p = normalizePhone($("phone").value);
  if(!p) return showMsg("msg","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (06/08/09 10 ‡∏´‡∏•‡∏±‡∏Å)","bad");

  lastPhone = p;
  showMsg("msg","‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...","");
  const prm = await buildParams(p);
  const d = await jsonp({action:"check", ...prm}).catch(()=>null);
  if(!d) return showMsg("msg","‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","bad");

  if(d.ok && d.exists===false){
    showMsg("msg", d.msg || "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ", "ok");
    $("btnJoin").disabled = false;
  }else{
    showMsg("msg", d.msg || "‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß", (d.status==="APPROVED" ? "ok" : "bad"));
    $("btnJoin").disabled = true;
  }
}

async function doRegister(){
  hideMsg("msg");
  const p = normalizePhone($("phone").value);
  if(!p) return showMsg("msg","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","bad");

  lastPhone = p;
  showMsg("msg","‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...","");
  const prm = await buildParams(p);
  const d = await jsonp({action:"register", ...prm}).catch(()=>null);
  if(!d) return showMsg("msg","‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","bad");
  if(!d.ok) return showMsg("msg", d.msg || "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "bad");

  showMsg("msg", d.msg || "‚úÖ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥", "ok");
  $("btnJoin").disabled = true;
}

function openCodeScreen(code){
  $("code").textContent = code || "-";
  showScreen("screenCode");
}

async function doPoll(targetMsgId){
  hideMsg(targetMsgId);
  const p = normalizePhone($("phone").value || lastPhone);
  if(!p) return showMsg(targetMsgId,"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","bad");

  lastPhone = p;
  showMsg(targetMsgId,"‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...","");
  const prm = await buildParams(p);
  const d = await jsonp({action:"poll", ...prm}).catch(()=>null);
  if(!d) return showMsg(targetMsgId,"‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","bad");
  if(!d.ok) return showMsg(targetMsgId, d.msg || "‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "bad");

  // ‚úÖ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ APPROVED ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  if(d.status==="APPROVED" && d.promo_code){
    showMsg(targetMsgId,"üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î...","ok");
    openCodeScreen(d.promo_code);
    return;
  }

  showMsg(targetMsgId, d.msg || ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: "+(d.status||"UNKNOWN")), "");
}

/* ====== Bind ====== */
$("btnCheck").addEventListener("click", doCheck);
$("btnJoin").addEventListener("click", doRegister);
$("btnPoll").addEventListener("click", ()=>doPoll("msg"));

$("btnBack").addEventListener("click", ()=>{
  showScreen("screenWait");
});
$("btnPoll2").addEventListener("click", ()=>doPoll("msg2"));

$("btnCopy").addEventListener("click", async ()=>{
  const t = ($("code").textContent||"").trim();
  if(!t || t==="-" ) return;
  try{
    await navigator.clipboard.writeText(t);
    showMsg("msg2","‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß","ok");
  }catch(_){
    const ta=document.createElement("textarea");
    ta.value=t;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    showMsg("msg2","‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß","ok");
  }
});
</script>

<!-- ‚ú® ‡∏Å‡∏•‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ö‡∏≤‡∏°‡∏≤‡∏Å) -->
<script>
(function(){
  const c=document.createElement("canvas");
  c.style.position="fixed";
  c.style.inset="0";
  c.style.pointerEvents="none";
  c.style.zIndex="1";
  document.body.appendChild(c);

  const ctx=c.getContext("2d");
  let w=0,h=0,pts=[];
  function resize(){
    w=c.width=window.innerWidth||document.documentElement.clientWidth||0;
    h=c.height=window.innerHeight||document.documentElement.clientHeight||0;
  }
  window.addEventListener("resize", resize, {passive:true});
  resize();

  const N = 36;
  for(let i=0;i<N;i++){
    pts.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.6+0.6,s:Math.random()*0.6+0.3,a:Math.random()*0.35+0.35});
  }

  function draw(){
    ctx.clearRect(0,0,w,h);
    for(const p of pts){
      ctx.fillStyle=`rgba(255,215,0,${p.a})`;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
      p.y += p.s;
      p.x += Math.sin(p.y/90)*0.25;
      if(p.y>h+10){ p.y=-10; p.x=Math.random()*w; }
    }
    requestAnimationFrame(draw);
  }
  draw();
})();
</script>

</body>
</html>
