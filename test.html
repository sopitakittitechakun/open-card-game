<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏°</title>
<meta name="color-scheme" content="dark"/>
<style>
:root{
  --bg:#0b0b0b; --card:#141414; --line:rgba(255,255,255,.12);
  --txt:#fff; --muted:#cfcfcf;
  --accent:#ff2b2b; --accent2:#b80000;
  --ok:#36d399; --bad:#ff5a5f;
}
*{box-sizing:border-box}
body{
  margin:0;padding:24px;
  font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
  background:radial-gradient(900px 500px at 50% -10%, rgba(255,60,60,.15), transparent 60%), var(--bg);
  color:var(--txt);
}
.card{
  max-width:560px;margin:0 auto;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:24px; padding:18px;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}
.hero{
  width:100%; border-radius:16px; display:block;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.25);
}
h1{font-size:20px;margin:12px 0 6px}
p{margin:0 0 14px;color:var(--muted);line-height:1.6}
label{display:block;margin:10px 0 6px;color:var(--muted)}
input{
  width:100%;padding:12px 14px;border-radius:14px;
  border:1px solid var(--line);background:#0f0f0f;color:#fff;font-size:16px;
}
.row{display:flex;gap:10px;margin-top:12px}
button{
  flex:1;padding:12px 14px;border-radius:14px;border:0;
  font-size:16px;font-weight:900;color:#fff;cursor:pointer;
}
.btnAlt{background:#2a2a2a}
.btnMain{background:linear-gradient(135deg,var(--accent),var(--accent2))}
button:disabled{opacity:.55;cursor:not-allowed}
.msg{
  margin-top:12px;padding:12px;border-radius:14px;
  border:1px solid var(--line);background:rgba(0,0,0,.25);
  white-space:pre-line;display:none;line-height:1.6;
}
.ok{border-color:rgba(54,211,153,.4)}
.err{border-color:rgba(255,90,95,.45)}
.hint{font-size:12px;color:#bfbfbf;margin-top:10px;line-height:1.6}

/* ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
.screen{display:none}
.screen.active{display:block}

/* ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î */
.codeWrap{
  margin-top:12px;
  padding:12px;
  border-radius:14px;
  border:1px dashed rgba(255,255,255,.25);
  background:rgba(0,0,0,.25);
  display:flex;
  align-items:center;
  gap:10px;
}
.codeText{
  flex:1;
  font-weight:1000;
  font-size:18px;
  letter-spacing:1px;
  user-select:all;
}
.copyBtn{
  padding:10px 14px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  font-weight:900;
  color:#fff;
  background:linear-gradient(135deg,#22c55e,#16a34a);
}
.copyBtn.copied{background:linear-gradient(135deg,#3b82f6,#2563eb)}

.goLink{
  display:block;
  margin-top:12px;
  padding:14px;
  text-align:center;
  font-weight:1000;
  border-radius:14px;
  color:#fff;
  background:linear-gradient(135deg,#ff2b2b,#b80000);
  text-decoration:none;
}
.goLink:active{transform:scale(.99)}

/* modal */
.modal{
  position:fixed; inset:0; background:rgba(0,0,0,.70);
  display:none; align-items:center; justify-content:center; padding:18px; z-index:9999;
}
.modal.show{display:flex}
.modalCard{
  width:min(560px, 100%); border-radius:18px; padding:16px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  box-shadow:0 20px 60px rgba(0,0,0,.75);
}
.modalTitle{font-weight:900;font-size:18px;margin-bottom:10px}
.modalText{color:#e9e9e9;line-height:1.7;margin-bottom:12px}
.modalBtnMain{
  width:100%; padding:12px 14px; border-radius:14px; border:0;
  font-weight:900; cursor:pointer; color:#fff;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}
.smallNote{font-size:12px;color:#cfcfcf;margin-top:8px;opacity:.9}
</style>
</head>

<body>

<!-- =======================
   SCREEN 1: ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
======================= -->
<div id="screenWait" class="screen active">
  <div class="card">

    <img class="hero"
      src="https://img5.pic.in.th/file/secure-sv1/photo_--_--2bb7d3a2870ef8d6.jpg"
      alt="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ"
      loading="eager" decoding="async"/>

    <h1>üéÅ ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏à‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 38,888 ‡∏ö‡∏≤‡∏ó üéÅ</h1>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏∏‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 50 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</p>

    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
    <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

    <div class="row">
      <button id="btnCheck" class="btnAlt" type="button" disabled>‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
      <button id="btnJoin"  class="btnMain" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
    </div>

    <button id="btnPoll" class="btnAlt" type="button" style="margin-top:10px;width:100%" disabled>
      ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)
    </button>

    <div id="msg" class="msg"></div>

    <div class="hint">
      * ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á ‚Äú‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‚Äù<br>
      * ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ<br>
      * ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
      * üîí ‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î: 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå (‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå)
      <div class="smallNote" id="devNote"></div>
    </div>

  </div>
</div>

<!-- =======================
   SCREEN 2: ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î (APPROVED ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
======================= -->
<div id="screenCode" class="screen">
  <div class="card">
    <img class="hero"
      src="https://img5.pic.in.th/file/secure-sv1/photo_--_--2bb7d3a2870ef8d6.jpg"
      alt="‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î"
      loading="eager" decoding="async"/>

    <h1>üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß! ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
    <p>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>

    <div class="codeWrap">
      <div id="promoCode" class="codeText">RRXXXXXXXX</div>
      <button id="btnCopy" class="copyBtn" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
    </div>

    <a id="goRedeem" class="goLink" href="https://rumruay365.uk/events/free-credit" target="_blank" rel="noopener">
      üëâ ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ
    </a>

    <div id="msg2" class="msg"></div>

    <div class="row" style="margin-top:12px">
      <button id="btnBack" class="btnAlt" type="button">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
      <button id="btnPoll2" class="btnMain" type="button">‡∏£‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
    </div>

    <div class="hint">
      * ‡∏´‡∏≤‡∏Å‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å ‚Äú‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‚Äù ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞
    </div>
  </div>
</div>

<!-- Modal ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô -->
<div id="ruleModal" class="modal" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true">
    <div class="modalTitle">üìå ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô)</div>
    <div class="modalText">
      1) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó<br>
      2) ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
      3) üîí 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>
      4) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
    </div>
    <button class="modalBtnMain" id="modalAcknowledge" type="button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
  </div>
</div>

<script>
/* üî¥ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå exec ‡∏Ç‡∏≠‡∏á Google Apps Script */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyokjZuq_w45cvwNjSGcjlcH1xpMLi_0K7jG84a5sm7EuIKTDIBF9Uzw4_yisVP9KtTJA/exec";
const REDEEM_URL = "https://rumruay365.uk/events/free-credit";

/* DOM */
const $phone=document.getElementById("phone");
const $btnCheck=document.getElementById("btnCheck");
const $btnJoin=document.getElementById("btnJoin");
const $btnPoll=document.getElementById("btnPoll");
const $msg=document.getElementById("msg");
const $msg2=document.getElementById("msg2");
const $promoCode=document.getElementById("promoCode");
const $btnCopy=document.getElementById("btnCopy");
const $btnBack=document.getElementById("btnBack");
const $btnPoll2=document.getElementById("btnPoll2");
const $goRedeem=document.getElementById("goRedeem");
const $devNote=document.getElementById("devNote");

const $ruleModal=document.getElementById("ruleModal");
const $modalAck=document.getElementById("modalAcknowledge");

function openRule(){ $ruleModal.classList.add("show"); document.body.style.overflow="hidden"; }
function closeRule(){ $ruleModal.classList.remove("show"); document.body.style.overflow=""; }
$modalAck.onclick=closeRule;

function showScreen(which){
  document.getElementById("screenWait").classList.remove("active");
  document.getElementById("screenCode").classList.remove("active");
  document.getElementById(which).classList.add("active");
}

function showMsg(el, t, type="ok"){
  el.style.display="block";
  el.className="msg "+(type==="err"?"err":"ok");
  el.textContent=t;
}
function hideMsg(el){ el.style.display="none"; el.textContent=""; }
function note(t){ $devNote.textContent = t || ""; }

function setButtons(enabled){
  $btnCheck.disabled = !enabled;
  $btnPoll.disabled  = !enabled;
  if(!enabled) $btnJoin.disabled = true;
}

/* phone normalize */
function normalizePhone(v){
  let s=String(v||"").trim(); const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p)?p:"";
}

/* JSONP */
function jsonp(params){
  return new Promise((res,rej)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    params.callback=cb;
    params._ts=Date.now();
    const s=document.createElement("script");
    s.src = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    window[cb]=(d)=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); res(d); };
    s.onerror=()=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); rej(new Error("JSONP_ERROR")); };
    document.body.appendChild(s);
  });
}

/* copy */
$btnCopy.onclick=async()=>{
  const t=$promoCode.textContent.trim(); if(!t) return;
  try{
    await navigator.clipboard.writeText(t);
    $btnCopy.classList.add("copied");
    setTimeout(()=> $btnCopy.classList.remove("copied"), 1200);
    showMsg($msg2,"‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß","ok");
  }catch(_){
    showMsg($msg2,"‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß","ok");
  }
};

/* ======================================================
   ‚úÖ ‡∏™‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ GAS ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì device_key ‡πÄ‡∏≠‡∏á
====================================================== */
let READY=false;
let PROF=null;

function getProf(){
  const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone || "");
  const scrW = screen.width || 0;
  const scrH = screen.height || 0;
  const dpr  = window.devicePixelRatio || 1;
  const cd   = screen.colorDepth || 0;
  const plat = (navigator.platform || "");
  const hc   = navigator.hardwareConcurrency || 0;
  const dm   = navigator.deviceMemory || 0;
  const lang = navigator.language || "";
  const mtp  = navigator.maxTouchPoints || 0;
  const touch = ("ontouchstart" in window) ? 1 : 0;

  let glv="", glr="";
  try{
    const c=document.createElement("canvas");
    const gl=c.getContext("webgl")||c.getContext("experimental-webgl");
    if(gl){
      const dbg = gl.getExtension("WEBGL_debug_renderer_info");
      glv = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);
      glr = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
    }
  }catch(_){}

  return {
    tz,
    scrW, scrH, dpr, cd,
    plat, hc, dm,
    lang, mtp, touch,
    glv: String(glv||"").slice(0,120),
    glr: String(glr||"").slice(0,200),
  };
}

async function ensureReady(){
  if(READY && PROF) return PROF;
  setButtons(false);
  PROF=getProf();
  READY=true;
  note(`Device: ${PROF.scrW}x${PROF.scrH}@${PROF.dpr} | ${PROF.tz}`);
  setButtons(true);
  return PROF;
}
window.addEventListener("load", ()=>ensureReady());

async function payloadBase(phone){
  const p = await ensureReady();
  const ua = navigator.userAgent || "";
  return {
    phone,
    ua,
    tz: p.tz,
    scrW: p.scrW, scrH: p.scrH, dpr: p.dpr, cd: p.cd,
    plat: p.plat, hc: p.hc, dm: p.dm,
    lang: p.lang, mtp: p.mtp, touch: p.touch,
    glv: p.glv, glr: p.glr,
    screen: `${p.scrW}x${p.scrH}@${p.dpr}`,
    webgl: `${p.glv}|${p.glr}`.slice(0,220),
  };
}

/* actions */
$btnCheck.onclick=async()=>{
  hideMsg($msg); hideMsg($msg2);
  $btnJoin.disabled=true;

  const p=normalizePhone($phone.value);
  if(!p){ showMsg($msg,"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }

  const base = await payloadBase(p);
  showMsg($msg,"‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...","ok");
  const d=await jsonp({action:"check", ...base}).catch(()=>null);

  if(!d){ showMsg($msg,"‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }
  if(!d.ok){ showMsg($msg, d.msg || "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç","err"); return; }

  showMsg($msg, d.msg || "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ","ok");
  $btnJoin.disabled=false;
};

$btnJoin.onclick=async()=>{
  hideMsg($msg); hideMsg($msg2);

  const p=normalizePhone($phone.value);
  if(!p){ showMsg($msg,"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }

  const base = await payloadBase(p);
  showMsg($msg,"‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°...","ok");
  const d=await jsonp({action:"register", ...base}).catch(()=>null);

  if(!d){ showMsg($msg,"‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }
  if(!d.ok){ showMsg($msg, d.msg || "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); return; }

  showMsg($msg, d.msg || "‚úÖ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥","ok");
  openRule();
};

/* ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: APPROVED ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ñ‡∏∂‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î */
async function pollAndMaybeShowCode(msgEl){
  hideMsg(msgEl);

  const p=normalizePhone($phone.value);
  if(!p){ showMsg(msgEl,"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }

  const base = await payloadBase(p);
  showMsg(msgEl,"‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...","ok");
  const d=await jsonp({action:"poll", ...base}).catch(()=>null);

  if(!d){ showMsg(msgEl,"‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }
  if(!d.ok){ showMsg(msgEl, d.msg || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°","err"); return; }

  if(d.status==="APPROVED" && d.promo_code){
    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    $promoCode.textContent = d.promo_code;
    $goRedeem.href = REDEEM_URL;
    showScreen("screenCode");
    showMsg($msg2,"üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢","ok");
    openRule();
    return;
  }

  if(d.status==="PENDING"){ showMsg(msgEl,"‚è≥ ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥","ok"); return; }
  if(d.status==="REJECTED"){ showMsg(msgEl,"‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô","err"); return; }
  if(d.status==="USED"){ showMsg(msgEl,"‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß","err"); return; }

  showMsg(msgEl, d.msg || ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: "+(d.status||"UNKNOWN")), "ok");
}

$btnPoll.onclick = ()=> pollAndMaybeShowCode($msg);
$btnPoll2.onclick = ()=> pollAndMaybeShowCode($msg2);

$btnBack.onclick = ()=>{
  showScreen("screenWait");
  hideMsg($msg2);
};
</script>

</body>
</html>
