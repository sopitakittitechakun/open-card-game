<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RR365 Admin | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÅ‡∏¢‡∏Å)</title>
<meta name="color-scheme" content="dark"/>
<style>
:root{--bg:#0b0b0b;--card:#141414;--line:rgba(255,255,255,.12);--txt:#fff;--muted:#cfcfcf;--a:#ff2b2b;--a2:#b80000;--ok:#36d399;--bad:#ff5a5f}
*{box-sizing:border-box}
body{margin:0;padding:22px;font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;background:radial-gradient(900px 520px at 50% -10%, rgba(255,60,60,.16), transparent 60%),var(--bg);color:var(--txt)}
.wrap{max-width:900px;margin:0 auto;background:rgba(255,255,255,.05);border:1px solid var(--line);border-radius:22px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.6)}
h1{margin:0 0 10px;font-size:20px}
p{margin:0 0 14px;color:var(--muted);line-height:1.6}
.box{background:rgba(0,0,0,.22);border:1px solid var(--line);border-radius:18px;padding:14px}
label{display:block;margin:10px 0 6px;color:var(--muted)}
input,select{width:100%;padding:12px 14px;border-radius:14px;border:1px solid var(--line);background:#0f0f0f;color:#fff;font-size:16px}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
button{padding:12px 14px;border-radius:14px;border:0;font-weight:900;color:#fff;cursor:pointer}
.main{background:linear-gradient(135deg,var(--a),var(--a2))}
.alt{background:#2a2a2a}
.msg{margin-top:12px;padding:12px;border-radius:14px;border:1px solid var(--line);background:rgba(0,0,0,.25);white-space:pre-line;display:none}
.ok{border-color:rgba(54,211,153,.45)} .err{border-color:rgba(255,90,95,.55)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border-bottom:1px solid rgba(255,255,255,.10);padding:10px;text-align:left;font-size:14px}
small{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>üõ°Ô∏è RR365 Admin (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)</h1>
  <p>‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö ‚Äú‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÅ‡∏¢‡∏Å‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡πÄ‡∏î‡∏¥‡∏°)</p>

  <div class="box">
    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
    <input id="phone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111" inputmode="numeric"/>

    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</label>
    <input id="note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡πà‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß / ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö"/>

    <div class="row">
      <button class="main" id="btnApprove">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
      <button class="alt"  id="btnReject">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
      <button class="alt"  id="btnUsed">‚ôªÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô USED</button>
      <button class="alt"  id="btnGet">üîé ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <hr style="border:0;border-top:1px solid rgba(255,255,255,.12);margin:14px 0">

    <div class="row">
      <select id="status">
        <option value="PENDING">PENDING</option>
        <option value="APPROVED">APPROVED</option>
        <option value="REJECTED">REJECTED</option>
        <option value="USED">USED</option>
      </select>
      <button class="alt" id="btnList">üìÑ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </div>

    <div id="msg" class="msg"></div>

    <div id="listBox" style="display:none">
      <table>
        <thead><tr><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡πÇ‡∏Ñ‡πâ‡∏î</th><th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</th><th></th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
      <small>‡∏Å‡∏î ‚Äú‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</small>
    </div>
  </div>
</div>

<script>
/** ‚úÖ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå /exec ‡∏Ç‡∏≠‡∏á ‚Äú‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÅ‡∏¢‡∏Å‚Äù **/
const ADMIN_API_URL = "https://script.google.com/macros/s/AKfycby-l4O3BN70RtNMmGEJNRtNWFnsj-gkScr2MHwrd486IrhBjaV1Jt3p-3FHNjDC3Rpt1g/exec";
/** ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö ADMIN_TOKEN ‡πÉ‡∏ô Code.gs **/
const ADMIN_TOKEN   = "PUT_A_LONG_RANDOM_TOKEN";

const $ = (id)=>document.getElementById(id);
const msgBox = $("msg");
const listBox = $("listBox");
const tbody = $("tbody");

function show(text, ok=true){
  msgBox.style.display="block";
  msgBox.className = "msg " + (ok ? "ok" : "err");
  msgBox.textContent = text;
}

function normPhone(v){
  let s=String(v||"").trim();
  const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p) ? p : "";
}

async function callApi(payload){
  const res = await fetch(ADMIN_API_URL, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });
  return await res.json();
}

async function act(action){
  const phone = normPhone($("phone").value);
  const note  = ($("note").value||"").trim();
  if(!phone){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", false); return; }
  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...");
  const d = await callApi({ action, token: ADMIN_TOKEN, phone, note }).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πá‡∏Ñ ADMIN_API_URL / Deploy)", false); return; }
  show(JSON.stringify(d, null, 2), !!d.ok);
}

$("btnApprove").onclick = ()=>act("approve");
$("btnReject").onclick  = ()=>act("reject");
$("btnUsed").onclick    = ()=>act("used");

$("btnGet").onclick = async ()=>{
  const phone = normPhone($("phone").value);
  if(!phone){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", false); return; }
  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
  const d = await callApi({ action:"get", token: ADMIN_TOKEN, phone }).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", false); return; }
  show(JSON.stringify(d, null, 2), !!d.ok);
};

$("btnList").onclick = async ()=>{
  const status = $("status").value;
  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ " + status + " ...");
  const d = await callApi({ action:"list", token: ADMIN_TOKEN, status, limit: 80 }).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", false); return; }
  if(!d.ok){ show(JSON.stringify(d,null,2), false); return; }

  tbody.innerHTML = "";
  (d.items||[]).forEach(it=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `
      <td>${it.phone||""}</td>
      <td>${it.status||""}</td>
      <td>${it.promo_code||""}</td>
      <td>${it.updated_at||""}</td>
      <td><button class="alt" type="button">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå</button></td>
    `;
    tr.querySelector("button").onclick = ()=>{
      $("phone").value = it.phone||"";
      window.scrollTo({top:0, behavior:"smooth"});
    };
    tbody.appendChild(tr);
  });

  listBox.style.display = "block";
  show("‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (d.count||0) + " ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", true);
};
</script>
</body>
</html>
