<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏°</title>
<meta name="color-scheme" content="dark"/>

<style>
:root{
  --bg:#0b0b0b; --card:#141414; --line:rgba(255,255,255,.12);
  --txt:#fff; --muted:#cfcfcf;
  --accent:#ff2b2b; --accent2:#b80000;
  --ok:#36d399; --bad:#ff5a5f;
}
*{box-sizing:border-box}
body{
  margin:0;padding:24px;
  font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
  background:radial-gradient(900px 500px at 50% -10%, rgba(255,60,60,.15), transparent 60%), var(--bg);
  color:var(--txt);
}
.card{
  max-width:560px;margin:0 auto;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:24px; padding:18px;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}
.hero{
  width:100%; border-radius:16px; display:block;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.25);
}
h1{font-size:20px;margin:12px 0 6px}
p{margin:0 0 14px;color:var(--muted);line-height:1.6}
label{display:block;margin:10px 0 6px;color:var(--muted)}
input{
  width:100%;padding:12px 14px;border-radius:14px;
  border:1px solid var(--line);background:#0f0f0f;color:#fff;font-size:16px;
}
.row{display:flex;gap:10px;margin-top:12px}
button{
  flex:1;padding:12px 14px;border-radius:14px;border:0;
  font-size:16px;font-weight:800;color:#fff;cursor:pointer;
}
.btnAlt{background:#2a2a2a}
.btnMain{background:linear-gradient(135deg,var(--accent),var(--accent2))}
button:disabled{opacity:.55;cursor:not-allowed}
.msg{
  margin-top:12px;padding:12px;border-radius:14px;
  border:1px solid var(--line);background:rgba(0,0,0,.25);
  white-space:pre-line;display:none;line-height:1.6;
}
.ok{border-color:rgba(54,211,153,.4)}
.err{border-color:rgba(255,90,95,.45)}
.hint{font-size:12px;color:#bfbfbf;margin-top:10px;line-height:1.6}

.copyBox{
  margin-top:12px;padding:12px;border-radius:14px;
  border:1px dashed rgba(255,255,255,.25);background:rgba(0,0,0,.25);
  display:none;align-items:center;gap:10px;
}
.copyCode{flex:1;font-weight:900;font-size:16px;letter-spacing:1px;user-select:all}
.copyBtn{
  padding:10px 14px;border-radius:12px;border:0;cursor:pointer;
  font-weight:900;color:#fff;background:linear-gradient(135deg,#22c55e,#16a34a);
}
.copyBtn.copied{background:linear-gradient(135deg,#3b82f6,#2563eb)}

.goLink{
  display:none;
  margin-top:12px;
  padding:14px;
  text-align:center;
  font-weight:900;
  border-radius:14px;
  color:#fff;
  background:linear-gradient(135deg,#ff2b2b,#b80000);
  text-decoration:none;
}

.modal{
  position:fixed; inset:0; background:rgba(0,0,0,.70);
  display:none; align-items:center; justify-content:center; padding:18px; z-index:9999;
}
.modal.show{display:flex}
.modalCard{
  width:min(560px, 100%); border-radius:18px; padding:16px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  box-shadow:0 20px 60px rgba(0,0,0,.75);
}
.modalTitle{font-weight:900;font-size:18px;margin-bottom:10px}
.modalText{color:#e9e9e9;line-height:1.7;margin-bottom:12px}
.modalBtnMain{
  width:100%; padding:12px 14px; border-radius:14px; border:0;
  font-weight:900; cursor:pointer; color:#fff;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}
.smallNote{font-size:12px;color:#cfcfcf;margin-top:8px;opacity:.9}
</style>

<!-- ‚úÖ FingerprintJS (‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå) -->
<script src="https://openfpcdn.io/fingerprintjs/v4"></script>
</head>

<body>
<div class="card">

<img
  id="heroImg"
  class="hero"
  src="https://img5.pic.in.th/file/secure-sv1/photo_--_--2bb7d3a2870ef8d6.jpg"
  alt="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ"
  loading="eager"
  decoding="async"
/>

<h1>üéÅ ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏à‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 38,888 ‡∏ö‡∏≤‡∏ó üéÅ</h1>
<p>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î (‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</p>

<label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
<input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

<div class="row">
  <button id="btnCheck" class="btnAlt" type="button" disabled>‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
  <button id="btnJoin" class="btnMain" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
</div>

<button id="btnPoll" class="btnAlt" type="button" style="margin-top:10px;width:100%" disabled>
  ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î
</button>

<div id="msg" class="msg"></div>

<div id="copyWrap" class="copyBox">
  <div id="promoCode" class="copyCode">RRXXXXXXXX</div>
  <button id="btnCopy" class="copyBtn" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
</div>

<a id="goRedeem" class="goLink" href="https://rumruay365.uk/events/free-credit" target="_blank" rel="noopener">
  üëâ ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ
</a>

<div class="hint">
* ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ<br>
* ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
* üîí ‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î: 1 ‡∏Ñ‡∏ô / 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå)
<div class="smallNote" id="devNote"></div>
</div>

</div>

<div id="ruleModal" class="modal" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true">
    <div class="modalTitle">üìå ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô)</div>
    <div class="modalText">
      1) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó<br>
      2) ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
      3) üîí 1 ‡∏Ñ‡∏ô / 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå)<br>
      4) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
    </div>
    <button class="modalBtnMain" id="modalAcknowledge" type="button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
  </div>
</div>

<script>
/* üî¥ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå exec ‡∏Ç‡∏≠‡∏á Google Apps Script (Deploy Web App) */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyviT8Hah3OwcbS9CrlFsF-JM0x4OGdHWcComsURO7KBMaKz6N4FSA65gt8kxLOA-MwdQ/exec";

/* ‚úÖ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î */
const REDEEM_URL = "https://rumruay365.uk/events/free-credit";

/* ============ DOM ============ */
const $phone=document.getElementById("phone");
const $btnCheck=document.getElementById("btnCheck");
const $btnJoin=document.getElementById("btnJoin");
const $btnPoll=document.getElementById("btnPoll");
const $msg=document.getElementById("msg");
const $copyWrap=document.getElementById("copyWrap");
const $promoCode=document.getElementById("promoCode");
const $btnCopy=document.getElementById("btnCopy");
const $ruleModal=document.getElementById("ruleModal");
const $modalAck=document.getElementById("modalAcknowledge");
const $goRedeem=document.getElementById("goRedeem");
const $devNote=document.getElementById("devNote");

/* ============ UI helpers ============ */
function openRule(){ $ruleModal.classList.add("show"); document.body.style.overflow="hidden"; }
function closeRule(){ $ruleModal.classList.remove("show"); document.body.style.overflow=""; }
$modalAck.onclick=closeRule;

function show(t,type="ok"){
  $msg.style.display="block";
  $msg.className="msg "+(type==="err"?"err":"ok");
  $msg.textContent=t;
}
function hideMsg(){ $msg.style.display="none"; $msg.textContent=""; }
function hideCopy(){
  $copyWrap.style.display="none";
  $promoCode.textContent="RRXXXXXXXX";
  $goRedeem.style.display="none";
  $goRedeem.href = REDEEM_URL;
}
function setButtons(enabled){
  // btnJoin ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ check ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
  $btnCheck.disabled = !enabled;
  $btnPoll.disabled  = !enabled;
  if(!enabled) $btnJoin.disabled = true;
}
function note(text){ $devNote.textContent = text || ""; }

/* ============ Phone normalize ============ */
function normalizePhone(v){
  let s=String(v||"").trim(); const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p)?p:"";
}

/* ============ JSONP ============ */
function jsonp(params){
  return new Promise((res,rej)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    params.callback=cb;
    params._ts=Date.now();
    const s=document.createElement("script");
    s.src = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    window[cb]=(d)=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); res(d); };
    s.onerror=()=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); rej(new Error("JSONP_ERROR")); };
    document.body.appendChild(s);
  });
}

/* ============ Copy ============ */
$btnCopy.onclick=async()=>{
  const t=$promoCode.textContent.trim(); if(!t) return;
  try{
    await navigator.clipboard.writeText(t);
    $btnCopy.classList.add("copied");
    setTimeout(()=>$btnCopy.classList.remove("copied"),1200);
  }catch(_){}
};

/* =========================================================
   ‚úÖ DEVICE LOCK (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏°‡πà‡∏û‡∏ö device_id")
   - ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
   - Retry 3 ‡∏£‡∏≠‡∏ö
   - Timeout ‡∏Å‡∏±‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
   - ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î Chrome ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE/FB in-app ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏î‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å
========================================================= */
let DEVICE_ID = "";
let DEVICE_READY = false;

function simpleHash(str){
  let h=2166136261;
  for (let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return (h>>>0).toString(16).padStart(8,"0");
}

async function loadFpFallback(){
  if(window.FingerprintJS) return true;
  // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ö‡∏≤‡∏á‡∏ò‡∏µ‡∏°/‡∏õ‡∏•‡∏±‡πä‡∏Å‡∏≠‡∏¥‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ script ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡∏•‡∏≠‡∏á‡∏¢‡∏±‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  try{
    await new Promise((res,rej)=>{
      const s=document.createElement("script");
      s.src="https://openfpcdn.io/fingerprintjs/v4";
      s.async=true;
      s.onload=res;
      s.onerror=rej;
      document.head.appendChild(s);
    });
    return !!window.FingerprintJS;
  }catch(_){
    return false;
  }
}

async function buildDeviceId(){
  const ok = await loadFpFallback();
  if(!ok || !window.FingerprintJS) return "";

  const timeoutMs = 6500;

  try{
    const fp = await Promise.race([
      FingerprintJS.load(),
      new Promise((_,rej)=>setTimeout(()=>rej(new Error("FP_LOAD_TIMEOUT")), timeoutMs))
    ]);

    const r = await Promise.race([
      fp.get(),
      new Promise((_,rej)=>setTimeout(()=>rej(new Error("FP_GET_TIMEOUT")), timeoutMs))
    ]);

    const ua = navigator.userAgent || "";
    const lang = navigator.language || "";
    const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone || "");
    const suffix = simpleHash(ua + "|" + lang + "|" + tz).slice(0,8);

    return "fp_" + r.visitorId + "_" + suffix; // ‡∏¢‡∏≤‡∏ß‡∏û‡∏≠
  }catch(_){
    return "";
  }
}

function isInAppBrowser(){
  const ua = (navigator.userAgent || "").toLowerCase();
  // ‡∏Ñ‡∏£‡πà‡∏≤‡∏ß ‡πÜ: line / facebook / instagram / tiktok in-app
  return ua.includes("line") || ua.includes("fbav") || ua.includes("fban") || ua.includes("instagram") || ua.includes("tiktok");
}

async function ensureDeviceReady(){
  if(DEVICE_READY && DEVICE_ID) return DEVICE_ID;

  setButtons(false);
  note("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...");
  hideMsg();

  for(let i=1;i<=3;i++){
    const id = await buildDeviceId();
    if(id && id.length >= 16){
      DEVICE_ID = id;
      DEVICE_READY = true;
      note("Device Lock: " + DEVICE_ID);
      setButtons(true);
      return DEVICE_ID;
    }
    note(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå... (‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà ${i}/3)`);
    await new Promise(r=>setTimeout(r, 650));
  }

  note("");
  const extra = isInAppBrowser()
    ? "\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ (in-app) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ Chrome/Safari"
    : "\n‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Brave/AdBlock/Tracking Protection ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";

  show(
`‚ùå ‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (device_id)
‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ:
1) ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏ß‡∏¢ Chrome / Safari (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE/FB/TikTok in-app)
2) ‡∏õ‡∏¥‡∏î AdBlock/Brave Shield/Tracking Protection ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
3) ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà${extra}`,
"err");
  return "";
}

/* ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏à‡∏±‡∏ö device ‡∏Å‡πà‡∏≠‡∏ô */
window.addEventListener("load", async ()=>{
  await ensureDeviceReady();
});

/* payload base */
async function payloadBase(phone){
  const device_id = await ensureDeviceReady();
  if(!device_id) return null;
  const ua = navigator.userAgent || "";
  const lang = navigator.language || "";
  const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone || "");
  return { phone, device_id, ua, lang, tz };
}

/* ============ Actions ============ */
$btnCheck.onclick=async()=>{
  hideMsg(); hideCopy(); $btnJoin.disabled=true;
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }

  const base = await payloadBase(p);
  if(!base) return;

  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...");
  const d=await jsonp({action:"check", ...base}).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }

  if(!d.ok){ show(d.msg || "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç","err"); return; }

  show(d.msg || "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ","ok");
  $btnJoin.disabled=false;
};

$btnJoin.onclick=async()=>{
  hideMsg(); hideCopy();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }

  const base = await payloadBase(p);
  if(!base) return;

  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°...");
  const d=await jsonp({action:"register", ...base}).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }

  if(!d.ok){ show(d.msg || "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); return; }

  show(d.msg || "‚úÖ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥","ok");
  openRule();
};

$btnPoll.onclick=async()=>{
  hideMsg(); hideCopy();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }

  const base = await payloadBase(p);
  if(!base) return;

  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...");
  const d=await jsonp({action:"poll", ...base}).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }

  if(!d.ok){ show(d.msg || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°","err"); return; }

  if(d.status==="APPROVED" && d.promo_code){
    $promoCode.textContent=d.promo_code;
    $copyWrap.style.display="flex";
    $goRedeem.style.display="block";
    $goRedeem.href = REDEEM_URL;
    show("üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢\n‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‚Äù","ok");
    openRule();
    return;
  }

  if(d.status==="PENDING"){ show("‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô","ok"); return; }
  if(d.status==="REJECTED"){ show("‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô","err"); return; }
  if(d.status==="USED"){ show("‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß","err"); return; }

  show(d.msg || ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: "+(d.status||"UNKNOWN")),"ok");
};
</script>
</body>
</html>
