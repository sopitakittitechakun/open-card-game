<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RR365 Admin</title>
<style>
  :root{--bg:#0b0b0b;--card:#141414;--line:rgba(255,255,255,.12);--txt:#fff;--muted:#cfcfcf;--accent:#ff2b2b;--accent2:#b80000;}
  *{box-sizing:border-box}
  body{margin:0;padding:18px;font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;background:var(--bg);color:var(--txt)}
  .card{max-width:520px;margin:0 auto;border:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border-radius:18px;padding:16px}
  h1{margin:0 0 10px;font-size:18px}
  label{display:block;margin:10px 0 6px;color:var(--muted)}
  input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:#0f0f0f;color:#fff;font-size:15px}
  .row{display:flex;gap:10px;margin-top:12px}
  button{flex:1;border:0;border-radius:12px;padding:12px 12px;font-weight:900;cursor:pointer;color:#fff}
  .ok{background:linear-gradient(135deg,#22c55e,#16a34a)}
  .bad{background:linear-gradient(135deg,#ff2b2b,#b80000)}
  .alt{background:#2a2a2a}
  .msg{margin-top:12px;padding:12px;border-radius:12px;border:1px solid var(--line);background:rgba(0,0,0,.25);white-space:pre-line;display:none}
</style>
</head>
<body>
<div class="card">
  <h1>üõ°Ô∏è RR365 Admin (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò/USED)</h1>

  <label>‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
  <input id="token" placeholder="ADMIN_TOKEN"/>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

  <div class="row">
    <button class="ok"  id="btnApprove" type="button">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
    <button class="bad" id="btnReject"  type="button">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
  </div>

  <div class="row">
    <button class="alt" id="btnUsed" type="button">‚ôªÔ∏è ‡∏ï‡∏±‡πâ‡∏á USED</button>
  </div>

  <div class="msg" id="msg"></div>
</div>

<script>
const SCRIPT_URL = "<?= ScriptApp.getService().getUrl() ?>";

function show(t){
  const el=document.getElementById("msg");
  el.style.display="block";
  el.textContent=t;
}
function normalizePhone(v){
  let s=String(v||"").trim(); const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p)?p:"";
}
function jsonp(params){
  return new Promise((res,rej)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    params.callback=cb; params._ts=Date.now();
    const s=document.createElement("script");
    s.src = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    window[cb]=(d)=>{ try{delete window[cb];}catch(_){window[cb]=undefined;} s.remove(); res(d); };
    s.onerror=()=>{ try{delete window[cb];}catch(_){window[cb]=undefined;} s.remove(); rej(new Error("JSONP_ERROR")); };
    document.body.appendChild(s);
  });
}

async function adminOp(op){
  const token=document.getElementById("token").value.trim();
  const p=normalizePhone(document.getElementById("phone").value);
  if(!token) return show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô");
  if(!p) return show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...");
  const d = await jsonp({action:"admin_action", token, op, phone:p}).catch(()=>null);
  if(!d) return show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  if(!d.ok) return show("‚ùå "+(d.msg||"‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"));
  if(d.promo_code) return show(`‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${d.msg}\n‡πÇ‡∏Ñ‡πâ‡∏î: ${d.promo_code}`);
  return show("‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: "+(d.msg||"OK"));
}

document.getElementById("btnApprove").onclick=()=>adminOp("APPROVE");
document.getElementById("btnReject").onclick =()=>adminOp("REJECT");
document.getElementById("btnUsed").onclick   =()=>adminOp("USED");
</script>
</body>
</html>
