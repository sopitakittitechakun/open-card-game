<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏°</title>
<meta name="color-scheme" content="dark"/>

<style>
:root{
  --bg:#06060a;
  --card:#0f0f14;
  --line:rgba(255,255,255,.14);

  --txt:#ffffff;
  --muted:rgba(255,255,255,.78);

  --accent:#ff2b2b;
  --accent2:#b80000;

  --gold:#ffd56a;
  --ice:#7dd3fc;

  --ok:#36d399;
  --bad:#ff5a5f;

  --shadow: 0 26px 80px rgba(0,0,0,.75);
  --radius:24px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  padding:24px;
  font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
  color:var(--txt);
  background:
    radial-gradient(1100px 560px at 50% -10%, rgba(255,43,43,.22), transparent 60%),
    radial-gradient(900px 520px at 10% 10%, rgba(125,211,252,.14), transparent 62%),
    radial-gradient(900px 520px at 90% 20%, rgba(255,213,106,.12), transparent 65%),
    linear-gradient(180deg, #05050a 0%, #07060f 40%, #05050a 100%);
  overflow-x:hidden;
}

/* subtle star dust */
body:before{
  content:"";
  position:fixed; inset:0;
  background-image:
    radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.55) 50%, transparent 52%),
    radial-gradient(1px 1px at 22% 68%, rgba(255,255,255,.35) 50%, transparent 52%),
    radial-gradient(1px 1px at 35% 35%, rgba(255,255,255,.45) 50%, transparent 52%),
    radial-gradient(1px 1px at 48% 22%, rgba(255,255,255,.35) 50%, transparent 52%),
    radial-gradient(1px 1px at 60% 72%, rgba(255,255,255,.40) 50%, transparent 52%),
    radial-gradient(1px 1px at 78% 38%, rgba(255,255,255,.30) 50%, transparent 52%),
    radial-gradient(1px 1px at 88% 66%, rgba(255,255,255,.45) 50%, transparent 52%);
  opacity:.55;
  pointer-events:none;
  filter: blur(.1px);
}

/* floating glow blobs */
.bgGlow{
  position:fixed; inset:-30vh -30vw auto auto;
  width:900px; height:900px;
  background: radial-gradient(circle at 30% 30%, rgba(255,43,43,.22), transparent 55%),
              radial-gradient(circle at 70% 60%, rgba(255,213,106,.14), transparent 58%),
              radial-gradient(circle at 55% 40%, rgba(125,211,252,.10), transparent 60%);
  filter: blur(24px);
  opacity:.9;
  pointer-events:none;
  animation: floatGlow 9s ease-in-out infinite;
}
@keyframes floatGlow{
  0%,100%{ transform: translate3d(0,0,0) scale(1); }
  50%{ transform: translate3d(-18px, 22px, 0) scale(1.03); }
}

/* confetti layer */
.confetti{
  position:fixed; inset:0;
  pointer-events:none;
  opacity:.55;
  background:
    linear-gradient(115deg, transparent 0 47%, rgba(255,43,43,.12) 47% 48%, transparent 48% 100%),
    linear-gradient(15deg, transparent 0 52%, rgba(255,213,106,.10) 52% 53%, transparent 53% 100%),
    linear-gradient(210deg, transparent 0 49%, rgba(125,211,252,.10) 49% 50%, transparent 50% 100%);
  background-size: 240px 240px, 260px 260px, 280px 280px;
  mix-blend-mode: screen;
  animation: confMove 14s linear infinite;
}
@keyframes confMove{
  from{ transform: translateY(-40px); }
  to{ transform: translateY(40px); }
}

/* Card */
.card{
  max-width:610px;
  margin:0 auto;
  border-radius:calc(var(--radius) + 6px);
  padding:16px;
  border:1px solid rgba(255,255,255,.14);
  box-shadow: var(--shadow);
  background:
    radial-gradient(900px 420px at 20% 0%, rgba(255,213,106,.10), transparent 55%),
    radial-gradient(820px 420px at 90% 20%, rgba(255,43,43,.14), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
  backdrop-filter: blur(10px);
  position:relative;
  overflow:hidden;
}
.card:before{
  content:"";
  position:absolute; left:-40%; top:-60%;
  width:180%; height:180%;
  background: radial-gradient(circle at 50% 30%, rgba(255,213,106,.12), transparent 45%),
              radial-gradient(circle at 70% 50%, rgba(255,43,43,.16), transparent 52%),
              radial-gradient(circle at 35% 65%, rgba(125,211,252,.10), transparent 55%);
  transform: rotate(8deg);
  opacity:.9;
  pointer-events:none;
}

.headerRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin:4px 2px 10px;
  position:relative;
  z-index:2;
}
.badgeNY{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(135deg, rgba(255,43,43,.18), rgba(255,213,106,.10));
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
  font-weight:900;
}
.badgeDot{
  width:10px;height:10px;border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2));
  box-shadow: 0 0 0 4px rgba(255,43,43,.18), 0 0 24px rgba(255,43,43,.45);
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.22);
  color: rgba(255,255,255,.78);
  font-weight:800;
  font-size:12px;
}

/* Stepper */
.stepper{
  display:flex;
  gap:10px;
  padding:10px 10px 0;
  position:relative;
  z-index:2;
}
.step{
  flex:1;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.22);
  padding:10px 10px;
  display:flex;
  gap:8px;
  align-items:center;
  min-height:42px;
}
.step .dot{
  width:12px;height:12px;border-radius:50%;
  background: rgba(255,255,255,.18);
  box-shadow: 0 0 0 4px rgba(255,255,255,.06);
}
.step .txt{
  font-size:12px;
  font-weight:900;
  color: rgba(255,255,255,.82);
  line-height:1.2;
}
.step.done{ border-color: rgba(54,211,153,.35); }
.step.done .dot{
  background: radial-gradient(circle at 30% 30%, #fff, rgba(54,211,153,.55));
  box-shadow: 0 0 0 4px rgba(54,211,153,.14), 0 0 22px rgba(54,211,153,.25);
}
.step.live{ border-color: rgba(255,43,43,.32); }
.step.live .dot{
  background: radial-gradient(circle at 30% 30%, #fff, rgba(255,43,43,.55));
  box-shadow: 0 0 0 4px rgba(255,43,43,.14), 0 0 22px rgba(255,43,43,.22);
}

.heroWrap{
  position:relative;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.25);
  box-shadow: 0 18px 42px rgba(0,0,0,.55);
  z-index:1;
  margin-top:10px;
}
.hero{ width:100%; display:block; transform: scale(1.01); }
.heroGlow{
  position:absolute; inset:0;
  background:
    radial-gradient(800px 260px at 30% 10%, rgba(255,213,106,.18), transparent 60%),
    radial-gradient(900px 340px at 70% 20%, rgba(255,43,43,.18), transparent 62%);
  mix-blend-mode: screen;
  pointer-events:none;
  animation: heroPulse 3.8s ease-in-out infinite;
}
@keyframes heroPulse{ 0%,100%{ opacity:.65; } 50%{ opacity:.9; } }

h1{ font-size:20px; margin:14px 6px 8px; letter-spacing:.2px; position:relative; z-index:2; }
.sub{ margin:0 6px 14px; color:var(--muted); line-height:1.65; position:relative; z-index:2; }

label{
  display:block;
  margin:12px 6px 7px;
  color:rgba(255,255,255,.78);
  font-weight:800;
  font-size:13px;
  letter-spacing:.2px;
  position:relative; z-index:2;
}

input{
  width:100%;
  padding:13px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.38);
  color:#fff;
  font-size:16px;
  outline:none;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
  transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
  position:relative; z-index:2;
}
input:focus{
  border-color: rgba(255,43,43,.55);
  box-shadow: 0 0 0 4px rgba(255,43,43,.16), inset 0 0 0 1px rgba(255,255,255,.06);
  transform: translateY(-1px);
}

.row{
  display:flex;
  gap:10px;
  margin-top:12px;
  padding:0 6px;
  position:relative; z-index:2;
}

button{
  flex:1;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  font-size:15px;
  font-weight:1000;
  color:#fff;
  cursor:pointer;
  transition: transform .12s ease, filter .2s ease, opacity .2s ease, box-shadow .2s ease;
  box-shadow: 0 16px 30px rgba(0,0,0,.45);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
button:hover{ transform: translateY(-1px); filter: brightness(1.05); }
button:active{ transform: translateY(0px) scale(.99); }
button:disabled{ opacity:.55; cursor:not-allowed; transform:none !important; box-shadow:none; }

.btnAlt{ background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06)); }
.btnMain{
  border-color: rgba(255,43,43,.28);
  background:
    radial-gradient(140px 120px at 30% 10%, rgba(255,213,106,.35), transparent 60%),
    linear-gradient(135deg, var(--accent), var(--accent2));
  position:relative; overflow:hidden;
}
.btnMain:before{
  content:"";
  position:absolute; inset:-2px;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.35) 40%, transparent 80%);
  transform: translateX(-120%);
  opacity:.55;
}
.btnMain:hover:before{ animation: shine 1.15s ease; }
@keyframes shine{ to{ transform: translateX(120%); } }

.fullBtn{
  margin-top:10px;
  width:calc(100% - 12px);
  margin-left:6px;
  margin-right:6px;
  padding:12px 14px;
  border-radius:16px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.12);
  position:relative; z-index:2;
}

.spinner{
  width:16px;height:16px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,.28);
  border-top-color: rgba(255,255,255,.95);
  animation: spin .75s linear infinite;
}
@keyframes spin{ to{ transform: rotate(360deg);} }

.msg{
  margin:14px 6px 0;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.28);
  white-space:pre-line;
  display:none;
  line-height:1.65;
  position:relative; z-index:2;
}
.msg.ok{ border-color: rgba(54,211,153,.40); box-shadow: 0 0 0 4px rgba(54,211,153,.10); }
.msg.err{ border-color: rgba(255,90,95,.45); box-shadow: 0 0 0 4px rgba(255,90,95,.10); }

/* Copy */
.copyBox{
  margin:12px 6px 0;
  padding:12px;
  border-radius:16px;
  border:1px dashed rgba(255,255,255,.25);
  background: rgba(0,0,0,.24);
  display:none;
  align-items:center;
  gap:10px;
  position:relative; z-index:2;
}
.copyCode{
  flex:1;
  font-weight:1000;
  font-size:16px;
  letter-spacing:1.2px;
  user-select:all;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
}
.copyCode.glow{
  border-color: rgba(255,213,106,.42);
  box-shadow: 0 0 0 4px rgba(255,213,106,.12), 0 0 26px rgba(255,213,106,.18);
  animation: nudge .28s ease 1;
}
@keyframes nudge{
  0%{ transform: translateX(0); }
  25%{ transform: translateX(-2px); }
  50%{ transform: translateX(2px); }
  75%{ transform: translateX(-1px); }
  100%{ transform: translateX(0); }
}
.copyBtn{
  padding:10px 14px;
  border-radius:14px;
  border:0;
  cursor:pointer;
  font-weight:1000;
  color:#06220f;
  background: linear-gradient(135deg, #a7f3d0, #34d399);
  box-shadow: 0 16px 28px rgba(0,0,0,.45);
}
.copyBtn.copied{
  color:#061427;
  background: linear-gradient(135deg, #93c5fd, #3b82f6);
}

/* Redeem link */
.goLink{
  display:none;
  margin:12px 6px 0;
  padding:14px 14px;
  text-align:center;
  font-weight:1000;
  border-radius:16px;
  color:#fff;
  border:1px solid rgba(255,43,43,.26);
  background:
    radial-gradient(140px 120px at 20% 10%, rgba(255,213,106,.34), transparent 60%),
    linear-gradient(135deg,#ff2b2b,#b80000);
  text-decoration:none;
  box-shadow: 0 22px 40px rgba(0,0,0,.55);
  position:relative; z-index:2;
}
.goLink:hover{ filter: brightness(1.05); transform: translateY(-1px); }
.goLink:active{ transform: translateY(0px) scale(.99); }

/* Hint */
.hint{
  font-size:12px;
  color:rgba(255,255,255,.72);
  margin:12px 6px 0;
  line-height:1.7;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
  position:relative; z-index:2;
}
.smallNote{ font-size:12px; color:rgba(255,255,255,.72); margin-top:8px; opacity:.9 }

/* Modal (Rule) */
.modal{
  position:fixed; inset:0;
  background: rgba(0,0,0,.72);
  display:none;
  align-items:center;
  justify-content:center;
  padding:18px;
  z-index:9999;
}
.modal.show{ display:flex; }
.modalCard{
  width:min(560px, 100%);
  border-radius:20px;
  padding:16px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(900px 420px at 10% 0%, rgba(255,213,106,.14), transparent 55%),
    radial-gradient(820px 420px at 90% 20%, rgba(255,43,43,.16), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  box-shadow: 0 26px 90px rgba(0,0,0,.82);
  backdrop-filter: blur(10px);
}
.modalTitle{ font-weight:1000; font-size:18px; margin-bottom:10px; }
.modalText{ color:rgba(255,255,255,.88); line-height:1.75; margin-bottom:12px; }
.modalBtnMain{
  width:100%;
  padding:12px 14px;
  border-radius:16px;
  border:0;
  font-weight:1000;
  cursor:pointer;
  color:#fff;
  background:
    radial-gradient(140px 120px at 30% 10%, rgba(255,213,106,.35), transparent 60%),
    linear-gradient(135deg,var(--accent),var(--accent2));
}
.modalBtnMain:hover{ filter: brightness(1.05); }
.modalBtnMain:active{ transform: scale(.99); }

/* =========================================
   üéÅ Gift Popup (‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á + ‡∏û‡∏•‡∏∏ + QR + Countdown)
========================================= */
.giftModal{
  position:fixed; inset:0;
  background: rgba(0,0,0,.82);
  display:none;
  align-items:center;
  justify-content:center;
  padding:18px;
  z-index:10050;
}
.giftModal.show{ display:flex; }

.giftCard{
  width:min(600px, 100%);
  border-radius:24px;
  padding:16px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(900px 420px at 10% 0%, rgba(255,213,106,.16), transparent 55%),
    radial-gradient(820px 420px at 90% 20%, rgba(255,43,43,.18), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  box-shadow: 0 30px 110px rgba(0,0,0,.90);
  backdrop-filter: blur(10px);
  position:relative;
  overflow:hidden;
  transform: translateY(12px) scale(.98);
  animation: giftIn .22s ease forwards;
}
@keyframes giftIn{ to{ transform: translateY(0) scale(1);} }
.giftCard:before{
  content:"";
  position:absolute; inset:-2px;
  background:
    radial-gradient(circle at 28% 12%, rgba(255,213,106,.18), transparent 45%),
    radial-gradient(circle at 72% 18%, rgba(255,43,43,.20), transparent 55%),
    radial-gradient(circle at 50% 85%, rgba(125,211,252,.12), transparent 55%);
  pointer-events:none;
  mix-blend-mode: screen;
  opacity:.9;
  z-index:0;
}

.giftTopRow{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px; margin-bottom:10px;
  position:relative; z-index:2;
}
.giftTitle{ font-weight:1000; font-size:18px; display:flex; align-items:center; gap:8px; }
.giftClose{
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.25);
  color: rgba(255,255,255,.9);
  border-radius:14px;
  padding:10px 12px;
  cursor:pointer;
  font-weight:1000;
}
.giftClose:hover{ filter: brightness(1.06); }
.giftBody{ position:relative; z-index:2; }

/* üî• Canvas ‡∏û‡∏•‡∏∏ */
#fwCanvas{
  position:absolute; inset:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:1;
  opacity:.95;
}

/* üéÅ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç */
.boxStage{
  display:flex; align-items:center; justify-content:center;
  margin:10px 0 8px;
  position:relative;
}
.giftBox{
  width:150px; height:140px;
  position:relative;
  filter: drop-shadow(0 26px 60px rgba(0,0,0,.65));
}
.giftBox .base{
  position:absolute; left:0; right:0; bottom:0;
  height:98px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.18);
  background:
    radial-gradient(70px 70px at 30% 20%, rgba(255,213,106,.55), transparent 60%),
    linear-gradient(135deg, rgba(255,43,43,.98), rgba(184,0,0,.98));
  overflow:hidden;
}
.giftBox .base:before{
  content:""; position:absolute; inset:0;
  background:
    linear-gradient(90deg, transparent 0 40%, rgba(255,213,106,.95) 40% 60%, transparent 60% 100%),
    linear-gradient(0deg, transparent 0 44%, rgba(255,213,106,.92) 44% 56%, transparent 56% 100%);
  opacity:.95;
}
.giftBox .lid{
  position:absolute; left:-6px; right:-6px; top:20px;
  height:54px;
  border-radius:20px;
  border:1px solid rgba(255,255,255,.18);
  background:
    radial-gradient(60px 60px at 30% 25%, rgba(255,213,106,.45), transparent 60%),
    linear-gradient(135deg, rgba(255,43,43,.98), rgba(184,0,0,.98));
  transform-origin: 50% 100%;
  transform: translateY(0) rotateX(0deg);
  box-shadow: 0 18px 38px rgba(0,0,0,.45);
}
.giftBox .bow{
  position:absolute; left:50%; top:4px;
  width:68px; height:34px;
  transform: translateX(-50%);
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
  opacity:.98;
}
.giftBox .bow:before,
.giftBox .bow:after{
  content:""; position:absolute;
  width:34px; height:34px; border-radius:18px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 60%),
              radial-gradient(circle at 50% 50%, rgba(255,213,106,.98), rgba(255,213,106,.78));
}
.giftBox .bow:before{ left:0; }
.giftBox .bow:after{ right:0; }

/* ‚ú® ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢ */
.sparkBurst{
  position:absolute;
  left:50%; top:32px;
  width:12px; height:12px;
  transform: translateX(-50%);
  pointer-events:none;
  opacity:0;
}
.sparkBurst i{
  position:absolute; left:0; top:0;
  width:8px; height:8px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.25));
  box-shadow: 0 0 18px rgba(255,255,255,.75), 0 0 24px rgba(255,213,106,.55);
  transform: translate(0,0) scale(.8);
  opacity:0;
}

/* ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á */
.giftCard.opening .giftBox .lid{ animation: lidOpen .55s cubic-bezier(.2,.9,.2,1) forwards; }
@keyframes lidOpen{
  0%{ transform: translateY(0) rotateX(0deg); }
  100%{ transform: translateY(-26px) rotateX(70deg); }
}
.giftCard.opening .sparkBurst{ animation: burstShow .15s ease forwards; }
@keyframes burstShow{ to{ opacity:1; } }
.giftCard.opening .sparkBurst i{ animation: sparkleFly .75s ease forwards; }
.giftCard.opening .sparkBurst i:nth-child(1){ --x:-60; --y:-70; animation-delay:.02s; }
.giftCard.opening .sparkBurst i:nth-child(2){ --x:-22; --y:-88; animation-delay:.03s; }
.giftCard.opening .sparkBurst i:nth-child(3){ --x: 20; --y:-92; animation-delay:.01s; }
.giftCard.opening .sparkBurst i:nth-child(4){ --x: 56; --y:-70; animation-delay:.04s; }
.giftCard.opening .sparkBurst i:nth-child(5){ --x:-40; --y:-45; animation-delay:.06s; }
.giftCard.opening .sparkBurst i:nth-child(6){ --x: 40; --y:-45; animation-delay:.05s; }
@keyframes sparkleFly{
  0%{ opacity:0; transform: translate(0,0) scale(.7); }
  10%{ opacity:1; }
  100%{ opacity:0; transform: translate(calc(var(--x)*1px), calc(var(--y)*1px)) scale(1.05); }
}

.giftMetaRow{
  display:flex;
  gap:10px;
  margin:10px 0 0;
  flex-wrap:wrap;
  justify-content:center;
}
.badgeMini{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.22);
  font-weight:1000;
  font-size:12px;
  color: rgba(255,255,255,.85);
}
.badgeMini strong{ color:#fff; }

.giftDesc{
  margin:10px 0 0;
  color:rgba(255,255,255,.90);
  line-height:1.75;
  text-align:center;
}

/* ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ü‡∏î‡∏≠‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á */
.revealWrap{
  margin-top:12px;
  opacity:0;
  transform: translateY(6px);
  transition: opacity .28s ease, transform .28s ease;
}
.revealWrap.show{
  opacity:1;
  transform: translateY(0);
}

.giftCodeBox{
  padding:12px;
  border-radius:18px;
  border:1px dashed rgba(255,255,255,.28);
  background: rgba(0,0,0,.22);
  display:flex;
  gap:10px;
  align-items:center;
}
.giftCode{
  flex:1;
  font-weight:1100;
  font-size:18px;
  letter-spacing:1.4px;
  user-select:all;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
}
.giftCode.glow{
  border-color: rgba(255,213,106,.42);
  box-shadow: 0 0 0 4px rgba(255,213,106,.12), 0 0 26px rgba(255,213,106,.18);
  animation: nudge .28s ease 1;
}
.giftCopy{
  padding:10px 14px;
  border-radius:14px;
  border:0;
  cursor:pointer;
  font-weight:1100;
  color:#06220f;
  background: linear-gradient(135deg, #a7f3d0, #34d399);
  box-shadow: 0 16px 28px rgba(0,0,0,.45);
}
.giftCopy.copied{
  color:#061427;
  background: linear-gradient(135deg, #93c5fd, #3b82f6);
}

/* QR */
.qrWrap{
  margin-top:12px;
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
}
.qrBox{
  width:140px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
  padding:10px;
  text-align:center;
}
.qrBox img{
  width:120px; height:120px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:#fff;
}
.qrHint{
  font-size:12px;
  color:rgba(255,255,255,.78);
  line-height:1.6;
  max-width:320px;
}

.giftActions{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.giftActions a,
.giftActions button{
  flex:1;
  text-decoration:none;
  text-align:center;
  padding:12px 14px;
  border-radius:16px;
  font-weight:1100;
  border:1px solid rgba(255,255,255,.14);
  cursor:pointer;
  color:#fff;
  background: rgba(0,0,0,.20);
}
.giftActions a.primary{
  border-color: rgba(255,43,43,.26);
  background:
    radial-gradient(140px 120px at 20% 10%, rgba(255,213,106,.34), transparent 60%),
    linear-gradient(135deg,#ff2b2b,#b80000);
  box-shadow: 0 22px 44px rgba(0,0,0,.55);
}
.giftActions a:hover,
.giftActions button:hover{ filter: brightness(1.06); transform: translateY(-1px); }
.giftActions a:active,
.giftActions button:active{ transform: translateY(0px) scale(.99); }

@media (max-width:420px){
  body{ padding:16px; }
  .stepper{ flex-direction:column; }
  .step{ min-height:auto; }
}

@media (prefers-reduced-motion: reduce){
  .bgGlow,.confetti,.heroGlow,.btnMain:before{ animation:none !important; }
  .giftCard.opening .giftBox .lid,
  .giftCard.opening .sparkBurst i{ animation:none !important; }
}
</style>
</head>

<body>
<div class="bgGlow" aria-hidden="true"></div>
<div class="confetti" aria-hidden="true"></div>

<div class="card">
  <div class="headerRow">
    <div class="badgeNY"><span class="badgeDot"></span> NEW YEAR 2569</div>
    <div class="pill">üîí 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå</div>
  </div>

  <!-- Stepper -->
  <div class="stepper" aria-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
    <div id="st1" class="step live"><span class="dot"></span><div class="txt">1) ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</div></div>
    <div id="st2" class="step"><span class="dot"></span><div class="txt">2) ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</div></div>
    <div id="st3" class="step"><span class="dot"></span><div class="txt">3) ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div></div>
    <div id="st4" class="step"><span class="dot"></span><div class="txt">4) ‡πÑ‡∏î‡πâ‡πÇ‡∏Ñ‡πâ‡∏î</div></div>
  </div>

  <div class="heroWrap">
    <img class="hero"
      src="https://img5.pic.in.th/file/secure-sv1/photo_--_--2bb7d3a2870ef8d6.jpg"
      alt="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ"
      loading="eager" decoding="async"/>
    <div class="heroGlow" aria-hidden="true"></div>
  </div>

  <h1>üéÅ ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏à‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 38,888 ‡∏ö‡∏≤‡∏ó üéÅ</h1>
  <p class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏∏‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 50 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</p>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

  <div class="row">
    <button id="btnCheck" class="btnAlt" type="button" disabled>
      <span class="spinner" id="spCheck" style="display:none"></span>
      <span id="txCheck">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span>
    </button>
    <button id="btnJoin" class="btnMain" type="button" disabled>
      <span class="spinner" id="spJoin" style="display:none"></span>
      <span id="txJoin">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</span>
    </button>
  </div>

  <button id="btnPoll" class="fullBtn" type="button" disabled>
    <span class="spinner" id="spPoll" style="display:none"></span>
    <span id="txPoll">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î</span>
  </button>

  <div id="msg" class="msg"></div>

  <div id="copyWrap" class="copyBox">
    <div id="promoCode" class="copyCode">RRXXXXXXXX</div>
    <button id="btnCopy" class="copyBtn" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
  </div>

 <a id="goRedeem" class="goLink"
   href="https://rumruay365.uk/events/free-credit"
   target="_blank" rel="noopener"
   onclick="window.open('https://rumruay365.uk/events/free-credit','_blank'); return false;">
  üëâ ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ
</a>


  <div class="hint">
    * ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ<br>
    * ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
    * üîí ‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î: 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå (‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå)<br>
    * üì± ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß)
    <div class="smallNote" id="devNote"></div>
  </div>
</div>

<!-- Rule Modal -->
<div id="ruleModal" class="modal" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true">
    <div class="modalTitle">üìå ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô)</div>
    <div class="modalText">
      1) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó<br>
      2) ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
      3) üîí 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>
      4) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
    </div>
    <button class="modalBtnMain" id="modalAcknowledge" type="button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
  </div>
</div>

<!-- üéÅ Gift Popup Modal -->
<div id="giftModal" class="giftModal" aria-hidden="true">
  <div id="giftCard" class="giftCard" role="dialog" aria-modal="true">
    <canvas id="fwCanvas"></canvas>

    <div class="giftTopRow">
      <div class="giftTitle">üéÅ ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß!</div>
      <button class="giftClose" id="giftCloseBtn" type="button">‡∏õ‡∏¥‡∏î</button>
    </div>

    <div class="giftBody">
      <div class="boxStage">
        <div class="giftBox" aria-hidden="true">
          <div class="lid"></div>
          <div class="bow"></div>
          <div class="base"></div>
          <div class="sparkBurst" aria-hidden="true">
            <i></i><i></i><i></i><i></i><i></i><i></i>
          </div>
        </div>
      </div>

      <div class="giftMetaRow">
        <div class="badgeMini">‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <strong>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</strong></div>
        <div class="badgeMini">‚è≥ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: <strong id="countdown">15:00</strong></div>
      </div>

      <p class="giftDesc">
        ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠‡πÅ‡∏õ‡πä‡∏ö‚Ä¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á üéÜ<br>
        ‡∏Å‡∏î ‚Äú‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
      </p>

      <!-- reveal after open -->
      <div id="revealWrap" class="revealWrap">
        <div class="giftCodeBox">
          <div id="giftCode" class="giftCode">RRXXXXXXXX</div>
          <button id="giftCopyBtn" class="giftCopy" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
        </div>

        <div class="qrWrap">
          <div class="qrBox">
            <img id="qrImg" alt="QR ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î"/>
            <div style="margin-top:8px;font-size:12px;color:rgba(255,255,255,.75);font-weight:900;">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î</div>
          </div>
          <div class="qrHint">
            ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢<br>
            ‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î<br>
            üîä ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå (‡∏ñ‡πâ‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï)
          </div>
        </div>

        <div class="giftActions">
          <button id="giftOkBtn" type="button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
          <a id="giftGoBtn" class="primary"
   href="https://rumruay365.uk/events/free-credit"
   target="_blank" rel="noopener"
   onclick="window.open('https://rumruay365.uk/events/free-credit','_blank'); return false;">
   ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î
</a>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* üî¥ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå exec ‡∏Ç‡∏≠‡∏á Google Apps Script */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyokjZuq_w45cvwNjSGcjlcH1xpMLi_0K7jG84a5sm7EuIKTDIBF9Uzw4_yisVP9KtTJA/exec";
const REDEEM_URL = "https://rumruay365.uk/events/free-credit";

/* DOM */
const $phone=document.getElementById("phone");
const $btnCheck=document.getElementById("btnCheck");
const $btnJoin=document.getElementById("btnJoin");
const $btnPoll=document.getElementById("btnPoll");

const $spCheck=document.getElementById("spCheck");
const $spJoin=document.getElementById("spJoin");
const $spPoll=document.getElementById("spPoll");
const $txCheck=document.getElementById("txCheck");
const $txJoin=document.getElementById("txJoin");
const $txPoll=document.getElementById("txPoll");

const $msg=document.getElementById("msg");
const $copyWrap=document.getElementById("copyWrap");
const $promoCode=document.getElementById("promoCode");
const $btnCopy=document.getElementById("btnCopy");

const $ruleModal=document.getElementById("ruleModal");
const $modalAck=document.getElementById("modalAcknowledge");
const $goRedeem=document.getElementById("goRedeem");
const $devNote=document.getElementById("devNote");

/* Stepper */
const $st1=document.getElementById("st1");
const $st2=document.getElementById("st2");
const $st3=document.getElementById("st3");
const $st4=document.getElementById("st4");

/* Gift */
const $giftModal = document.getElementById("giftModal");
const $giftCard  = document.getElementById("giftCard");
const $giftCloseBtn = document.getElementById("giftCloseBtn");
const $giftOkBtn = document.getElementById("giftOkBtn");
const $giftGoBtn = document.getElementById("giftGoBtn");
const $giftCode = document.getElementById("giftCode");
const $giftCopyBtn = document.getElementById("giftCopyBtn");
const $revealWrap = document.getElementById("revealWrap");
const $countdown = document.getElementById("countdown");
const $qrImg = document.getElementById("qrImg");

/* Fireworks Canvas */
const fwCanvas = document.getElementById("fwCanvas");
const fwCtx = fwCanvas.getContext("2d");

/* =========================
   UI helpers
========================= */
function openRule(){ $ruleModal.classList.add("show"); document.body.style.overflow="hidden"; }
function closeRule(){ $ruleModal.classList.remove("show"); document.body.style.overflow=""; }
$modalAck.onclick=closeRule;

function show(t,type="ok"){
  $msg.style.display="block";
  $msg.className="msg "+(type==="err"?"err":"ok");
  $msg.textContent=t;
}
function hideMsg(){ $msg.style.display="none"; $msg.textContent=""; }

function hideCopy(){
  $copyWrap.style.display="none";
  $promoCode.textContent="RRXXXXXXXX";
  $promoCode.classList.remove("glow");
  $goRedeem.style.display="none";
  $goRedeem.href = REDEEM_URL;
}

function setButtons(enabled){
  $btnCheck.disabled = !enabled;
  $btnPoll.disabled  = !enabled;
  if(!enabled) $btnJoin.disabled = true;
}

function note(t){ $devNote.textContent = t || ""; }

function setStepper(stage){ // 1 check,2 join,3 pending,4 approved
  [$st1,$st2,$st3,$st4].forEach(x=>x.classList.remove("done","live"));
  if(stage>=1){ $st1.classList.add(stage===1?"live":"done"); }
  if(stage>=2){ $st2.classList.add(stage===2?"live":"done"); }
  if(stage>=3){ $st3.classList.add(stage===3?"live":"done"); }
  if(stage>=4){ $st4.classList.add(stage===4?"live":"done"); }
}

/* =========================
   debounce / loading / anti-spam
========================= */
let busy = false;
function setLoading(btn, spinner, label, isOn, textOn){
  spinner.style.display = isOn ? "inline-block" : "none";
  label.textContent = isOn ? (textOn || label.textContent) : label.getAttribute("data-orig") || label.textContent;
  if(!label.getAttribute("data-orig")) label.setAttribute("data-orig", label.textContent);
}
function lock(ms=1200){
  busy = true;
  setTimeout(()=>busy=false, ms);
}

/* =========================
   Phone normalize
========================= */
function normalizePhone(v){
  let s=String(v||"").trim(); const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p)?p:"";
}

/* =========================
   JSONP
========================= */
function jsonp(params){
  return new Promise((res,rej)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    params.callback=cb;
    params._ts=Date.now();
    const s=document.createElement("script");
    s.src = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    window[cb]=(d)=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); res(d); };
    s.onerror=()=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); rej(new Error("JSONP_ERROR")); };
    document.body.appendChild(s);
  });
}

/* =========================
   Copy (main)
========================= */
$btnCopy.onclick=async()=>{
  const t=$promoCode.textContent.trim();
  if(!t) return;
  try{
    await navigator.clipboard.writeText(t);
    $btnCopy.classList.add("copied");
    $btnCopy.textContent="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!";
    $promoCode.classList.add("glow");
    setTimeout(()=>{
      $btnCopy.classList.remove("copied");
      $btnCopy.textContent="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å";
      $promoCode.classList.remove("glow");
    }, 1200);
    sfx("copy");
  }catch(_){}
};

/* =========================
   Device profile (‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ GAS ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì device_key ‡πÄ‡∏≠‡∏á)
========================= */
let READY=false;
let PROF=null;

function getProf(){
  const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone || "");
  const scrW = screen.width || 0;
  const scrH = screen.height || 0;
  const dpr  = window.devicePixelRatio || 1;
  const cd   = screen.colorDepth || 0;
  const plat = (navigator.platform || "");
  const hc   = navigator.hardwareConcurrency || 0;
  const dm   = navigator.deviceMemory || 0;
  const lang = navigator.language || "";
  const mtp  = navigator.maxTouchPoints || 0;
  const touch = ("ontouchstart" in window) ? 1 : 0;

  let glv="", glr="";
  try{
    const c=document.createElement("canvas");
    const gl=c.getContext("webgl")||c.getContext("experimental-webgl");
    if(gl){
      const dbg = gl.getExtension("WEBGL_debug_renderer_info");
      glv = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);
      glr = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
    }
  }catch(_){}
  return {
    tz,
    scrW, scrH, dpr, cd,
    plat, hc, dm,
    lang, mtp, touch,
    glv: String(glv||"").slice(0,120),
    glr: String(glr||"").slice(0,200),
  };
}

async function ensureReady(){
  if(READY && PROF) return PROF;
  setButtons(false);
  PROF=getProf();
  READY=true;
  note(`Device: ${PROF.scrW}x${PROF.scrH}@${PROF.dpr} | ${PROF.tz}`);
  setButtons(true);
  return PROF;
}
window.addEventListener("load", ()=>ensureReady());

async function payloadBase(phone){
  const p = await ensureReady();
  const ua = navigator.userAgent || "";
  return {
    phone,
    ua,
    tz: p.tz,
    scrW: p.scrW, scrH: p.scrH, dpr: p.dpr, cd: p.cd,
    plat: p.plat, hc: p.hc, dm: p.dm,
    lang: p.lang, mtp: p.mtp, touch: p.touch,
    glv: p.glv, glr: p.glr,
    screen: `${p.scrW}x${p.scrH}@${p.dpr}`,
    webgl: `${p.glv}|${p.glr}`.slice(0,220),
  };
}

/* =========================
   Sound FX (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ gesture ‡∏Å‡πà‡∏≠‡∏ô)
========================= */
let audioCtx = null;
function ensureAudio(){
  if(audioCtx) return;
  try{
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }catch(_){}
}
function beep(freq=880, dur=0.08, type="sine", gain=0.06){
  if(!audioCtx) return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type=type; o.frequency.value=freq;
  g.gain.value=gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime+dur);
}
function sfx(name){
  ensureAudio();
  if(!audioCtx) return;
  if(audioCtx.state==="suspended"){ audioCtx.resume().catch(()=>{}); }
  if(name==="open"){ beep(523,0.06,"triangle",0.06); setTimeout(()=>beep(784,0.08,"triangle",0.06),70); setTimeout(()=>beep(1046,0.10,"triangle",0.06),150); }
  if(name==="copy"){ beep(880,0.06,"sine",0.05); setTimeout(()=>beep(1174,0.06,"sine",0.05),70); }
  if(name==="error"){ beep(220,0.10,"sawtooth",0.05); }
}

/* prime audio on first user gesture */
window.addEventListener("pointerdown", ()=>ensureAudio(), {once:true});

/* =========================
   Gift + Fireworks + Countdown + One-time popup + QR
========================= */
let fwRAF = 0;
let fwParticles = [];
let fwRunning = false;

function resizeFW(){
  const rect = $giftCard.getBoundingClientRect();
  fwCanvas.width  = Math.floor(rect.width * devicePixelRatio);
  fwCanvas.height = Math.floor(rect.height * devicePixelRatio);
  fwCanvas.style.width = rect.width + "px";
  fwCanvas.style.height = rect.height + "px";
  fwCtx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}

function spawnBurst(x,y, count=70){
  for(let i=0;i<count;i++){
    const a = Math.random()*Math.PI*2;
    const sp = 1.6 + Math.random()*3.4;
    fwParticles.push({
      x,y,
      vx: Math.cos(a)*sp,
      vy: Math.sin(a)*sp - (Math.random()*0.8),
      life: 36 + Math.floor(Math.random()*22),
      age: 0,
      size: 1 + Math.random()*2.3,
      hue: [48, 200, 0, 15][Math.floor(Math.random()*4)] + Math.random()*12
    });
  }
}

function fwLoop(){
  fwRAF = requestAnimationFrame(fwLoop);
  const w = $giftCard.clientWidth;
  const h = $giftCard.clientHeight;
  fwCtx.clearRect(0,0,w,h);

  for(let i=fwParticles.length-1;i>=0;i--){
    const p = fwParticles[i];
    p.age++;
    p.vx *= 0.985;
    p.vy = p.vy*0.985 + 0.06;
    p.x += p.vx; p.y += p.vy;

    const t = 1 - (p.age / p.life);
    if(t<=0){ fwParticles.splice(i,1); continue; }

    fwCtx.globalAlpha = Math.max(0, t);
    fwCtx.beginPath();
    fwCtx.fillStyle = `hsl(${p.hue} 95% 65%)`;
    fwCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
    fwCtx.fill();
  }
  fwCtx.globalAlpha = 1;

  if(fwParticles.length===0 && fwRunning){
    fwRunning = false;
    cancelAnimationFrame(fwRAF);
    fwRAF = 0;
    fwCtx.clearRect(0,0,w,h);
  }
}

function playFireworks(){
  resizeFW();
  fwParticles = [];
  fwRunning = true;

  const w = $giftCard.clientWidth;
  const h = $giftCard.clientHeight;

  spawnBurst(w*0.50, h*0.22, 90);
  setTimeout(()=>spawnBurst(w*0.25, h*0.28, 75), 120);
  setTimeout(()=>spawnBurst(w*0.75, h*0.30, 75), 240);
  setTimeout(()=>spawnBurst(w*0.50, h*0.38, 60), 360);

  if(!fwRAF) fwLoop();
}

/* Countdown 15 ‡∏ô‡∏≤‡∏ó‡∏µ */
let countdownTimer = 0;
function startCountdown(startTs){
  clearInterval(countdownTimer);
  const end = startTs + 15*60*1000;

  function tick(){
    const left = Math.max(0, end - Date.now());
    const mm = Math.floor(left/60000);
    const ss = Math.floor((left%60000)/1000);
    $countdown.textContent = String(mm).padStart(2,"0")+":"+String(ss).padStart(2,"0");
    if(left<=0){
      clearInterval(countdownTimer);
      $countdown.textContent = "00:00";
    }
  }
  tick();
  countdownTimer = setInterval(tick, 500);
}

function buildQR(url){
  // ‡πÉ‡∏ä‡πâ Google Chart API (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ)
  const u = encodeURIComponent(url);
  return `https://chart.googleapis.com/chart?cht=qr&chs=240x240&chld=M|0&chl=${u}`;
}

let lastApprovedCode = "";
let lastApprovedAt = 0;

function openGift(code, opts={}){
  const now = Date.now();
  const popupKey = "giftShown_"+String(code||"");
  const isSilent = !!opts.silent; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥/‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏á

  // ‡∏Å‡∏±‡∏ô‡πÄ‡∏î‡πâ‡∏á‡∏ã‡πâ‡∏≥‡∏ï‡πà‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î (‡∏Ç‡πâ‡∏≠ 1)
  if(!opts.force && code && sessionStorage.getItem(popupKey)==="1"){
    // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡πâ‡∏≥‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ -> force:true
    return;
  }

  lastApprovedCode = code || lastApprovedCode;
  if(!lastApprovedAt) lastApprovedAt = now;

  if(code){
    sessionStorage.setItem(popupKey,"1");
  }

  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï UI
  $revealWrap.classList.remove("show");
  $giftCode.textContent = code || "RRXXXXXXXX";
  $giftCode.classList.remove("glow");
  $giftCopyBtn.classList.remove("copied");
  $giftCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å";

  // ‡∏ï‡∏±‡πâ‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå + QR
 $qrImg.onerror = ()=> { $qrImg.src = buildQR(REDEEM_URL); };
$qrImg.src = "https://img2.pic.in.th/TiAbFC_qrcode.png";

  // ‡πÄ‡∏õ‡∏¥‡∏î modal
  $giftModal.classList.add("show");
  document.body.style.overflow="hidden";

  // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á + ‡∏û‡∏•‡∏∏
  $giftCard.classList.remove("opening");
  void $giftCard.offsetWidth;
  $giftCard.classList.add("opening");

  if(!isSilent){
    sfx("open");
  }
  playFireworks();

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ 15 ‡∏ô‡∏≤‡∏ó‡∏µ (‡∏Ç‡πâ‡∏≠ 6)
  const startTs = opts.startTs || now;
  lastApprovedAt = startTs;
  startCountdown(startTs);

  // ‡πÇ‡∏ä‡∏ß‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á (‡∏Ç‡πâ‡∏≠ 2)
  setTimeout(()=>{
    $revealWrap.classList.add("show");
  }, 600);
}

function closeGift(){
  $giftModal.classList.remove("show");
  document.body.style.overflow="";
  clearInterval(countdownTimer);
  if(fwRAF){ cancelAnimationFrame(fwRAF); fwRAF=0; }
  fwParticles=[]; fwRunning=false;
}

$giftCloseBtn.onclick = closeGift;
$giftOkBtn.onclick = closeGift;
$giftModal.addEventListener("click", (e)=>{ if(e.target === $giftModal) closeGift(); });

$giftCopyBtn.onclick=async()=>{
  const t = ($giftCode.textContent||"").trim();
  if(!t) return;
  try{
    await navigator.clipboard.writeText(t);
    $giftCopyBtn.classList.add("copied");
    $giftCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!";
    $giftCode.classList.add("glow");
    sfx("copy");
    setTimeout(()=>{
      $giftCopyBtn.classList.remove("copied");
      $giftCopyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å";
      $giftCode.classList.remove("glow");
    }, 1200);
  }catch(_){}
};

window.addEventListener("resize", ()=>{
  if($giftModal.classList.contains("show")) resizeFW();
});

/* =========================
   Shake detect (‡∏Ç‡πâ‡∏≠ 5)
========================= */
let shakeArmed = true;
let lastShake = 0;
function onMotion(e){
  if(!shakeArmed) return;
  const a = e.accelerationIncludingGravity;
  if(!a) return;
  const mag = Math.abs(a.x||0)+Math.abs(a.y||0)+Math.abs(a.z||0);
  const now = Date.now();
  // threshold ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ
  if(mag > 35 && (now - lastShake) > 1200){
    lastShake = now;
    if(lastApprovedCode){
      openGift(lastApprovedCode, {force:true, silent:true, startTs:lastApprovedAt||Date.now()});
    }
  }
}

async function enableShake(){
  try{
    // iOS ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠ permission
    if(typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function"){
      const p = await DeviceMotionEvent.requestPermission();
      if(p !== "granted") return;
    }
    window.addEventListener("devicemotion", onMotion, {passive:true});
  }catch(_){}
}

/* ‡πÄ‡∏õ‡∏¥‡∏î shake ‡∏´‡∏•‡∏±‡∏á‡∏°‡∏µ gesture */
window.addEventListener("pointerdown", ()=>enableShake(), {once:true});

/* =========================
   Stepper stage helper from responses
========================= */
function markStageFromPoll(status){
  if(status==="PENDING"){ setStepper(3); return; }
  if(status==="APPROVED"){ setStepper(4); return; }
  if(status==="REJECTED" || status==="USED"){ setStepper(3); return; }
  setStepper(1);
}

/* =========================
   Actions: check / register / poll
========================= */
setStepper(1);

$btnCheck.onclick=async()=>{
  if(busy) return;
  lock(900);

  hideMsg(); hideCopy(); $btnJoin.disabled=true;
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); sfx("error"); return; }

  const base = await payloadBase(p);

  setLoading($btnCheck,$spCheck,$txCheck,true,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...");
  $btnCheck.disabled = true;
  $btnPoll.disabled = true;

  try{
    const d=await jsonp({action:"check", ...base}).catch(()=>null);
    if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); sfx("error"); return; }
    if(!d.ok){ show(d.msg || "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç","err"); sfx("error"); return; }

    show(d.msg || "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ","ok");
    $btnJoin.disabled=false;
    setStepper(2);
  }finally{
    setLoading($btnCheck,$spCheck,$txCheck,false);
    $btnCheck.disabled = false;
    $btnPoll.disabled = false;
  }
};

$btnJoin.onclick=async()=>{
  if(busy) return;
  lock(1100);

  hideMsg(); hideCopy();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); sfx("error"); return; }

  const base = await payloadBase(p);

  setLoading($btnJoin,$spJoin,$txJoin,true,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô...");
  $btnJoin.disabled = true;
  $btnCheck.disabled = true;
  $btnPoll.disabled = true;

  try{
    const d=await jsonp({action:"register", ...base}).catch(()=>null);
    if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); sfx("error"); return; }
    if(!d.ok){ show(d.msg || "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); sfx("error"); return; }

    show(d.msg || "‚úÖ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ","ok");
    setStepper(3);
    openRule();
  }finally{
    setLoading($btnJoin,$spJoin,$txJoin,false);
    $btnJoin.disabled = false;
    $btnCheck.disabled = false;
    $btnPoll.disabled = false;
  }
};

$btnPoll.onclick=async()=>{
  if(busy) return;
  lock(1200);

  hideMsg(); hideCopy();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); sfx("error"); return; }

  const base = await payloadBase(p);

  setLoading($btnPoll,$spPoll,$txPoll,true,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...");
  $btnPoll.disabled = true;
  $btnCheck.disabled = true;
  $btnJoin.disabled = true;

  try{
    const d=await jsonp({action:"poll", ...base}).catch(()=>null);
    if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); sfx("error"); return; }
    if(!d.ok){ show(d.msg || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°","err"); sfx("error"); return; }

    markStageFromPoll(d.status);

    if(d.status==="APPROVED" && d.promo_code){
      lastApprovedCode = d.promo_code;
      lastApprovedAt = Date.now();
      // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ shake ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
      sessionStorage.setItem("lastApprovedCode", lastApprovedCode);
      sessionStorage.setItem("lastApprovedAt", String(lastApprovedAt));

      // ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°
      $promoCode.textContent=d.promo_code;
      $copyWrap.style.display="flex";
      $goRedeem.style.display="block";
      $goRedeem.href = REDEEM_URL;

      show("üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢\n‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‚Äù","ok");
      openRule();

      // üéÅ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á + ‡∏û‡∏•‡∏∏ + reveal + qr + countdown + one-time
      openGift(d.promo_code, {startTs:lastApprovedAt});
      return;
    }

    if(d.status==="PENDING"){ show("‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ä‡πá‡∏Ñ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ","ok"); return; }
    if(d.status==="REJECTED"){ show("‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô","err"); return; }
    if(d.status==="USED"){ show("‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß","err"); return; }

    show(d.msg || ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: "+(d.status||"UNKNOWN")),"ok");
  }finally{
    setLoading($btnPoll,$spPoll,$txPoll,false);
    $btnPoll.disabled = false;
    $btnCheck.disabled = false;
    // ‡∏õ‡∏•‡πà‡∏≠‡∏¢ join ‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô check ‡∏à‡∏£‡∏¥‡∏á ‡πÜ
    // (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ join ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏°‡∏≠‡∏´‡∏•‡∏±‡∏á poll ‡∏Å‡πá‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)
    $btnJoin.disabled = false;
  }
};

/* restore last approved for shake (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) */
try{
  const c = sessionStorage.getItem("lastApprovedCode") || "";
  const t = parseInt(sessionStorage.getItem("lastApprovedAt")||"0",10) || 0;
  if(c){ lastApprovedCode=c; lastApprovedAt=t||Date.now(); }
}catch(_){}

/* init */
ensureReady();
</script>
</body>
</html>
