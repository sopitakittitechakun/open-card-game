<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà | ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∏‡πà‡∏°</title>
<meta name="color-scheme" content="dark"/>

<style>
:root{
  --bg:#06060a;
  --card:#0f0f14;
  --line:rgba(255,255,255,.14);

  --txt:#ffffff;
  --muted:rgba(255,255,255,.78);

  --accent:#ff2b2b;
  --accent2:#b80000;

  --gold:#ffd56a;
  --ice:#7dd3fc;

  --ok:#36d399;
  --bad:#ff5a5f;

  --shadow: 0 26px 80px rgba(0,0,0,.75);
  --radius:24px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  padding:24px;
  font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
  color:var(--txt);

  /* New Year Luxury Night */
  background:
    radial-gradient(1100px 560px at 50% -10%, rgba(255,43,43,.22), transparent 60%),
    radial-gradient(900px 520px at 10% 10%, rgba(125,211,252,.14), transparent 62%),
    radial-gradient(900px 520px at 90% 20%, rgba(255,213,106,.12), transparent 65%),
    linear-gradient(180deg, #05050a 0%, #07060f 40%, #05050a 100%);
  overflow-x:hidden;
}

/* subtle star dust */
body:before{
  content:"";
  position:fixed; inset:0;
  background-image:
    radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.55) 50%, transparent 52%),
    radial-gradient(1px 1px at 22% 68%, rgba(255,255,255,.35) 50%, transparent 52%),
    radial-gradient(1px 1px at 35% 35%, rgba(255,255,255,.45) 50%, transparent 52%),
    radial-gradient(1px 1px at 48% 22%, rgba(255,255,255,.35) 50%, transparent 52%),
    radial-gradient(1px 1px at 60% 72%, rgba(255,255,255,.40) 50%, transparent 52%),
    radial-gradient(1px 1px at 78% 38%, rgba(255,255,255,.30) 50%, transparent 52%),
    radial-gradient(1px 1px at 88% 66%, rgba(255,255,255,.45) 50%, transparent 52%);
  opacity:.55;
  pointer-events:none;
  filter: blur(.1px);
}

/* floating glow blobs */
.bgGlow{
  position:fixed; inset:-30vh -30vw auto auto;
  width:900px; height:900px;
  background: radial-gradient(circle at 30% 30%, rgba(255,43,43,.22), transparent 55%),
              radial-gradient(circle at 70% 60%, rgba(255,213,106,.14), transparent 58%),
              radial-gradient(circle at 55% 40%, rgba(125,211,252,.10), transparent 60%);
  filter: blur(24px);
  opacity:.9;
  pointer-events:none;
  animation: floatGlow 9s ease-in-out infinite;
}
@keyframes floatGlow{
  0%,100%{ transform: translate3d(0,0,0) scale(1); }
  50%{ transform: translate3d(-18px, 22px, 0) scale(1.03); }
}

/* confetti layer (CSS only, no JS) */
.confetti{
  position:fixed; inset:0;
  pointer-events:none;
  opacity:.55;
  background:
    linear-gradient(115deg, transparent 0 47%, rgba(255,43,43,.12) 47% 48%, transparent 48% 100%),
    linear-gradient(15deg, transparent 0 52%, rgba(255,213,106,.10) 52% 53%, transparent 53% 100%),
    linear-gradient(210deg, transparent 0 49%, rgba(125,211,252,.10) 49% 50%, transparent 50% 100%);
  background-size: 240px 240px, 260px 260px, 280px 280px;
  mix-blend-mode: screen;
  animation: confMove 14s linear infinite;
}
@keyframes confMove{
  from{ transform: translateY(-40px); }
  to{ transform: translateY(40px); }
}

/* Card */
.card{
  max-width:590px;
  margin:0 auto;
  border-radius:calc(var(--radius) + 6px);
  padding:16px;
  border:1px solid rgba(255,255,255,.14);
  box-shadow: var(--shadow);

  background:
    radial-gradient(900px 420px at 20% 0%, rgba(255,213,106,.10), transparent 55%),
    radial-gradient(820px 420px at 90% 20%, rgba(255,43,43,.14), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
  backdrop-filter: blur(10px);
  position:relative;
  overflow:hidden;
}

/* top border glow */
.card:before{
  content:"";
  position:absolute; left:-40%; top:-60%;
  width:180%; height:180%;
  background: radial-gradient(circle at 50% 30%, rgba(255,213,106,.12), transparent 45%),
              radial-gradient(circle at 70% 50%, rgba(255,43,43,.16), transparent 52%),
              radial-gradient(circle at 35% 65%, rgba(125,211,252,.10), transparent 55%);
  transform: rotate(8deg);
  opacity:.9;
  pointer-events:none;
}

.headerRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin:4px 2px 12px;
  position:relative;
  z-index:1;
}

.badgeNY{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(135deg, rgba(255,43,43,.18), rgba(255,213,106,.10));
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
  font-weight:900;
  letter-spacing:.2px;
  color:#fff;
}
.badgeDot{
  width:10px;height:10px;border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2));
  box-shadow: 0 0 0 4px rgba(255,43,43,.18), 0 0 24px rgba(255,43,43,.45);
}

.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.22);
  color: rgba(255,255,255,.78);
  font-weight:800;
  font-size:12px;
}

.heroWrap{
  position:relative;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.25);
  box-shadow: 0 18px 42px rgba(0,0,0,.55);
  z-index:1;
}
.hero{
  width:100%;
  display:block;
  transform: scale(1.01);
}
.heroGlow{
  position:absolute; inset:0;
  background:
    radial-gradient(800px 260px at 30% 10%, rgba(255,213,106,.18), transparent 60%),
    radial-gradient(900px 340px at 70% 20%, rgba(255,43,43,.18), transparent 62%);
  mix-blend-mode: screen;
  pointer-events:none;
  animation: heroPulse 3.8s ease-in-out infinite;
}
@keyframes heroPulse{
  0%,100%{ opacity:.65; }
  50%{ opacity:.9; }
}

h1{
  font-size:20px;
  margin:14px 6px 8px;
  letter-spacing:.2px;
  position:relative;
  z-index:1;
}
.sub{
  margin:0 6px 14px;
  color:var(--muted);
  line-height:1.65;
  position:relative;
  z-index:1;
}

label{
  display:block;
  margin:12px 6px 7px;
  color:rgba(255,255,255,.78);
  font-weight:800;
  font-size:13px;
  letter-spacing:.2px;
  position:relative;
  z-index:1;
}

input{
  width:100%;
  padding:13px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.38);
  color:#fff;
  font-size:16px;
  outline:none;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
  transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
  position:relative;
  z-index:1;
}
input:focus{
  border-color: rgba(255,43,43,.55);
  box-shadow: 0 0 0 4px rgba(255,43,43,.16), inset 0 0 0 1px rgba(255,255,255,.06);
  transform: translateY(-1px);
}

.row{
  display:flex;
  gap:10px;
  margin-top:12px;
  padding:0 6px;
  position:relative;
  z-index:1;
}

button{
  flex:1;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  font-size:15px;
  font-weight:1000;
  color:#fff;
  cursor:pointer;
  transition: transform .12s ease, filter .2s ease, opacity .2s ease, box-shadow .2s ease;
  box-shadow: 0 16px 30px rgba(0,0,0,.45);
}
button:hover{ transform: translateY(-1px); filter: brightness(1.05); }
button:active{ transform: translateY(0px) scale(.99); }
button:disabled{
  opacity:.55;
  cursor:not-allowed;
  transform:none !important;
  box-shadow:none;
}

.btnAlt{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
}

.btnMain{
  border-color: rgba(255,43,43,.28);
  background:
    radial-gradient(140px 120px at 30% 10%, rgba(255,213,106,.35), transparent 60%),
    linear-gradient(135deg, var(--accent), var(--accent2));
  position:relative;
  overflow:hidden;
}
.btnMain:before{
  content:"";
  position:absolute; inset:-2px;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.35) 40%, transparent 80%);
  transform: translateX(-120%);
  opacity:.55;
}
.btnMain:hover:before{ animation: shine 1.15s ease; }
@keyframes shine{
  to{ transform: translateX(120%); }
}

.fullBtn{
  margin-top:10px;
  width:100%;
  padding:12px 14px;
  border-radius:16px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.12);
}

.msg{
  margin:14px 6px 0;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.28);
  white-space:pre-line;
  display:none;
  line-height:1.65;
  position:relative;
  z-index:1;
}
.msg.ok{
  border-color: rgba(54,211,153,.40);
  box-shadow: 0 0 0 4px rgba(54,211,153,.10);
}
.msg.err{
  border-color: rgba(255,90,95,.45);
  box-shadow: 0 0 0 4px rgba(255,90,95,.10);
}

/* Copy */
.copyBox{
  margin:12px 6px 0;
  padding:12px;
  border-radius:16px;
  border:1px dashed rgba(255,255,255,.25);
  background: rgba(0,0,0,.24);
  display:none;
  align-items:center;
  gap:10px;
  position:relative;
  z-index:1;
}
.copyCode{
  flex:1;
  font-weight:1000;
  font-size:16px;
  letter-spacing:1.2px;
  user-select:all;
}
.copyBtn{
  padding:10px 14px;
  border-radius:14px;
  border:0;
  cursor:pointer;
  font-weight:1000;
  color:#06220f;
  background: linear-gradient(135deg, #a7f3d0, #34d399);
  box-shadow: 0 16px 28px rgba(0,0,0,.45);
}
.copyBtn.copied{
  color:#061427;
  background: linear-gradient(135deg, #93c5fd, #3b82f6);
}

/* Redeem link */
.goLink{
  display:none;
  margin:12px 6px 0;
  padding:14px 14px;
  text-align:center;
  font-weight:1000;
  border-radius:16px;
  color:#fff;
  border:1px solid rgba(255,43,43,.26);
  background:
    radial-gradient(140px 120px at 20% 10%, rgba(255,213,106,.34), transparent 60%),
    linear-gradient(135deg,#ff2b2b,#b80000);
  text-decoration:none;
  box-shadow: 0 22px 40px rgba(0,0,0,.55);
  position:relative;
  z-index:1;
}
.goLink:hover{ filter: brightness(1.05); transform: translateY(-1px); }
.goLink:active{ transform: translateY(0px) scale(.99); }

/* Hint */
.hint{
  font-size:12px;
  color:rgba(255,255,255,.72);
  margin:12px 6px 0;
  line-height:1.7;
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
  position:relative;
  z-index:1;
}
.smallNote{
  font-size:12px;
  color:rgba(255,255,255,.72);
  margin-top:8px;
  opacity:.9
}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.72);
  display:none;
  align-items:center;
  justify-content:center;
  padding:18px;
  z-index:9999;
}
.modal.show{ display:flex; }
.modalCard{
  width:min(560px, 100%);
  border-radius:20px;
  padding:16px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(900px 420px at 10% 0%, rgba(255,213,106,.14), transparent 55%),
    radial-gradient(820px 420px at 90% 20%, rgba(255,43,43,.16), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  box-shadow: 0 26px 90px rgba(0,0,0,.82);
  backdrop-filter: blur(10px);
}
.modalTitle{
  font-weight:1000;
  font-size:18px;
  margin-bottom:10px;
}
.modalText{
  color:rgba(255,255,255,.88);
  line-height:1.75;
  margin-bottom:12px;
}
.modalBtnMain{
  width:100%;
  padding:12px 14px;
  border-radius:16px;
  border:0;
  font-weight:1000;
  cursor:pointer;
  color:#fff;
  background:
    radial-gradient(140px 120px at 30% 10%, rgba(255,213,106,.35), transparent 60%),
    linear-gradient(135deg,var(--accent),var(--accent2));
}
.modalBtnMain:hover{ filter: brightness(1.05); }
.modalBtnMain:active{ transform: scale(.99); }

/* responsive */
@media (max-width:420px){
  body{ padding:16px; }
  .badgeNY{ font-size:12px; }
}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  .bgGlow,.confetti,.heroGlow,.btnMain:before{ animation:none !important; }
}
</style>
</head>

<body>
<div class="bgGlow" aria-hidden="true"></div>
<div class="confetti" aria-hidden="true"></div>

<div class="card">

  <div class="headerRow">
    <div class="badgeNY"><span class="badgeDot"></span> NEW YEAR 2569</div>
    <div class="pill">üîí 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå</div>
  </div>

  <div class="heroWrap">
    <img class="hero"
      src="https://img5.pic.in.th/file/secure-sv1/photo_--_--2bb7d3a2870ef8d6.jpg"
      alt="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ"
      loading="eager" decoding="async"/>
    <div class="heroGlow" aria-hidden="true"></div>
  </div>

  <h1>üéÅ ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏à‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 38,888 ‡∏ö‡∏≤‡∏ó üéÅ</h1>
  <p class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏∏‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 50 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</p>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

  <div class="row">
    <button id="btnCheck" class="btnAlt" type="button" disabled>‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
    <button id="btnJoin"  class="btnMain" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
  </div>

  <button id="btnPoll" class="fullBtn" type="button" disabled>
    ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î
  </button>

  <div id="msg" class="msg"></div>

  <div id="copyWrap" class="copyBox">
    <div id="promoCode" class="copyCode">RRXXXXXXXX</div>
    <button id="btnCopy" class="copyBtn" type="button">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
  </div>

  <a id="goRedeem" class="goLink" href="https://rumruay365.uk/events/free-credit" target="_blank" rel="noopener">
    üëâ ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ
  </a>

  <div class="hint">
    * ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ<br>
    * ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
    * üîí ‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î: 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå (‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå)
    <div class="smallNote" id="devNote"></div>
  </div>

</div>

<div id="ruleModal" class="modal" aria-hidden="true">
  <div class="modalCard" role="dialog" aria-modal="true">
    <div class="modalTitle">üìå ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô)</div>
    <div class="modalText">
      1) ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö 365 ‡∏ö‡∏≤‡∏ó<br>
      2) ‡∏ó‡∏≥‡∏¢‡∏≠‡∏î 10 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ 10 ‡πÄ‡∏ó‡πà‡∏≤<br>
      3) üîí 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á / 1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>
      4) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
    </div>
    <button class="modalBtnMain" id="modalAcknowledge" type="button">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
  </div>
</div>

<script>
/* üî¥ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå exec ‡∏Ç‡∏≠‡∏á Google Apps Script */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyokjZuq_w45cvwNjSGcjlcH1xpMLi_0K7jG84a5sm7EuIKTDIBF9Uzw4_yisVP9KtTJA/exec";
const REDEEM_URL = "https://rumruay365.uk/events/free-credit";

/* DOM */
const $phone=document.getElementById("phone");
const $btnCheck=document.getElementById("btnCheck");
const $btnJoin=document.getElementById("btnJoin");
const $btnPoll=document.getElementById("btnPoll");
const $msg=document.getElementById("msg");
const $copyWrap=document.getElementById("copyWrap");
const $promoCode=document.getElementById("promoCode");
const $btnCopy=document.getElementById("btnCopy");
const $ruleModal=document.getElementById("ruleModal");
const $modalAck=document.getElementById("modalAcknowledge");
const $goRedeem=document.getElementById("goRedeem");
const $devNote=document.getElementById("devNote");

function openRule(){ $ruleModal.classList.add("show"); document.body.style.overflow="hidden"; }
function closeRule(){ $ruleModal.classList.remove("show"); document.body.style.overflow=""; }
$modalAck.onclick=closeRule;

function show(t,type="ok"){
  $msg.style.display="block";
  $msg.className="msg "+(type==="err"?"err":"ok");
  $msg.textContent=t;
}
function hideMsg(){ $msg.style.display="none"; $msg.textContent=""; }
function hideCopy(){
  $copyWrap.style.display="none";
  $promoCode.textContent="RRXXXXXXXX";
  $goRedeem.style.display="none";
  $goRedeem.href = REDEEM_URL;
}
function setButtons(enabled){
  $btnCheck.disabled = !enabled;
  $btnPoll.disabled  = !enabled;
  if(!enabled) $btnJoin.disabled = true;
}
function note(t){ $devNote.textContent = t || ""; }

/* phone normalize */
function normalizePhone(v){
  let s=String(v||"").trim(); const th="‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
  for(let i=0;i<th.length;i++) s=s.replace(new RegExp(th[i],"g"),String(i));
  let p=s.replace(/\D/g,"");
  if(p.startsWith("0066")) p=p.slice(2);
  if(p.startsWith("66")) p="0"+p.slice(2);
  if(!p.startsWith("0") && p.length===9) p="0"+p;
  return /^0[689]\d{8}$/.test(p)?p:"";
}

/* JSONP */
function jsonp(params){
  return new Promise((res,rej)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    params.callback=cb;
    params._ts=Date.now();
    const s=document.createElement("script");
    s.src = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
    window[cb]=(d)=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); res(d); };
    s.onerror=()=>{ try{ delete window[cb]; }catch(_){ window[cb]=undefined; } s.remove(); rej(new Error("JSONP_ERROR")); };
    document.body.appendChild(s);
  });
}

/* copy */
$btnCopy.onclick=async()=>{
  const t=$promoCode.textContent.trim(); if(!t) return;
  try{
    await navigator.clipboard.writeText(t);
    $btnCopy.classList.add("copied");
    setTimeout(()=> $btnCopy.classList.remove("copied"), 1200);
  }catch(_){}
};

/* ======================================================
   ‚úÖ ‡∏™‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ GAS ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì device_key ‡πÄ‡∏≠‡∏á
   (‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ GAS ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ UA ‡∏ó‡∏≥ key)
====================================================== */
let READY=false;
let PROF=null;

function getProf(){
  const tz = (Intl.DateTimeFormat().resolvedOptions().timeZone || "");
  const scrW = screen.width || 0;
  const scrH = screen.height || 0;
  const dpr  = window.devicePixelRatio || 1;
  const cd   = screen.colorDepth || 0;
  const plat = (navigator.platform || "");
  const hc   = navigator.hardwareConcurrency || 0;
  const dm   = navigator.deviceMemory || 0;
  const lang = navigator.language || "";
  const mtp  = navigator.maxTouchPoints || 0;
  const touch = ("ontouchstart" in window) ? 1 : 0;

  // webgl vendor/renderer (‡∏°‡∏±‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå)
  let glv="", glr="";
  try{
    const c=document.createElement("canvas");
    const gl=c.getContext("webgl")||c.getContext("experimental-webgl");
    if(gl){
      const dbg = gl.getExtension("WEBGL_debug_renderer_info");
      glv = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);
      glr = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
    }
  }catch(_){}

  return {
    tz,
    scrW, scrH, dpr, cd,
    plat, hc, dm,
    lang, mtp, touch,
    glv: String(glv||"").slice(0,120),
    glr: String(glr||"").slice(0,200),
  };
}

async function ensureReady(){
  if(READY && PROF) return PROF;
  setButtons(false);
  PROF=getProf();
  READY=true;
  note(`Device: ${PROF.scrW}x${PROF.scrH}@${PROF.dpr} | ${PROF.tz}`);
  setButtons(true);
  return PROF;
}
window.addEventListener("load", ()=>ensureReady());

async function payloadBase(phone){
  const p = await ensureReady();
  const ua = navigator.userAgent || "";
  return {
    phone,
    ua,
    tz: p.tz,
    scrW: p.scrW, scrH: p.scrH, dpr: p.dpr, cd: p.cd,
    plat: p.plat, hc: p.hc, dm: p.dm,
    lang: p.lang, mtp: p.mtp, touch: p.touch,
    glv: p.glv, glr: p.glr,
    // ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÄ‡∏ú‡∏∑‡πà‡∏≠ log
    screen: `${p.scrW}x${p.scrH}@${p.dpr}`,
    webgl: `${p.glv}|${p.glr}`.slice(0,220),
  };
}

/* actions */
$btnCheck.onclick=async()=>{
  hideMsg(); hideCopy(); $btnJoin.disabled=true;
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }
  const base = await payloadBase(p);
  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...");
  const d=await jsonp({action:"check", ...base}).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }
  if(!d.ok){ show(d.msg || "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç","err"); return; }
  show(d.msg || "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ","ok");
  $btnJoin.disabled=false;
};

$btnJoin.onclick=async()=>{
  hideMsg(); hideCopy();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }
  const base = await payloadBase(p);
  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°...");
  const d=await jsonp({action:"register", ...base}).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }
  if(!d.ok){ show(d.msg || "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","err"); return; }
  show(d.msg || "‚úÖ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ","ok");
  openRule();
};

$btnPoll.onclick=async()=>{
  hideMsg(); hideCopy();
  const p=normalizePhone($phone.value);
  if(!p){ show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","err"); return; }
  const base = await payloadBase(p);
  show("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...");
  const d=await jsonp({action:"poll", ...base}).catch(()=>null);
  if(!d){ show("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ SCRIPT_URL / Deploy)","err"); return; }
  if(!d.ok){ show(d.msg || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°","err"); return; }

  if(d.status==="APPROVED" && d.promo_code){
    $promoCode.textContent=d.promo_code;
    $copyWrap.style.display="flex";
    $goRedeem.style.display="block";
    $goRedeem.href = REDEEM_URL;
    show("üéâ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢\n‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ‚Äù","ok");
    openRule();
    return;
  }
  if(d.status==="PENDING"){ show("‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ä‡πá‡∏Ñ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ","ok"); return; }
  if(d.status==="REJECTED"){ show("‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô","err"); return; }
  if(d.status==="USED"){ show("‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß","err"); return; }

  show(d.msg || ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: "+(d.status||"UNKNOWN")),"ok");
};
</script>
</body>
</html>
