<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
<style>
  body{font-family:system-ui;background:#0b0b0b;color:#fff;margin:0;padding:24px}
  .card{max-width:560px;margin:0 auto;background:#141414;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px}
  h1{font-size:20px;margin:0 0 8px}
  p{opacity:.85;margin:0 0 14px;line-height:1.55}
  label{display:block;margin:10px 0 6px;opacity:.9}
  input{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f0f0f;color:#fff;font-size:16px}
  button{width:100%;padding:12px 14px;border-radius:12px;border:0;background:#ff2b2b;color:#fff;font-size:16px;font-weight:700;cursor:pointer;margin-top:12px}
  button.secondary{background:#8d1a1a}
  button:disabled{opacity:.55;cursor:not-allowed}
  .msg{margin-top:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);white-space:pre-line;display:none}
  .ok{border-color:rgba(0,255,140,.25)} .err{border-color:rgba(255,60,60,.35)}
  .small{font-size:12px;opacity:.7;margin-top:10px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .chip{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);opacity:.9}
</style>
</head>
<body>
<div class="card">
  <h1>üìå ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>
  <p>‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå/1 ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå) ‡πÅ‡∏•‡∏∞ 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå/1 ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>

  <div class="row" style="margin-bottom:10px">
    <span class="chip" id="modeChip">‡πÇ‡∏´‡∏°‡∏î: JSONP (‡∏Å‡∏±‡∏ô CORS)</span>
    <button class="secondary" type="button" id="toggleMode" style="width:auto;margin-top:0">‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î</button>
  </div>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111"/>

  <button id="btnCheck" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
  <button id="btnJoin" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>

  <div id="msg" class="msg"></div>
  <div class="small">* ‡∏ñ‡πâ‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏°‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</div>
</div>

<script>
  // ‚úÖ ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Web App /exec ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxUZCsjvLddELLdNv1ahZnH_mPHGYgLZxsm9iAYflM504Vx8OXMbqOR3Vdkeg0r8EQ3wA/exec";

  // ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£: "jsonp" (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) ‡∏´‡∏£‡∏∑‡∏≠ "fetch"
  let MODE = "jsonp";

  const DEVICE_JOIN_KEY = "rr365_joined_activity";
  const DEVICE_ID_KEY   = "rr365_device_id";

  const $phone = document.getElementById("phone");
  const $btnCheck = document.getElementById("btnCheck");
  const $btnJoin  = document.getElementById("btnJoin");
  const $msg = document.getElementById("msg");
  const $modeChip = document.getElementById("modeChip");
  const $toggleMode = document.getElementById("toggleMode");

  function show(text, type="ok"){
    $msg.style.display="block";
    $msg.className="msg "+(type==="err"?"err":"ok");
    $msg.textContent=text;
  }

  function normalizePhone(v){
    let p=(v||"").replace(/\D/g,"");
    if(!p) return "";
    if(p.startsWith("66")) p="0"+p.slice(2);
    if(p.length===9) p="0"+p;
    if(p.length===10 && p.startsWith("0")) return p;
    return "";
  }

  function getOrCreateDeviceId(){
    let id = localStorage.getItem(DEVICE_ID_KEY);
    if(!id){
      id = "dev_"+Math.random().toString(36).slice(2)+Date.now().toString(36);
      localStorage.setItem(DEVICE_ID_KEY,id);
    }
    return id;
  }

  function alreadyJoined(){
    return localStorage.getItem(DEVICE_JOIN_KEY)==="1";
  }
  function markJoined(){
    localStorage.setItem(DEVICE_JOIN_KEY,"1");
  }

  function updateModeUI(){
    $modeChip.textContent = MODE==="jsonp" ? "‡πÇ‡∏´‡∏°‡∏î: JSONP (‡∏Å‡∏±‡∏ô CORS)" : "‡πÇ‡∏´‡∏°‡∏î: fetch (‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏ï‡∏¥‡∏î CORS)";
  }
  updateModeUI();

  $toggleMode.addEventListener("click", ()=>{
    MODE = (MODE==="jsonp") ? "fetch" : "jsonp";
    updateModeUI();
    show("‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏•‡∏≠‡∏á
