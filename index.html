<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;background:#0b0b0b;color:#fff;margin:0;padding:24px}
    .card{max-width:520px;margin:0 auto;background:#141414;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:18px}
    h1{font-size:20px;margin:0 0 8px}
    p{opacity:.85;margin:0 0 14px;line-height:1.55}
    label{display:block;margin:10px 0 6px;opacity:.9}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f0f0f;color:#fff;font-size:16px;outline:none}
    button{width:100%;padding:12px 14px;border-radius:12px;border:0;background:#ff2b2b;color:#fff;font-size:16px;font-weight:700;cursor:pointer;margin-top:12px}
    button:disabled{opacity:.55;cursor:not-allowed}
    .msg{margin-top:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);white-space:pre-line}
    .ok{border-color:rgba(0,255,140,.25)}
    .err{border-color:rgba(255,60,60,.35)}
    .small{font-size:12px;opacity:.7;margin-top:10px}
  </style>
</head>
<body>
  <div class="card">
    <h1>üìå ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>
    <p>‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå / 1 ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå) ‡πÅ‡∏•‡∏∞ 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå / 1 ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>

    <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
    <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0991234567" maxlength="14" />

    <button id="btnCheck" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
    <button id="btnJoin" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>

    <div id="msg" class="msg" style="display:none;"></div>
    <div class="small">* ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏°‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</div>
  </div>

<script>
  // ‚úÖ ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script Web App
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwlyuP4kR3fQwQ5vaIc8o3-tqoyUcbOe9bQvtct0BsKzWEskrom7fwPhLe7s3Tdstnx/exec";

  // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡∏≤‡∏Å‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const NEXT_URL = ""; // ‡πÄ‡∏ä‡πà‡∏ô "activity.html"

  // ‚úÖ ‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (localStorage)
  const DEVICE_JOIN_KEY = "rr365_joined_activity";
  const DEVICE_ID_KEY   = "rr365_device_id";

  const $phone = document.getElementById("phone");
  const $msg = document.getElementById("msg");
  const $btnCheck = document.getElementById("btnCheck");
  const $btnJoin = document.getElementById("btnJoin");

  function showMsg(text, type="ok"){
    $msg.style.display = "block";
    $msg.className = "msg " + (type === "err" ? "err" : "ok");
    $msg.textContent = text;
  }

  function onlyDigits(v){ return (v||"").replace(/\D/g,""); }

  function normalizePhone(v){
    let p = onlyDigits(v);
    if (!p) return "";
    if (p.startsWith("66")) p = "0" + p.slice(2);
    if (p.length === 9) p = "0" + p;
    if (p.length === 10 && p.startsWith("0")) return p;
    return "";
  }

  function deviceAlreadyJoined(){
    return localStorage.getItem(DEVICE_JOIN_KEY) === "1";
  }
  function markDeviceJoined(){
    localStorage.setItem(DEVICE_JOIN_KEY, "1");
  }

  function getOrCreateDeviceId(){
    let id = localStorage.getItem(DEVICE_ID_KEY);
    if (!id){
      id = "dev_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
      localStorage.setItem(DEVICE_ID_KEY, id);
    }
    return id;
  }

  // ‚úÖ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô)
  if (deviceAlreadyJoined()) {
    document.body.innerHTML = `
      <div style="
        max-width:520px;margin:80px auto;background:#141414;color:#fff;border-radius:16px;
        padding:24px;text-align:center;font-family:system-ui;border:1px solid rgba(255,60,60,.35)
      ">
        <h2 style="margin:0 0 10px">‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
        <p style="line-height:1.7;margin:0">
          ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß<br>
          ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
        </p>
      </div>
    `;
    throw new Error("DEVICE_ALREADY_JOINED");
  }

  async function post(action){
    const phone = normalizePhone($phone.value);
    if (!phone){
      showMsg("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 0991234567)", "err");
      $btnJoin.disabled = true;
      return null;
    }

    $btnCheck.disabled = true;
    $btnJoin.disabled = true;

    try{
      const res = await fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          action,
          phone,
          userAgent: navigator.userAgent,
          deviceId: getOrCreateDeviceId()
        })
      });
      return await res.json();
    }catch(e){
      showMsg("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "err");
      return null;
    }finally{
      $btnCheck.disabled = false;
    }
  }

  $btnCheck.addEventListener("click", async ()=>{
    const data = await post("check");
    if (!data) return;

    if (data.ok && data.exists === false){
      showMsg("‚úÖ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
      $btnJoin.disabled = false;
    } else if (data.ok && data.exists === true){
      showMsg("‚ö†Ô∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ)", "err");
      $btnJoin.disabled = true;
    } else {
      showMsg(data.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "err");
      $btnJoin.disabled = true;
    }
  });

  $btnJoin.addEventListener("click", async ()=>{
    const data = await post("register");
    if (!data) return;

    if (data.ok && data.registered){
      showMsg("üéâ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß\n‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...", "ok");

      // ‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô)
      markDeviceJoined();

      $btnJoin.disabled = true;

      if (NEXT_URL){
        setTimeout(()=> window.location.href = NEXT_URL, 600);
      }
    } else if (data.ok && data.exists){
      showMsg("‚ö†Ô∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ", "err");
      $btnJoin.disabled = true;
    } else {
      showMsg(data.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "err");
      $btnJoin.disabled = true;
    }
  });

  $phone.addEventListener("input", ()=>{ $btnJoin.disabled = true; });
</script>
</body>
</html>
