<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏•‡∏∏‡πâ‡∏ô‡πÇ‡∏ä‡∏Ñ | ‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@700&display=swap" rel="stylesheet">
  <style>
    html, body { margin:0; padding:0; height:100%; font-family:'Sarabun',sans-serif; overflow-x:hidden; }
    body { background: linear-gradient(-45deg, #ffcc00, #ff9900, #ffd700, #fff4c2);
           background-size: 400% 400%; animation: gradientMove 15s ease infinite; }
    @keyframes gradientMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    #particles-js { position:fixed; width:100%; height:100%; z-index:0; }

    .promo-banner { text-align:center; margin:20px auto 10px; z-index:2; position:relative; }
    .promo-banner img { max-width:90%; border-radius:14px; box-shadow:0 6px 16px rgba(0,0,0,0.4); }

    .container { position:relative; z-index:1; text-align:center; color:#fff8dc;
      background:rgba(0,0,0,0.4); padding:20px; border-radius:18px;
      box-shadow:0 0 15px rgba(255,215,0,0.5); max-width:500px; margin:0 auto 16px; }
    .logo { width:150px; margin-bottom:16px; filter:drop-shadow(2px 2px 4px #000); }
    h2 { font-size:26px; color:#ffd700; text-shadow:0 0 5px #fff, 0 0 12px #ff9900; }

    input, button { padding:12px; font-size:16px; border-radius:10px; margin-bottom:8px;
      width:90%; max-width:300px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    input { border:2px solid #ffcc00; color:#5a2e00; font-weight:bold; text-align:center; }
    button { background:linear-gradient(to right,#ffd700,#ff9900); color:#3b1c00; font-weight:bold; border:none; cursor:pointer; }

    #cards { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:20px; }
    .card { width:90px; height:130px; perspective:1000px; position:relative; }
    .inner-card { width:100%; height:100%; transition:transform 0.8s; transform-style:preserve-3d; position:relative; }
    .card.opened .inner-card { transform: rotateY(180deg); }
    .front, .back { position:absolute; width:100%; height:100%; border-radius:12px; backface-visibility:hidden;
      display:flex; align-items:center; justify-content:center; font-size:32px; font-weight:bold;
      border:3px solid gold; box-shadow:0 4px 10px rgba(0,0,0,0.3); }
    .front { background:#fff8dc; color:#b71c1c; }
    .back  { background:#ffd700; transform:rotateY(180deg); animation:glow 1s infinite alternate; position:relative; flex-direction:column; }
    .back span { font-size:42px; font-weight:bold; color:#b71c1c; }
    @keyframes glow { from{box-shadow:0 0 10px #ffd700;} to{box-shadow:0 0 20px #fff200;} }

    /* LeaderBoard */
    .winners{ margin:16px auto 32px; max-width:500px; background:rgba(255, 215, 0, 0.08);
      border:1px solid rgba(255, 215, 0, 0.35); border-radius:14px; box-shadow:0 0 12px rgba(255,215,0,0.2) inset; overflow:hidden; }
    .winners-head{ padding:10px 14px; background:linear-gradient(90deg, rgba(255,215,0,0.25), rgba(255,153,0,0.25));
      color:#ffd700; font-weight:bold; letter-spacing:0.3px; display:flex; align-items:center; gap:8px;
      border-bottom:1px solid rgba(255,215,0,0.3); }
    .winner-list{ list-style:none; margin:0; padding:8px 12px; max-height:160px; overflow:hidden; }
    .winner-list li{ display:flex; justify-content:space-between; align-items:center;
      color:#fff8dc; padding:8px 6px; border-bottom:1px dashed rgba(255,215,0,0.15); font-size:15px; }
    .winner-list li .badge{ background:#22c55e; color:#0b2a0f; font-weight:bold; font-size:12px;
      padding:4px 8px; border-radius:999px; box-shadow:0 0 8px rgba(34,197,94,0.4); }
    .winner-list li .time{ opacity:0.8; font-size:12px; margin-left:10px; }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <div class="promo-banner">
    <img src="https://img2.pic.in.th/pic/af6959cb-b96e-4226-a8c0-d88a46878070.png" alt="‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏Ñ">
  </div>

  <div class="container">
    <img class="logo" src="https://img2.pic.in.th/pic/1735020594-1.png" alt="‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365">
    <h2>üÇ™ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏•‡∏∏‡πâ‡∏ô‡πÇ‡∏ä‡∏Ñ | ‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365</h2>

    <input type="text" id="phone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" maxlength="10"><br>
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    <div id="quotaInfo"></div>

    <div id="captureZone">
      <div id="cards"></div>
      <div id="rewardDisplay"></div>
    </div>

    <button id="captureBtn" style="display:none;">üì∏ ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</button>
  </div>

  <!-- LeaderBoard -->
  <div class="winners">
    <div class="winners-head">üéâ ‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</div>
    <ul id="winnerList" class="winner-list"></ul>
  </div>

  <audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_72b2a6d7f8.mp3" preload="auto"></audio>
  <audio id="jackpotSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b9b19751f3.mp3" preload="auto"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    /* ===== URL Web App ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á Deploy ===== */
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxr21EPWtoJmklKESgEFX4f2MM9aal3BwEN-gmLdk2X92clTvhmsDHOMpanmWyUHss/exec';

    /* === ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ === */
    const WIN_NUMBER = 6;          // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡πÄ‡∏î‡∏¥‡∏° 10)
    const JACKPOT_INCLUDE_RATE = 0.30; // ~‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞‡∏£‡∏ß‡∏° ‚âà rate/6

    const WINNER_FETCH_URL = () => scriptURL + '?mode=winners&day=today&t=' + Date.now();
    const WINNER_REFRESH_MS = 30000;

    let hasFlipped = false;

    document.getElementById('startBtn').addEventListener('click', startGame);

    async function startGame() {
      const btn = document.getElementById('startBtn');
      const phone = document.getElementById("phone").value.trim();
      if (!/^0[0-9]{9}$/.test(phone)) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); return; }

      btn.disabled = true; const oldTxt = btn.textContent; btn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
      const formData = new FormData(); formData.append("phone", phone);

      try {
        const res = await fetch(scriptURL, { method: 'POST', body: formData });
        const data = await res.json();
        if (data.error) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + data.error); return; }

        if (typeof data.limit !== 'undefined') {
          const left = Math.max(0, (data.limit || 1) - (data.playedToday || 0));
          document.getElementById('quotaInfo').textContent =
            `‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${left}/${data.limit || 1}`;
        }

        if (data.alreadyPlayed) {
          alert(`‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡πÅ‡∏•‡πâ‡∏ß (${data.playedToday}/${data.limit})`);
          return;
        }
        showCards(phone);
      } catch {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ");
      } finally {
        btn.disabled = false; btn.textContent = oldTxt;
      }
    }

    function showCards(phone) {
      hasFlipped = false;
      document.getElementById("cards").innerHTML = "";
      document.getElementById("rewardDisplay").innerHTML = "";
      document.getElementById("captureBtn").style.display = "none";

      // ‡πÑ‡∏û‡πà 6 ‡πÉ‡∏ö: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 1-6 ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏∏‡πà‡∏° ‚Äú‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (WIN_NUMBER)‚Äù ‡∏ï‡∏≤‡∏° JACKPOT_INCLUDE_RATE
      let numbers = [1, 2, 3, 4, 5, 6];
      if (Math.random() < JACKPOT_INCLUDE_RATE) {
        const idx = Math.floor(Math.random() * numbers.length);
        numbers[idx] = WIN_NUMBER;          // << ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
      }
      numbers = shuffleArray(numbers);

      numbers.forEach(num => {
        const wrapper = document.createElement("div");
        wrapper.className = "card";

        const inner = document.createElement("div");
        inner.className = "inner-card";

        const front = document.createElement("div");
        front.className = "front"; front.textContent = "?";

        const back = document.createElement("div");
        back.className = "back";

        const label = document.createElement("span");
        label.textContent = num;

        back.appendChild(label);
        inner.appendChild(front); inner.appendChild(back);
        wrapper.appendChild(inner);

        wrapper.onclick = () => flipCard(wrapper, num, phone);
        document.getElementById("cards").appendChild(wrapper);
      });
    }

    function celebrateConfetti() {
      const duration = 2000;
      const animationEnd = Date.now() + duration;
      const defaults = { startVelocity: 35, spread: 360, ticks: 60, zIndex: 9999 };
      const iv = setInterval(() => {
        const timeLeft = animationEnd - Date.now();
        if (timeLeft <= 0) return clearInterval(iv);
        confetti(Object.assign({}, defaults, {
          particleCount: 80 * (timeLeft / duration),
          origin: { x: Math.random(), y: Math.random() - 0.2 }
        }));
      }, 200);
    }

    function flipCard(card, number, phone) {
      if (hasFlipped) return;
      document.getElementById('flipSound').play();
      card.classList.add("opened");
      hasFlipped = true;

      document.querySelectorAll('.card').forEach(c => c.onclick = null);

      let message = "";
      if (number === WIN_NUMBER) {           // << ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏ô‡∏∞‡∏î‡πâ‡∏ß‡∏¢ WIN_NUMBER
        document.getElementById('jackpotSound').play();
        celebrateConfetti();
        message = `üéâ ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç <b>${number}</b><br>‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏û‡∏µ‡πà‡∏ô‡∏∞‡∏Ñ‡∏∞ üéâ<br>üì∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞`;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï LeaderBoard ‡∏ù‡∏±‡πà‡∏á client ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        pushWinnerImmediate({phone, reward: WIN_NUMBER, ts: Date.now()});
      } else {
        message = `üò¢ ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç <b>${number}</b><br>‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞`;
      }

      document.getElementById("rewardDisplay").innerHTML = `<div class='reward-text'>${message}</div>`;
      document.getElementById("captureBtn").style.display = "inline-block";

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
      const formData = new FormData();
      formData.append("phone", phone);
      formData.append("reward", number);
      fetch(scriptURL, { method: 'POST', body: formData }).catch(()=>{});
    }

    document.getElementById("captureBtn").addEventListener("click", () => {
      html2canvas(document.getElementById("captureZone")).then(canvas => {
        const link = document.createElement("a");
        link.download = "‡∏ú‡∏•‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365.png";
        link.href = canvas.toDataURL();
        link.click();
      });
    });

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    /* ===== LeaderBoard ===== */
    function maskPhone(p){
      const s = String(p||'');
      if (/[xX]/.test(s)) return s;
      const n = s.replace(/\D/g,'').padStart(10,'0').slice(-10);
      return `${n.slice(0,2)}x-xxx-${n.slice(6,8)}xx`;
    }
    function timeAgo(ts){
      try{
        const t = typeof ts === 'number' ? ts : new Date(ts).getTime();
        let diff = Math.floor((Date.now() - t)/1000);
        if (!isFinite(diff)) diff = 0;
        diff = Math.max(0, diff);
        if (diff < 60)   return `${diff} ‡∏ß‡∏¥`;
        if (diff < 3600) return `${Math.floor(diff/60)} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        if (diff < 86400)return `${Math.floor(diff/3600)} ‡∏ä‡∏°.`;
        return `${Math.floor(diff/86400)} ‡∏ß‡∏±‡∏ô`;
      }catch{ return ''; }
    }
    function renderWinners(list){
      const ul = document.getElementById('winnerList');
      if(!ul) return;
      ul.innerHTML = '';
      list.forEach(w=>{
        const li = document.createElement('li');
        const left = document.createElement('div');
        left.textContent = `${maskPhone(w.phone)} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç ${w.reward}`;
        const right = document.createElement('div');
        const badge = document.createElement('span'); badge.className = 'badge';
        badge.textContent = (w.reward === WIN_NUMBER ? 'JACKPOT' : '‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ'); // ‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏¥‡∏á‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
        const tm = document.createElement('span'); tm.className = 'time';
        tm.textContent = `‚Ä¢ ${timeAgo(w.ts || Date.now())} ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
        right.appendChild(badge); right.appendChild(tm);
        li.appendChild(left); li.appendChild(right);
        ul.appendChild(li);
      });
    }
    function saveWinnerCache(list){ try{ localStorage.setItem('rr365_winners_cache', JSON.stringify({ts:Date.now(), list})); }catch{} }
    function loadWinnerCache(){ try{ const raw = localStorage.getItem('rr365_winners_cache'); return raw ? JSON.parse(raw).list : null; }catch{ return null; } }

    async function fetchWinners(){
      const res = await fetch(WINNER_FETCH_URL(), { cache:'no-store' });
      const ct = (res.headers.get('content-type') || '').toLowerCase();
      if (!res.ok || !ct.includes('application/json')) {
        throw new Error('Winners API not JSON ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Web App: Anyone');
      }
      const data = await res.json();
      if (Array.isArray(data)) { saveWinnerCache(data); return data; }
      return [];
    }
    async function loadWinners(){
      try{
        const winners = await fetchWinners();
        renderWinners(winners);
        startWinnersTicker();
      }catch(err){
        console.warn(err.message || err);
        const cached = loadWinnerCache();
        if (cached) renderWinners(cached);
      }
    }

    let tickerTimer = null;
    function startWinnersTicker(){
      if(tickerTimer) clearInterval(tickerTimer);
      tickerTimer = setInterval(()=>{
        const ul = document.getElementById('winnerList');
        if(!ul || ul.children.length < 2) return;
        const first = ul.children[0];
        ul.appendChild(first.cloneNode(true));
        ul.removeChild(first);
      }, 3500);
    }
    function pushWinnerImmediate(entry){
      const cached = loadWinnerCache() || [];
      const newList = [entry, ...cached].slice(0, 50);
      saveWinnerCache(newList);
      renderWinners(newList);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      loadWinners();
      setInterval(loadWinners, WINNER_REFRESH_MS);
    });

    particlesJS("particles-js", {
      particles: { number:{value:60}, size:{value:4}, color:{value:"#ffd700"}, opacity:{value:0.6}, move:{speed:1.5}, line_linked:{enable:false} },
      interactivity: { events: { onhover: { enable: false } } }
    });
  </script>
</body>
</html>

