<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ 2 ‡πÅ‡∏ä‡∏£‡πå</title>
<style>
  :root{
    --bg:#0b0b0b;
    --card:#141414;
    --line:rgba(255,255,255,.10);
    --txt:#fff;
    --muted:rgba(255,255,255,.75);
    --accent:#ff2b2b;
    --ok:#36d399;
    --err:#ff5a5f;
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;background:var(--bg);color:var(--txt);margin:0;padding:24px}
  .card{
    max-width:560px;margin:0 auto;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid var(--line);border-radius:var(--radius);padding:18px;
    box-shadow:0 18px 48px rgba(0,0,0,.55);
  }
  h1{font-size:20px;margin:0 0 8px}
  p{opacity:.9;margin:0 0 14px;line-height:1.55}
  label{display:block;margin:10px 0 6px;color:var(--muted)}
  input{
    width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
    background:#0f0f0f;color:#fff;font-size:16px;outline:none;
  }
  input:focus{border-color:rgba(255,43,43,.55); box-shadow:0 0 0 4px rgba(255,43,43,.15)}
  .btns{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
  button{
    width:100%;padding:12px 14px;border-radius:14px;border:0;
    background:var(--accent);color:#fff;font-size:16px;font-weight:800;
    cursor:pointer;transition:.12s;
  }
  button:hover{transform:translateY(-1px)}
  button:active{transform:translateY(0);opacity:.95}
  button.secondary{background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.14)}
  button:disabled{opacity:.55;cursor:not-allowed;transform:none}
  .msg{
    margin-top:12px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.25);white-space:pre-line;display:none;line-height:1.55
  }
  .msg.ok{border-color:rgba(54,211,153,.35)}
  .msg.err{border-color:rgba(255,90,95,.45)}
  .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.5}
  .hint{margin-top:8px;font-size:12px;color:rgba(255,255,255,.68)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .chip{
    display:inline-flex;align-items:center;gap:6px;
    padding:6px 10px;border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.25);
    color:rgba(255,255,255,.8);
    font-size:12px;
  }
  .dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.35)}
  .dot.ok{background:var(--ok)}
  .dot.err{background:var(--err)}
</style>
</head>
<body>
<div class="card">
  <div class="row" style="justify-content:space-between">
    <div>
      <h1>üìå ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ 2 ‡πÅ‡∏ä‡∏£‡πå</h1>
      <div class="hint">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</div>
    </div>
    <div class="chip" id="statusChip"><span class="dot" id="statusDot"></span><span id="statusText">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span></div>
  </div>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111" autocomplete="tel" />

  <div class="btns">
    <button id="btnCheck" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
    <button id="btnJoin"  type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
  </div>

  <div id="msg" class="msg"></div>
  <div class="small">*‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
</div>

<script>
  /***********************
    CONFIG
  ************************/
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxEUgC2DJfJrzfB1eseO5p37NKyEO5lVMFYu-CzGscDq3gYaESzEjcu_NK7Z9wDmOHc/exec"; // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ /exec
  const DEVICE_ID_KEY = "rr365_device_id";
  const LAST_PHONE_KEY = "rr365_last_phone";

  const $phone = document.getElementById("phone");
  const $btnCheck = document.getElementById("btnCheck");
  const $btnJoin  = document.getElementById("btnJoin");
  const $btnClear = document.getElementById("btnClear");
  const $msg = document.getElementById("msg");
  const $statusDot = document.getElementById("statusDot");
  const $statusText = document.getElementById("statusText");

  function setStatus(mode, text){
    $statusDot.className = "dot " + (mode==="ok" ? "ok" : mode==="err" ? "err" : "");
    $statusText.textContent = text || "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
  }

  function show(text, type="ok"){
    $msg.style.display="block";
    $msg.className="msg " + (type==="err" ? "err" : "ok");
    $msg.textContent = text;
  }

  function hideMsg(){
    $msg.style.display="none";
    $msg.textContent="";
  }

  function normalizePhone(v){
    let s = String(v||"").trim();
    const th = "‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
    for (let i=0;i<th.length;i++) s = s.replace(new RegExp(th[i],"g"), String(i));
    let p = s.replace(/\D/g,"");
    if(!p) return "";
    if(p.startsWith("0066")) p = p.slice(2);
    if(p.startsWith("66")) p = "0"+p.slice(2);
    if(!p.startsWith("0") && p.length===9) p="0"+p;
    if(p.length!==10) return "";
    if(!/^0[689]\d{8}$/.test(p)) return "";
    return p;
  }

  function getOrCreateDeviceId(){
    let id = localStorage.getItem(DEVICE_ID_KEY);
    if(!id){
      id = "dev_"+Math.random().toString(36).slice(2)+Date.now().toString(36);
      localStorage.setItem(DEVICE_ID_KEY,id);
    }
    return id;
  }

  function getFingerprint(){
    const data = [
      screen.width, screen.height,
      window.devicePixelRatio,
      Intl.DateTimeFormat().resolvedOptions().timeZone || "",
      navigator.language || "",
      navigator.platform || "",
      navigator.hardwareConcurrency || 0,
      navigator.maxTouchPoints || 0
    ].join("|");
    let hash = 0;
    for (let i=0;i<data.length;i++){
      hash = ((hash<<5)-hash) + data.charCodeAt(i);
      hash |= 0;
    }
    return "fp_" + Math.abs(hash);
  }

  function getUaKey(){
    const ua = navigator.userAgent || "";
    const key = [
      ua.includes("Android") ? (ua.match(/Android\s[\d\.]+/)||["Android"])[0] : "NA",
      (ua.match(/Chrome\/[\d\.]+/)||["Chrome"])[0],
      ua.includes("wv") ? "WV" : "NWV",
      ua.includes("Line") ? (ua.match(/Line\/[\d\.]+/)||["Line"])[0] : "NLINE",
      (ua.match(/Build\/[A-Za-z0-9\.\_]+/)||["Build"])[0]
    ].join("|");
    let h=0;
    for(let i=0;i<key.length;i++){ h=((h<<5)-h)+key.charCodeAt(i); h|=0; }
    return "ua_" + Math.abs(h);
  }

  // JSONP (‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î CORS)
  function jsonpRequest(params, timeoutMs=12000){
    return new Promise((resolve, reject)=>{
      if (!/\/exec(\?|$)/.test(SCRIPT_URL)) return reject(new Error("SCRIPT_URL_NOT_EXEC"));

      const cbName = "cb_" + Math.random().toString(36).slice(2);
      params.jsonp = "1";
      params.callback = cbName;
      params._ts = Date.now().toString(); // ‡∏Å‡∏±‡∏ô‡πÅ‡∏Ñ‡∏ä

      const url = SCRIPT_URL + "?" + new URLSearchParams(params).toString();

      const script = document.createElement("script");
      script.src = url;
      script.async = true;

      const t = setTimeout(()=>{ cleanup(); reject(new Error("TIMEOUT")); }, timeoutMs);

      window[cbName] = (data)=>{
        clearTimeout(t);
        cleanup();
        resolve(data);
      };
      script.onerror = ()=>{
        clearTimeout(t);
        cleanup();
        reject(new Error("SCRIPT_LOAD_ERROR"));
      };

      function cleanup(){
        try{ delete window[cbName]; }catch(e){ window[cbName]=undefined; }
        if(script && script.parentNode) script.parentNode.removeChild(script);
      }

      document.body.appendChild(script);
    });
  }

  async function request(action){
    hideMsg();
    const p = normalizePhone($phone.value);
    if(!p){
      show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (06/08/09 10 ‡∏´‡∏•‡∏±‡∏Å)", "err");
      return null;
    }

    // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    localStorage.setItem(LAST_PHONE_KEY, p);

    try{
      return await jsonpRequest({
        action,
        phone: p,
        deviceId: getOrCreateDeviceId(),
        fingerprint: getFingerprint(),
        ua_key: getUaKey(),
        userAgent: navigator.userAgent
      });
    }catch(err){
      const m = String(err.message||"");
      if (m === "SCRIPT_URL_NOT_EXEC"){
        show("‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ /exec ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "err");
      } else if (m === "TIMEOUT"){
        show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ä‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (Timeout) ‚Äî ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Deploy: Who has access = Anyone", "err");
      } else {
        show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Deploy/‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏ï‡πâ‡∏≠‡∏á Anyone) ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà", "err");
      }
      return null;
    }
  }

  function setBusy(isBusy, msg){
    $btnCheck.disabled = isBusy;
    $btnJoin.disabled  = isBusy ? true : $btnJoin.disabled;
    $btnClear.disabled = isBusy;
    setStatus(isBusy ? "warn" : "ok", isBusy ? (msg || "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...") : "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
  }

  $btnCheck.addEventListener("click", async ()=>{
    $btnJoin.disabled = true;
    setBusy(true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...");

    const data = await request("check");
    setBusy(false);

    if(!data) return;

    if(!data.ok){
      show(data.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "err");
      setStatus("err","‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
      return;
    }

    if(data.exists){
      show("‚ö†Ô∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ", "err");
      setStatus("err","‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô");
      return;
    }
    if(data.device_used){
      show("‚ö†Ô∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ", "err");
      setStatus("err","‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô");
      return;
    }

    show("‚úÖ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢", "ok");
    $btnJoin.disabled = false;
    setStatus("ok","‡∏ú‡πà‡∏≤‡∏ô");
  });

  $btnJoin.addEventListener("click", async ()=>{
    setBusy(true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°...");

    const data = await request("register");
    setBusy(false);

    if(!data) return;

    if(!data.ok){
      show(data.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "err");
      setStatus("err","‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
      return;
    }

    if(data.registered){
      show("üéâ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", "ok");
      setStatus("ok","‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      $btnJoin.disabled = true;
      return;
    }

    show(data.msg || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ", "err");
    setStatus("err","‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  });

  $btnClear.addEventListener("click", ()=>{
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö)
    localStorage.removeItem(DEVICE_ID_KEY);
    show("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ\n(‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï deviceId ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)", "ok");
  });

  // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  (function init(){
    const last = localStorage.getItem(LAST_PHONE_KEY);
    if(last) $phone.value = last;
    setStatus("ok","‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
  })();
</script>
</body>
</html>
