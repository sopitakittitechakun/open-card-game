<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ 2 ‡πÅ‡∏ä‡∏£‡πå</title>
<style>
  body{font-family:system-ui;background:#0b0b0b;color:#fff;margin:0;padding:24px}
  .card{max-width:560px;margin:0 auto;background:#141414;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px}
  h1{font-size:20px;margin:0 0 8px}
  p{opacity:.85;margin:0 0 14px;line-height:1.55}
  label{display:block;margin:10px 0 6px;opacity:.9}
  input{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f0f0f;color:#fff;font-size:16px}
  button{width:100%;padding:12px 14px;border-radius:12px;border:0;background:#ff2b2b;color:#fff;font-size:16px;font-weight:700;cursor:pointer;margin-top:12px}
  button:disabled{opacity:.55;cursor:not-allowed}
  .msg{margin-top:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
       background:rgba(255,255,255,.04);white-space:pre-line;display:none}
  .ok{border-color:rgba(0,255,140,.25)} .err{border-color:rgba(255,60,60,.35)}
  .small{font-size:12px;opacity:.75;margin-top:10px;line-height:1.5}
  .mini{font-size:11px;opacity:.65;margin-top:8px;word-break:break-all}
</style>
</head>
<body>
<div class="card">
  <h1>üìå ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ 2 ‡πÅ‡∏ä‡∏£‡πå</h1>
  <p>‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå/1 ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå) ‡πÅ‡∏•‡∏∞ 1 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå/1 ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</p>

  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
  <input id="phone" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0611111111" value=""/>

  <button id="btnCheck" type="button">‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
  <button id="btnJoin" type="button" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>

  <div id="msg" class="msg"></div>
  <div id="debug" class="mini"></div>

  <div class="small">*‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!!</div>
</div>

<script>
  // ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô /exec ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxYlmvidC8J8nvyteoOaF2IQJXFG6VQ2QdOrik4ojIae4a9U8OPX1PF4w1GDzCX1KxOmA/exec"; // ‡πÄ‡∏ä‡πà‡∏ô https://script.google.com/macros/s/xxxxx/exec
  const DEVICE_ID_KEY = "rr365_device_id";

  const $phone = document.getElementById("phone");
  const $btnCheck = document.getElementById("btnCheck");
  const $btnJoin  = document.getElementById("btnJoin");
  const $msg = document.getElementById("msg");
  const $debug = document.getElementById("debug");

  function show(text, type="ok"){
    $msg.style.display="block";
    $msg.className="msg "+(type==="err"?"err":"ok");
    $msg.textContent=text;
  }
  function debug(text){
    $debug.textContent = text || "";
  }

  function normalizePhone(v){
    let s = String(v||"").trim();
    const th = "‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô";
    for (let i=0;i<th.length;i++) s = s.replace(new RegExp(th[i],"g"), String(i));
    let p = s.replace(/\D/g,"");
    if(!p) return "";
    if(p.startsWith("0066")) p = p.slice(2);
    if(p.startsWith("66")) p = "0"+p.slice(2);
    if(!p.startsWith("0") && p.length===9) p="0"+p;
    if(p.length!==10) return "";
    if(!/^0[689]\d{8}$/.test(p)) return "";
    return p;
  }

  function getOrCreateDeviceId(){
    let id = localStorage.getItem(DEVICE_ID_KEY);
    if(!id){
      id = "dev_"+Math.random().toString(36).slice(2)+Date.now().toString(36);
      localStorage.setItem(DEVICE_ID_KEY,id);
    }
    return id;
  }

  function getFingerprint(){
    const data = [
      screen.width, screen.height,
      window.devicePixelRatio,
      Intl.DateTimeFormat().resolvedOptions().timeZone || "",
      navigator.language || "",
      navigator.platform || "",
      navigator.hardwareConcurrency || 0,
      navigator.maxTouchPoints || 0
    ].join("|");
    let hash = 0;
    for (let i=0;i<data.length;i++){ hash = ((hash<<5)-hash) + data.charCodeAt(i); hash |= 0; }
    return "fp_" + Math.abs(hash);
  }

  function getUaKey(){
    const ua = navigator.userAgent || "";
    const key = [
      ua.includes("Android") ? (ua.match(/Android\s[\d\.]+/)||["Android"])[0] : "NA",
      (ua.match(/Chrome\/[\d\.]+/)||["Chrome"])[0],
      ua.includes("wv") ? "WV" : "NWV",
      ua.includes("Line") ? (ua.match(/Line\/[\d\.]+/)||["Line"])[0] : "NLINE",
      (ua.match(/Build\/[A-Za-z0-9\.\_]+/)||["Build"])[0]
    ].join("|");
    let h=0; for(let i=0;i<key.length;i++){ h=((h<<5)-h)+key.charCodeAt(i); h|=0; }
    return "ua_" + Math.abs(h);
  }

  function jsonpRequest(params){
    return new Promise((resolve, reject)=>{
      if (!/\/exec(\?|$)/.test(SCRIPT_URL)){
        reject(new Error("SCRIPT_URL_NOT_EXEC"));
        return;
      }

      const cbName = "cb_" + Math.random().toString(36).slice(2);
      params.jsonp = "1";
      params.callback = cbName;
      params._ts = Date.now().toString(); // cache buster

      const qs = new URLSearchParams(params).toString();
      const url = SCRIPT_URL + "?" + qs;

      // ‚úÖ ‡πÇ‡∏ä‡∏ß‡πå URL ‡∏ó‡∏µ‡πà‡∏¢‡∏¥‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏´‡πâ‡∏Å‡πä‡∏≠‡∏õ‡πÄ‡∏ó‡∏™
      debug("DEBUG URL (‡∏Å‡πä‡∏≠‡∏õ‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ): " + url);

      const script = document.createElement("script");
      script.src = url;
      script.async = true;

      const t = setTimeout(()=>{ cleanup(); reject(new Error("TIMEOUT")); }, 12000);

      window[cbName] = (data)=>{ clearTimeout(t); cleanup(); resolve(data); };
      script.onerror = ()=>{ clearTimeout(t); cleanup(); reject(new Error("SCRIPT_LOAD_ERROR")); };

      function cleanup(){
        try{ delete window[cbName]; }catch(e){ window[cbName]=undefined; }
        if(script && script.parentNode) script.parentNode.removeChild(script);
      }

      document.body.appendChild(script);
    });
  }

  async function request(action){
    const p = normalizePhone($phone.value);
    if(!p){
      show("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (06/08/09 10 ‡∏´‡∏•‡∏±‡∏Å)", "err");
      return null;
    }

    try{
      return await jsonpRequest({
        action,
        phone: p,
        deviceId: getOrCreateDeviceId(),
        fingerprint: getFingerprint(),
        ua_key: getUaKey(),
        userAgent: navigator.userAgent
      });
    }catch(err){
      const m = String(err.message||"");
      if (m === "SCRIPT_URL_NOT_EXEC"){
        show("‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ /exec ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "err");
      } else if (m === "TIMEOUT"){
        show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Timeout) ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Deploy ‡πÄ‡∏õ‡πá‡∏ô Web app ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á Anyone ‡πÅ‡∏•‡πâ‡∏ß", "err");
      } else {
        show("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà Anyone / ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏¥‡∏î / Deploy ‡∏ú‡∏¥‡∏î‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô)", "err");
      }
      return null;
    }
  }

  $btnCheck.addEventListener("click", async ()=>{
    $btnCheck.disabled = true;
    $btnJoin.disabled = true;

    const data = await request("check");
    $btnCheck.disabled = false;

    if(!data) return;
    if(!data.ok){
      show(data.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "err");
      return;
    }
    if(data.exists){
      show("‚ö†Ô∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ", "err");
      return;
    }
    if(data.device_used){
      show("‚ö†Ô∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ", "err");
      return;
    }

    show("‚úÖ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢", "ok");
    $btnJoin.disabled = false;
  });

  $btnJoin.addEventListener("click", async ()=>{
    $btnCheck.disabled = true;
    $btnJoin.disabled = true;

    const data = await request("register");
    $btnCheck.disabled = false;

    if(!data) return;
    if(!data.ok){
      show(data.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "err");
      return;
    }
    if(data.registered){
      show("üéâ ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", "ok");
      return;
    }
    show(data.msg || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ", "err");
  });
</script>
</body>
</html>
