# RR365 ‚Äî ‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏° (‡πÅ‡∏Å‡πâ CORS ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ **GET** ‡∏ó‡∏∏‡∏Å endpoint)

> ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö GitHub Pages / ‡πÇ‡∏Æ‡∏™‡∏ï‡πå Static ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
>
> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏õ‡πá‡∏ô `GET` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡πâ‡∏≤‡∏ó‡πå‡πÉ‡∏ô Apps Script ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á `GET/POST` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ *Failed to fetch*

---

## 1) **index.html** (Frontend ‚Äî ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÅ‡∏ö‡∏ö GET)

```html
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏•‡∏∏‡πâ‡∏ô‡πÇ‡∏ä‡∏Ñ | ‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@700&display=swap" rel="stylesheet">
  <style>
    html, body { margin:0; padding:0; height:100%; font-family:'Sarabun',sans-serif; overflow-x:hidden; }
    body { background: linear-gradient(-45deg, #ffcc00, #ff9900, #ffd700, #fff4c2); background-size: 400% 400%; animation: gradientMove 15s ease infinite; }
    @keyframes gradientMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    #particles-js { position:fixed; width:100%; height:100%; z-index:0; }
    .promo-banner { text-align:center; margin:20px auto 10px; z-index:2; position:relative; }
    .promo-banner img { max-width:90%; border-radius:14px; box-shadow:0 6px 16px rgba(0,0,0,0.4); }
    .container { position:relative; z-index:1; text-align:center; color:#fff8dc; background:rgba(0,0,0,0.4); padding:20px; border-radius:18px; box-shadow:0 0 15px rgba(255,215,0,0.5); max-width:520px; margin:0 auto 16px; }
    .logo { width:150px; margin-bottom:16px; filter:drop-shadow(2px 2px 4px #000); }
    h2 { font-size:26px; color:#ffd700; text-shadow:0 0 5px #fff, 0 0 12px #ff9900; }
    input, button { padding:12px; font-size:16px; border-radius:10px; margin-bottom:8px; width:90%; max-width:340px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    input { border:2px solid #ffcc00; color:#5a2e00; font-weight:bold; text-align:center; }
    button { background:linear-gradient(to right,#ffd700,#ff9900); color:#3b1c00; font-weight:bold; border:none; cursor:pointer; }
    #cards { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:20px; }
    .card { width:90px; height:130px; perspective:1000px; position:relative; }
    .inner-card { width:100%; height:100%; transition:transform 0.8s; transform-style:preserve-3d; position:relative; }
    .card.opened .inner-card { transform: rotateY(180deg); }
    .front, .back { position:absolute; width:100%; height:100%; border-radius:12px; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; font-size:32px; font-weight:bold; border:3px solid gold; box-shadow:0 4px 10px rgba(0,0,0,0.3); }
    .front { background:#fff8dc; color:#b71c1c; }
    .back  { background:#ffd700; transform:rotateY(180deg); }
    .back span { font-size:42px; font-weight:bold; color:#b71c1c; }
    .winners{ margin:16px auto 32px; max-width:520px; background:rgba(255, 215, 0, 0.08); border:1px solid rgba(255, 215, 0, 0.35); border-radius:14px; box-shadow:0 0 12px rgba(255,215,0,0.2) inset; overflow:hidden; }
    .winners-head{ padding:10px 14px; background:linear-gradient(90deg, rgba(255,215,0,0.25), rgba(255,153,0,0.25)); color:#ffd700; font-weight:bold; letter-spacing:0.3px; display:flex; align-items:center; gap:8px; }
    .winner-list{ list-style:none; margin:0; padding:8px 12px; max-height:180px; overflow:auto; }
    .winner-list li{ display:flex; justify-content:space-between; align-items:center; color:#fff8dc; padding:8px 6px; border-bottom:1px dashed rgba(255,215,0,0.15); font-size:15px; }
    .winner-list li .badge{ background:#22c55e; color:#0b2a0f; font-weight:bold; font-size:12px; padding:4px 8px; border-radius:999px; box-shadow:0 0 8px rgba(34,197,94,0.4); }
    .winner-list li .time{ opacity:0.85; font-size:12px; margin-left:10px; }
    .empty{ padding:10px 14px; color:#fff; opacity:.85; }
    .pdpa { font-size:12px; color:#fff8dc; opacity:.9; margin-top:10px; }
    .ask-admin { display:inline-block; margin:6px 0 10px; color:#fff8dc; text-decoration:underline; }
    .error { max-width:520px; margin:0 auto 12px; background:rgba(190,0,0,.15); border:1px solid rgba(190,0,0,.35); color:#fff; padding:10px 14px; border-radius:12px; display:none; }
    .error b{ color:#fff }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="promo-banner"><img src="https://img5.pic.in.th/file/secure-sv1/photo_--_--72c7c95c2df97877.jpg" alt="‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏Ñ"></div>
  <div id="errBox" class="error"></div>
  <div class="container">
    <img class="logo" src="https://img2.pic.in.th/pic/1735020594-1.png" alt="‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365">
    <h2>üÇ™ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏•‡∏∏‡πâ‡∏ô‡πÇ‡∏ä‡∏Ñ | ‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365</h2>
    <input type="text" id="phone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" maxlength="10"><br>
    <input type="text" id="adminCode" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" maxlength="16"><br>
    <a id="askAdmin" class="ask-admin" href="https://t.me/YourAdminHandle" target="_blank">‡∏ó‡∏±‡∏Å‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏£‡∏´‡∏±‡∏™</a>
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    <div id="quotaInfo"></div>
    <div id="captureZone"><div id="cards"></div><div id="rewardDisplay"></div></div>
    <button id="captureBtn" style="display:none;">üì∏ ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</button>
    <div class="pdpa">‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ö‡∏≠‡∏£‡πå/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå/‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏à‡∏£‡∏¥‡∏ï</div>
  </div>
  <div class="winners"><div class="winners-head">üéâ ‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</div><ul id="winnerList" class="winner-list"></ul><div id="winnerEmpty" class="empty" style="display:none;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div>
  <audio id="flipSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_72b2a6d7f8.mp3" preload="auto"></audio>
  <audio id="jackpotSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b9b19751f3.mp3" preload="auto"></audio>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const ADMIN_TG_URL = 'https://t.me/YourAdminHandle';
    const scriptURL    = 'https://script.google.com/macros/s/AKfycbxE3eNkRid4V_5T3pkSR0SsTmzLOrkX87rKFlNPtxk0WQPccg1nZQTXBg3IXuUgQ6gV/exec';
    const WIN_NUMBER = 6;
    const JACKPOT_INCLUDE_RATE = 0.30;
    const WINNER_REFRESH_MS = 30000;

    document.addEventListener('DOMContentLoaded', ()=>{ const a=document.getElementById('askAdmin'); if(a&&ADMIN_TG_URL) a.href=ADMIN_TG_URL; });
    function showErr(msg){ const box=document.getElementById('errBox'); if(!box) return alert(msg); box.innerHTML='<b>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</b> '+(msg||'‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'); box.style.display='block'; setTimeout(()=>box.style.display='none',8000); }

    // ======== ‡πÉ‡∏ä‡πâ GET ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏Ç‡∏≠ ========
    async function postJSON(params){
      const url = scriptURL + '?' + new URLSearchParams(params).toString();
      const res = await fetch(url, { method:'GET', cache:'no-store' });
      if (!res.ok) throw new Error('HTTP '+res.status+' '+res.statusText);
      const ct = (res.headers.get('content-type')||'').toLowerCase();
      if (!ct.includes('application/json')){ const txt = await res.text(); throw new Error('‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON (‡∏ï‡∏£‡∏ß‡∏à Deploy/Anyone): '+txt.slice(0,140)); }
      return res.json();
    }

    function getDeviceId(){ let id=localStorage.getItem('rr365_device'); if(!id){ id=(crypto.randomUUID?crypto.randomUUID():String(Math.random()).slice(2)); localStorage.setItem('rr365_device', id);} return id; }
    function getSession(){ return localStorage.getItem('rr365_session')||''; }
    function setSession(tok){ localStorage.setItem('rr365_session', tok); }

    async function verifyAdminCode(phone, code){
      const data = await postJSON({ mode:'verify_admin_code', phone, code, deviceId:getDeviceId() });
      if(!data.ok || !data.session) throw new Error(data.error||'‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
      setSession(data.session); return true;
    }
    async function loadQuotaThenShow(phone){
      const data = await postJSON({ mode:'quota', phone, deviceId:getDeviceId(), session:getSession() });
      if(data.error) throw new Error(data.error);
      if(typeof data.limit!=='undefined'){ const left=Math.max(0,(data.limit||1)-(data.playedToday||0)); document.getElementById('quotaInfo').textContent=`‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${left}/${data.limit||1}`; }
      if(data.alreadyPlayed) throw new Error(`‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡πÅ‡∏•‡πâ‡∏ß (${data.playedToday}/${data.limit})`);
      showCards(phone);
    }

    document.getElementById('startBtn').addEventListener('click', startGame);
    async function startGame(){
      const btn=document.getElementById('startBtn');
      const phone=document.getElementById('phone').value.trim();
      const code=document.getElementById('adminCode').value.trim();
      if(!/^0[0-9]{9}$/.test(phone)) { showErr('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
      if(!code){ showErr('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô'); return; }
      btn.disabled=true; const oldTxt=btn.textContent; btn.textContent='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™...';
      try{ await verifyAdminCode(phone, code); await loadQuotaThenShow(phone); }
      catch(e){ console.error(e); showErr(e.message||'‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏ï‡∏£‡∏ß‡∏à Deploy/Anyone/URL)'); }
      finally{ btn.disabled=false; btn.textContent=oldTxt; }
    }

    let hasFlipped=false;
    function showCards(phone){
      hasFlipped=false; document.getElementById('cards').innerHTML=''; document.getElementById('rewardDisplay').innerHTML=''; document.getElementById('captureBtn').style.display='none';
      let numbers=[1,2,3,4,5,5]; if(Math.random()<JACKPOT_INCLUDE_RATE) numbers[Math.floor(Math.random()*numbers.length)]=WIN_NUMBER; numbers=shuffleArray(numbers);
      numbers.forEach(num=>{ const wrapper=document.createElement('div'); wrapper.className='card'; const inner=document.createElement('div'); inner.className='inner-card'; const front=document.createElement('div'); front.className='front'; front.textContent='?'; const back=document.createElement('div'); back.className='back'; const label=document.createElement('span'); label.textContent=num; back.appendChild(label); inner.appendChild(front); inner.appendChild(back); wrapper.appendChild(inner); wrapper.onclick=()=>flipCard(wrapper,num,phone); document.getElementById('cards').appendChild(wrapper); });
    }
    function flipCard(card, number, phone){
      if(hasFlipped) return; hasFlipped=true; document.getElementById('flipSound').play(); card.classList.add('opened'); document.querySelectorAll('.card').forEach(c=>c.onclick=null);
      let message=''; if(number===WIN_NUMBER){ document.getElementById('jackpotSound').play(); celebrateConfetti(); message=`üéâ ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç <b>${number}</b><br>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!<br>üì∏ ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå`; pushWinnerImmediate({phone,reward:WIN_NUMBER,ts:Date.now()}); } else { message=`üò¢ ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${phone} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç <b>${number}</b><br>‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏¢‡∏±‡∏á‡∏°‡∏µ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢`; }
      document.getElementById('rewardDisplay').innerHTML=`<div class='reward-text'>${message}</div>`; document.getElementById('captureBtn').style.display='inline-block';
      postJSON({ mode:'play', phone, reward:number, deviceId:getDeviceId(), session:getSession() }).catch(err=>console.warn('log play failed:', err.message));
    }

    document.getElementById('captureBtn').addEventListener('click',()=>{ html2canvas(document.getElementById('captureZone')).then(canvas=>{ const link=document.createElement('a'); link.download='‡∏ú‡∏•‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà.png'; link.href=canvas.toDataURL(); link.click(); }); });
    function celebrateConfetti(){ const duration=2000, end=Date.now()+duration; const defaults={ startVelocity:35, spread:360, ticks:60, zIndex:9999 }; const iv=setInterval(()=>{ const timeLeft=end-Date.now(); if(timeLeft<=0) return clearInterval(iv); if(window.confetti) window.confetti(Object.assign({},defaults,{ particleCount:80*(timeLeft/duration), origin:{x:Math.random(), y:Math.random()-0.2} })); },200); }
    function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    function maskPhone(p){ const s=String(p||''); if(/[xX]/.test(s)) return s; const n=s.replace(/\D/g,'').padStart(10,'0').slice(-10); return `${n.slice(0,2)}x-xxx-${n.slice(6,8)}xx`; }
    function timeAgo(ts){ try{ const t=typeof ts==='number'?ts:new Date(ts).getTime(); let d=Math.max(0,Math.floor((Date.now()-t)/1000)); if(d<60)return `${d} ‡∏ß‡∏¥`; if(d<3600)return `${Math.floor(d/60)} ‡∏ô‡∏≤‡∏ó‡∏µ`; if(d<86400)return `${Math.floor(d/3600)} ‡∏ä‡∏°.`; return `${Math.floor(d/86400)} ‡∏ß‡∏±‡∏ô`; }catch{return ''} }
    function renderWinners(list){ const ul=document.getElementById('winnerList'); const empty=document.getElementById('winnerEmpty'); ul.innerHTML=''; if(!list||list.length===0){ empty.style.display='block'; return;} empty.style.display='none'; list.forEach(w=>{ const li=document.createElement('li'); const left=document.createElement('div'); left.textContent=`${maskPhone(w.phone)} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç ${w.reward}`; const right=document.createElement('div'); const badge=document.createElement('span'); badge.className='badge'; badge.textContent=(w.reward===WIN_NUMBER?'JACKPOT':'‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ'); const tm=document.createElement('span'); tm.className='time'; tm.textContent=`‚Ä¢ ${timeAgo(w.ts||Date.now())} ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`; right.appendChild(badge); right.appendChild(tm); li.appendChild(left); li.appendChild(right); ul.appendChild(li); }); }
    function saveWinnerCache(list){ try{ localStorage.setItem('rr365_winners_cache', JSON.stringify({ts:Date.now(), list})); }catch{} }
    function loadWinnerCache(){ try{ const raw=localStorage.getItem('rr365_winners_cache'); return raw?JSON.parse(raw).list:null; }catch{ return null; } }
    function WINNER_FETCH_URL(){ return scriptURL + '?mode=winners&day=today&jackpot=' + WIN_NUMBER + '&t=' + Date.now(); }
    async function fetchWinners(){ const res=await fetch(WINNER_FETCH_URL(), {cache:'no-store'}); const ct=(res.headers.get('content-type')||'').toLowerCase(); if(!res.ok || !ct.includes('application/json')) throw new Error('Web App ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á Anyone ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á JSON'); const data=await res.json(); if(Array.isArray(data)){ saveWinnerCache(data); return data;} return []; }
    async function loadWinners(){ try{ renderWinners(await fetchWinners()); } catch(err){ console.warn(err.message||err); const c=loadWinnerCache(); if(c) renderWinners(c); } }
    function pushWinnerImmediate(entry){ const cached=loadWinnerCache()||[]; const newList=[entry,...cached].slice(0,50); saveWinnerCache(newList); renderWinners(newList); }
    document.addEventListener('DOMContentLoaded',()=>{ loadWinners(); setInterval(loadWinners, WINNER_REFRESH_MS); });
    particlesJS('particles-js',{ particles:{ number:{value:60}, size:{value:4}, color:{value:'#ffd700'}, opacity:{value:0.6}, move:{speed:1.5}, line_linked:{enable:false} }, interactivity:{ events:{ onhover:{ enable:false } } } });
  </script>
</body>
</html>
```

---

## 2) **Code.gs** (Apps Script ‚Äî ‡πÄ‡∏û‡∏¥‡πà‡∏° router ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GET/POST)

```javascript
/**
 * Google Apps Script ‚Äî RR365 (‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô) ‚Äî ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GET
 * ‡πÅ‡∏ó‡πá‡∏ö‡∏ä‡∏µ‡∏ï: codes, sessions, plays
 * Deploy ‚Üí Web app ‚Üí Execute as: Me, Who has access: Anyone
 */
const TZ = Session.getScriptTimeZone() || 'Asia/Bangkok';
const DAY_MS = 24 * 60 * 60 * 1000;
const DAILY_LIMIT = 1; // ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ
const CODE_ALPHABET = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';

function onOpen(){
  SpreadsheetApp.getUi().createMenu('RR365')
    .addItem('‚ë† ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)', 'setupSheets')
    .addSeparator()
    .addItem('‚ë° ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'menuGen50')
    .addItem('‚ë¢ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î 200 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'menuGen200')
    .addSeparator()
    .addItem('‡∏•‡πâ‡∏≤‡∏á sessions & plays', 'resetSessionsAndPlays')
    .addToUi();
}

// ---- Router ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á GET/POST ----
function route_(p){
  const mode = String(p.mode||'').trim();
  if (mode === 'verify_admin_code') return verifyAdminCode(p);
  if (mode === 'quota')             return quota(p);
  if (mode === 'play')              return play(p);
  if (mode === 'winners')           return getWinners(p);
  if (mode === 'ping')              return {ok:true, now:new Date().toISOString()};
  return {error:'unknown mode'};
}
function doGet(e){ const p = (e&&e.parameter)?e.parameter:{}; return json(route_(p)); }
function doPost(e){ const p = (e&&e.parameter)?e.parameter:{}; return json(route_(p)); }

// ---- Core Handlers ----
function verifyAdminCode(p){
  const phone = (p.phone||'').trim();
  const code  = (p.code||'').trim();
  const deviceId = (p.deviceId||'').trim();
  if (!/^0\d{9}$/.test(phone)) return {ok:false, error:'‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'};
  if (!code) return {ok:false, error:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™'};
  const sh = getSheet('codes');
  const vals = sh.getDataRange().getValues();
  const now = Date.now();
  const COL = { code:0, phoneAllowed:1, maxUses:2, usedCount:3, expiresAt:4, active:5, issuedAt:6, claimedPhone:7, claimedDevice:8, claimedAt:9 };
  for (let i=1;i<vals.length;i++){
    const row = vals[i];
    if (String(row[COL.code]).trim() !== code) continue;
    const phoneAllowed = String(row[COL.phoneAllowed]||'').trim();
    const maxUses  = toInt(row[COL.maxUses], 1);
    const used     = toInt(row[COL.usedCount], 0);
    const active   = toInt(row[COL.active], 0);
    const expAt    = row[COL.expiresAt] ? new Date(row[COL.expiresAt]).getTime() : 0;
    const claimedPhone  = String(row[COL.claimedPhone]||'').trim();
    const claimedDevice = String(row[COL.claimedDevice]||'').trim();
    if (active !== 1) return {ok:false, error:'‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'};
    if (expAt && now > expAt) return {ok:false, error:'‡∏£‡∏´‡∏±‡∏™‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß'};
    if (phoneAllowed && phoneAllowed !== phone) return {ok:false, error:'‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ'};
    if (!claimedPhone){
      if (used >= maxUses) return {ok:false, error:'‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß'};
      sh.getRange(i+1, COL.claimedPhone+1).setValue(phone);
      sh.getRange(i+1, COL.claimedDevice+1).setValue(deviceId);
      sh.getRange(i+1, COL.claimedAt+1).setValue(new Date());
      sh.getRange(i+1, COL.usedCount+1).setValue(used+1);
      sh.getRange(i+1, COL.active+1).setValue(0);
    } else {
      if (claimedPhone !== phone) return {ok:false, error:'‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß'};
      // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
      // if (claimedDevice && claimedDevice !== deviceId) return {ok:false, error:'‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'};
    }
    const session = Utilities.getUuid();
    saveSession(session, phone, deviceId, now + DAY_MS);
    return {ok:true, session};
  }
  return {ok:false, error:'‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'};
}

function quota(p){
  if (!verifySession(p.session, p.phone, p.deviceId)) return {error:'‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô'};
  const q = getTodayQuota(p.phone, p.deviceId);
  return {limit:q.limit, playedToday:q.played, alreadyPlayed:q.played>=q.limit};
}

function play(p){
  if (!verifySession(p.session, p.phone, p.deviceId)) return {error:'session ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á/‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏'};
  const q = getTodayQuota(p.phone, p.deviceId);
  if (q.played >= q.limit) return {error:'‡∏Ñ‡∏£‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß'};
  logPlay(p.phone, p.deviceId, p.reward);
  return {ok:true};
}

function getWinners(p){
  const jackpot = String(p.jackpot||'').trim();
  const day = String(p.day||'today'); // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö today
  const sh = getSheet('plays');
  const vals = sh.getDataRange().getValues();
  const today = Utilities.formatDate(new Date(), TZ, 'yyyy-MM-dd');
  const matchDate = today;
  const out = [];
  for (let i=1;i<vals.length;i++){
    const [phone, date, deviceId, ts, reward] = vals[i];
    if (String(date) !== matchDate) continue;
    if (jackpot && String(reward) !== jackpot) continue;
    out.push({ phone:String(phone), reward:String(reward), ts: new Date(ts).getTime() });
  }
  return out.slice(-50).reverse();
}

// ---- Sessions / Quota / Logs ----
function saveSession(session, phone, deviceId, expireAt){ const sh=getSheet('sessions'); sh.appendRow([session, phone, deviceId, new Date(expireAt)]); }
function verifySession(session, phone, deviceId){ if(!session) return false; const sh=getSheet('sessions'); const vals=sh.getDataRange().getValues(); const now=Date.now(); for(let i=1;i<vals.length;i++){ const [s,ph,dev,exp]=vals[i]; if(String(s)===String(session) && String(ph)===String(phone) && String(dev)===String(deviceId)){ if(!exp || new Date(exp).getTime()>=now) return true; } } return false; }
function getTodayQuota(phone, deviceId){ const sh=getSheet('plays'); const vals=sh.getDataRange().getValues(); const today=Utilities.formatDate(new Date(), TZ, 'yyyy-MM-dd'); let played=0; for(let i=1;i<vals.length;i++){ const [ph,date,dev]=vals[i]; if(String(ph)===String(phone) && String(dev)===String(deviceId) && String(date)===today) played++; } return {limit:DAILY_LIMIT, played}; }
function logPlay(phone, deviceId, reward){ const sh=getSheet('plays'); const today=Utilities.formatDate(new Date(), TZ, 'yyyy-MM-dd'); sh.appendRow([phone, today, deviceId, new Date(), reward||'']); }

// ---- Sheet Setup & Admin tools ----
function setupSheets(){
  const ss = SpreadsheetApp.getActive();
  const defs = {
    codes:['code','phoneAllowed','maxUses','usedCount','expiresAt','active','issuedAt','claimedPhone','claimedDevice','claimedAt'],
    sessions:['session','phone','deviceId','expiresAt'],
    plays:['phone','date','deviceId','timestamp','reward']
  };
  Object.entries(defs).forEach(([name, headers])=>{
    let sh = ss.getSheetByName(name); if(!sh) sh = ss.insertSheet(name);
    sh.clear(); sh.getRange(1,1,1,headers.length).setValues([headers]); sh.setFrozenRows(1); sh.autoResizeColumns(1, headers.length);
    const head=sh.getRange(1,1,1,headers.length); head.setBackground('#222').setFontColor('#fff').setFontWeight('bold');
    (sh.getBandings()||[]).forEach(b=>b.remove());
    sh.getRange(1,1,Math.max(200, sh.getMaxRows()), headers.length).applyRowBanding(SpreadsheetApp.BandingTheme.BLUE, true, false);
  });
  const codes=ss.getSheetByName('codes'); const sessions=ss.getSheetByName('sessions'); const plays=ss.getSheetByName('plays');
  if(codes){ codes.getRange('C2:C').setNumberFormat('0'); codes.getRange('D2:D').setNumberFormat('0'); codes.getRange('E2:E').setNumberFormat('yyyy-mm-dd hh:mm'); codes.getRange('F2:F').setNumberFormat('0'); codes.getRange('G2:G').setNumberFormat('yyyy-mm-dd hh:mm'); codes.getRange('J2:J').setNumberFormat('yyyy-mm-dd hh:mm'); const v01=SpreadsheetApp.newDataValidation().requireValueInList(['0','1'], true).setAllowInvalid(false).build(); codes.getRange('F2:F').setDataValidation(v01); const vPos=SpreadsheetApp.newDataValidation().requireNumberGreaterThan(0).setAllowInvalid(false).build(); codes.getRange('C2:C').setDataValidation(vPos); const vZero=SpreadsheetApp.newDataValidation().requireNumberGreaterThanOrEqualTo(0).setAllowInvalid(false).build(); codes.getRange('D2:D').setDataValidation(vZero); }
  if(sessions){ sessions.getRange('D2:D').setNumberFormat('yyyy-mm-dd hh:mm'); }
  if(plays){ plays.getRange('B2:B').setNumberFormat('yyyy-mm-dd'); plays.getRange('D2:D').setNumberFormat('yyyy-mm-dd hh:mm'); }
  SpreadsheetApp.getUi().alert('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (codes/sessions/plays)');
}
function menuGen50(){ generateCodes(50); } function menuGen200(){ generateCodes(200); }
function generateCodes(n){ const sh=getSheet('codes'); const now=new Date(); const rows=[]; for(let i=0;i<n;i++){ rows.push([makeCode(), '', 1, 0, '', 1, now, '', '', '']); } if(rows.length){ sh.getRange(sh.getLastRow()+1,1,rows.length,rows[0].length).setValues(rows); SpreadsheetApp.getUi().alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô '+n+' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß'); } }
function makeCode(){ const pick=m=>Array.from({length:m},_=>CODE_ALPHABET.charAt(Math.floor(Math.random()*CODE_ALPHABET.length))).join(''); return pick(4)+'-'+pick(4); }
function resetSessionsAndPlays(){ clearBelowHeader('sessions'); clearBelowHeader('plays'); SpreadsheetApp.getUi().alert('üßπ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå sessions ‡πÅ‡∏•‡∏∞ plays ‡πÅ‡∏•‡πâ‡∏ß'); }
function clearBelowHeader(name){ const sh=getSheet(name); const last=sh.getLastRow(); if(last>1) sh.getRange(2,1,last-1, sh.getLastColumn()).clearContent(); }

// ---- Helpers ----
function getSheet(name){ const sh=SpreadsheetApp.getActive().getSheetByName(name); if(!sh) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏ä‡∏µ‡∏ï: '+name+' (‡∏Å‡∏î RR365 ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô)'); return sh; }
function json(o){ return ContentService.createTextOutput(JSON.stringify(o)).setMimeType(ContentService.MimeType.JSON); }
function toInt(v,def){ v=parseInt(v,10); return isNaN(v)?def:v; }
```

---

### ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

1. ‡πÄ‡∏õ‡∏¥‡∏î Google Sheet ‚Üí Extensions ‚Üí Apps Script ‚Üí ‡∏ß‡∏≤‡∏á **Code.gs** ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° ‚Üí **Deploy ‚Üí Manage deployments ‚Üí Edit ‚Üí Deploy**  (Execute as: *Me*, Who has access: **Anyone**)
2. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå **index.html** ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏Æ‡∏™‡∏ï‡πå (‡πÄ‡∏ä‡πà‡∏ô GitHub Pages) ‚Äî ‡πÅ‡∏Å‡πâ `ADMIN_TG_URL` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

   * ‡πÄ‡∏õ‡∏¥‡∏î `<exec-url>?mode=ping` ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ `{ok:true,...}`
   * ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå + ‡πÇ‡∏Ñ‡πâ‡∏î ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°

> ‡∏ñ‡πâ‡∏≤ Network ‡∏¢‡∏±‡∏á‡∏Ç‡∏∂‡πâ‡∏ô *Failed to fetch*: ‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß, ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ö‡∏ö hard reload, ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πà **exec URL** ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å deployment
